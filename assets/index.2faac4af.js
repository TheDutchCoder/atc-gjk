var Ce=Object.defineProperty;var Te=(i,t,e)=>t in i?Ce(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>(Te(i,typeof t!="symbol"?t+"":t,e),e);import{c as te,i as Re,S as Le,W as Ne,P as Ue,a as De,O as Xe,C as Ze,M as tt,B as H,b as P,e as g,d as A,G as Q,m as G,V as Ye,f as _,g as Be,D as We,I as K,E as Fe,r as J,h as Lt,H as ee,j as ht,F as ne,v as He,u as $e,k as Nt,o as je,l as W,n as F,p as h,q as Ut,T as Dt,w as Xt,s as T,t as lt,x as ct,y as B,z as N,A as Zt,J as Qe,K as qe}from"./vendor.c024a85e.js";const Je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};Je();const Ke=te({id:"gameMachine",initial:"playing",states:{playing:{on:{TICK:"tick",LOSE:"lose",WIN:"win",QUIT:"finished"}},tick:{on:{DONE:"playing"}},win:{on:{DONE:"finished"}},lose:{on:{DONE:"finished"}},finished:{type:"final"}}}),ot=Re(Ke),Ve=te({id:"main",initial:"loading",states:{loading:{on:{INTRO_IN:"introIn"}},introIn:{tags:"intro",on:{DONE:"introIdle"}},introIdle:{tags:"intro",on:{INTRO_OUT:"introOut"}},introOut:{tags:"intro",on:{DONE:"gameIn"}},gameIn:{tags:"board",on:{DONE:"gamePlaying"}},gamePlaying:{tags:"board",on:{GAME_OUT:"gameOut"}},gameOut:{tags:"board",on:{DONE:"introIn"}}}}),pt=new Le,tn=()=>{const i=document.getElementById("three");i.innerHTML="",i.appendChild(X.domElement)},en=()=>{pt.showPanel(0),document.body.appendChild(pt.dom)},X=new Ne({antialias:!0,alpha:!0,shadow:!0});X.setSize(window.innerWidth,window.innerHeight);X.shadowMap.enabled=!0;X.shadowMap.type=Ue;const D=new De(60,window.innerWidth/window.innerHeight,1,1e3);D.position.set(15,9,15);const z=new Xe(D,X.domElement);z.enableDamping=!0;z.enableRotate=!0;z.enableZoom=!0;z.enablePan=!1;z.autoRotate=!0;z.autoRotateSpeed=-2;const nn=new Ze,y=(i,t,e,n,s,o=!0)=>{[[0,11,17],[1,9,20],[2,13,19],[3,15,22],[5,10,16],[4,8,21],[7,12,18],[6,14,23]][i].forEach(r=>{let c,u,f,m=t.attributes.position.getX(r),d=t.attributes.position.getY(r),x=t.attributes.position.getZ(r);o?(c=e?m+e:m,u=n?d+n:d,f=s?x+s:x):(c=e||m,u=n||d,f=s||x),t.attributes.position.setXYZ(r,c,u,f)}),t.attributes.position.needsUpdate=!0},j=(i,t,e)=>{const n=Math.round(Math.random()*(t*1e5-i*1e5)+i*1e5)/1e5;return e&&n>=e.min&&n<=e.max?j(i,t,e):n},b=(i,t,e)=>{let n=Math.round(Math.random()*(t-i)+i);return n===e&&(n=b(i,t,e)),n},Z=(i,t=!1)=>{const e=Math.floor(Math.random()*i.length),n=i[e];return t&&i.splice(e,1),n},sn=(i,t,e,n=0)=>{const s=JSON.parse(JSON.stringify(i)),o=JSON.parse(JSON.stringify(i));if(n>0&&(o.splice(-n),o.splice(0,n),o.forEach(m=>{m.splice(-n),m.splice(0,n)})),o.flat(2).every(m=>!!m))return null;const a=0-Math.floor(t/2),r=0-Math.floor(e/2);let c,u;do c=b(n,t-n-1),u=b(n,e-n-1);while(s[u][c]);return{tile:{x:c+a,y:0,z:u+r},x:c,z:u}},se=(i,t,e={width:0,direction:0})=>{const{width:n,direction:s}=e,o=n/2;let a,r,c=j(i,t),u=0,f=j(i,t);for(s===0||s==4?(a=m=>m>o||m<-o,r=()=>!0):s===3||s==7?(a=()=>!0,r=(m,d)=>d>m+o||d<m-o):s===2||s==6?(a=()=>!0,r=(m,d)=>d>o||d<-o):(s===1||s==5)&&(a=()=>!0,r=(m,d)=>d>-m+o||d<-m-o);!a(c);)c=j(i,t);for(;!r(c,f);)f=j(i,t);return{x:c,y:u,z:f}},on=(i,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),o=Math.ceil(0-e/2),a=Math.abs(o),{x:r,z:c}=i;return r===n-1?c===o-1?3:c===a+1?1:2:r===s+1?c===o-1?5:c===a+1?7:6:c===o-1?4:0},yt=(i,t)=>{let{x:e,y:n,z:s}=i;return t===0?s--:t===1?(e++,s--):t===2?e++:t===3?(e++,s++):t===4?s++:t===5?(e--,s++):t===6?e--:t===7&&(e--,s--),{x:e,y:n,z:s}},an=(i,t)=>{let{x:e,y:n,z:s}=i;return t===0?s++:t===1?(e--,s++):t===2?e--:t===3?(e--,s--):t===4?s--:t===5?(e++,s--):t===6?e++:t===7&&(e++,s++),{x:e,y:n,z:s}},Yt=i=>{const t=Math.floor(i/4).toString(),e=(i%4*15).toString();return`${t.padStart(2,"0")}:${e.padStart(2,"0")}`},rn=i=>({0:"N",1:"NE",2:"E",3:"SE",4:"S",5:"SW",6:"W",7:"NW"})[i],ln=(i,t,e)=>{const n=Math.random()>.7,s=Math.ceil(0-i/2)-1,o=Math.abs(s),a=Math.ceil(0-t/2)-1,r=Math.abs(a),c=[s,o,0],u=[a,r],f=[a,r,0],m=Z(c),d=Math.ceil(Math.random()*9),x=Z(m===0?u:f),E={x:m,y:d,z:x};return n?oe(e):{position:E,direction:on(E,i,t),name:`${ie(E)}${d}`}},Bt=(i,t,e)=>{const n=Math.random()>.3,s=Math.ceil(0-i/2)-1,o=Math.abs(s),a=Math.ceil(0-t/2)-1,r=Math.abs(a),c=[s,o,0],u=[a,r],f=[a,r,0],m=Z(c),d=Math.ceil(Math.random()*9),x=Z(m===0?u:f),E={x:m,y:d,z:x};return n?oe(e):{position:E,direction:0,name:`${ie(E)}${d}`}},oe=i=>Z(i),ie=i=>{const{x:t,z:e}=i;if(t===0){if(e>0)return"S";if(e<0)return"N"}else if(t<0){if(e<0)return"NW";if(e===0)return"W";if(e>0)return"SW"}else if(t>0){if(e<0)return"NE";if(e===0)return"E";if(e>0)return"SE"}},cn=new tt({color:10053706,flatShading:!0});class dn{constructor(){l(this,"_tile",null);l(this,"_dirt",null)}add(t={scale:{x:1,y:1,z:1}}){this._tile=t}reset(){this._tile=null,this._dirt=null}create(){const t=new H(10,3,10);return t.translate(0,-2.5,0),t.scale(this._tile.scale.x,this._tile.scale.y,this._tile.scale.z),this._dirt=new P(t,cn),this._dirt.scale.setScalar(0),this._dirt}animateIn(){return this._tile?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new g.Tween(e).to(n,500).easing(g.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tile?new Promise(t=>{const e={scale:1},n={scale:0};new g.Tween(e).to(n,500).easing(g.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._dirt.scale.setScalar(t.scale)}}const zt=new dn,vt=10,hn=1,kt=10,pn=new tt({color:11984276,flatShading:!0}),un=new tt({color:10010486,flatShading:!0}),mn=i=>{const t=i.getAttribute("position");for(let e=0;e<t.count;e++){const n=new Ye;if(n.fromBufferAttribute(t,e),n.y>=.5&&n.x!==-5&&n.x!==5&&n.z!==-5&&n.z!==5){const s=.15-Math.random()*.3,o=vt/40-Math.random()*(vt/20),a=kt/40-Math.random()*(kt/20);t.setXYZ(e,n.x+o,n.y+s,n.z+a)}}i.attributes.position.needsUpdate=!0};class gn{constructor(){l(this,"_tiles",[]);l(this,"_grassLight",new A);l(this,"_grassDark",new A);l(this,"_grassAll",new Q)}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._grassLight=new A,this._grassDark=new A,this._grassAll=new Q}create(){const t=[],e=[];if(this._tiles.forEach(n=>{const s=new H(10,1,10,vt,hn,kt);mn(s),s.rotateY(b(0,4)*2*(-Math.PI/4)),s.translate(n.position.x*10,-.5+n.position.y*5,n.position.z*10),n.position.x&1&&n.position.z&1||!(n.position.x&1)&&!(n.position.z&1)?t.push(s):e.push(s)}),this._tiles.length){if(t.length){const n=G(t);this._grassLight=new P(n,pn),this._grassLight.receiveShadow=!0}if(e.length){const n=G(e);this._grassDark=new P(n,un),this._grassDark.receiveShadow=!0}this._grassAll.add(this._grassLight,this._grassDark),this._grassAll.scale.setScalar(0)}return this._grassAll}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new g.Tween(e).to(n,500).easing(g.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(250).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new g.Tween(e).to(n,500).easing(g.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._grassAll.scale.setScalar(t.scale)}}const ut=new gn,fn=new _(11371131),_n=new _(10473352),wn=new _(9157493),bn=new _(13617032),yn=new _(13340781),ae=new _(11910596),re=new _(9542564),le=new _(7964047),ce=new _(5857641);new _(11910596);new _(9542564);new _(7964047);const xn=new _(5124632),vn=new _(6307874),kn=new _(5914664),Mn=new _(15658734);new _(16711680);new _(65280);new _(255);const zn=new _(0),En=new _(16751104),In=new _(16711680),Sn=new _(65280),C=new tt({flatShading:!0}),An=new tt({flatShading:!0,transparent:!0,opacity:.75}),On=new tt({flatShading:!0,transparent:!0,opacity:.85}),R=new H(1,1,1),dt=new Be(.3,2,4),de=new We(1,0);new H(2,.15,.2);new H(.1,.1,10);const Pn=new H(3,.2,9),Gn=new H(.2,.05,.75),Wt=new H(.2,.2,.2),Ft=[_n,wn,bn,yn],$=new A;class Cn{constructor(){l(this,"_tiles",[]);l(this,"_trunk",null);l(this,"_foliage",null);l(this,"_trees",new Q);l(this,"_instances",[])}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._trunk=null,this._foliage=null,this._trees=new Q,this._instances=[]}create(){let t=0;if(this._tiles.forEach(e=>{const n=b(20,30);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:se(-4.75,4.75,e.exclude),rot:{x:j(-.12,.12),y:j(-.12,.12),z:0},scale:.5+Math.random()*.75,color:Ft[b(0,Ft.length-1)],tile:e})}),this._tiles.length){this._trunk=new K(dt.clone(),C,t),this._trunk.castShadow=!0;const e=dt.clone();e.scale(1.3,1.3,1.3),e.translate(0,.5,0);const n=dt.clone();n.scale(1.1,1.1,1.1),n.translate(0,1.1,0);const s=G([e,n]);this._foliage=new K(s,C,t),this._foliage.castShadow=!0,this._foliage.receiveShadow=!0,this._trunk.geometry.computeBoundingBox(),this._foliage.geometry.computeBoundingBox(),this._trunk.geometry.translate(0,this._trunk.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,this._foliage.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,.3,0),this._trees.add(this._trunk,this._foliage)}return this._trees}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:r,tile:c}=t,{x:u,y:f,z:m}=s,{x:d,y:x,z:E}=o,L=new Fe(d,x,E,"XYZ");$.position.set(u+c.position.x*10,(f+c.position.y*5)*a,m+c.position.z*10),$.setRotationFromEuler(L),$.scale.set(n.x,n.y,n.z),$.updateMatrixWorld(!0),this._trunk.setMatrixAt(e,$.matrixWorld),this._trunk.setColorAt(e,fn),$.updateMatrixWorld(!0),this._foliage.setMatrixAt(e,$.matrixWorld),this._foliage.setColorAt(e,r),this._trunk.instanceMatrix.needsUpdate=!0,this._trunk.instanceColor.needsUpdate=!0,this._foliage.instanceMatrix.needsUpdate=!0,this._foliage.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new g.Tween(o).to(a,500).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(b(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};new g.Tween(o).to(a,500).easing(g.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(b(500,750)).start()})}):Promise.resolve()}}const mt=new Cn,Ht=[ae,re,le,ce],st=new A;class Tn{constructor(){l(this,"_tiles",[]);l(this,"_rock",new A);l(this,"_instances",[])}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._rock=new A,this._instances=[]}create(){let t=0;return this._tiles.forEach(e=>{const n=b(6,12);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:se(-4.5,4.5,e.exclude),rot:{x:-.1+Math.random()*.2,y:Math.PI/2*Math.random(),z:-.1+Math.random()*.2},scale:.1+Math.random()*.3,color:Ht[b(0,Ht.length-1)],tile:e})}),this._tiles.length&&(this._rock=new K(de,C,t),this._rock.castShadow=!0,this._rock.receiveShadow=!0),this._rock}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:r,tile:c}=t,{x:u,y:f,z:m}=s,{x:d,y:x,z:E}=o;st.position.set(u+c.position.x*10,(f+c.position.y+n.y)*a,m+c.position.z*10),st.rotation.set(d,x,E),st.scale.set(n.x,n.y,n.z),st.updateMatrixWorld(!0),this._rock.setMatrixAt(e,st.matrixWorld),this._rock.setColorAt(e,r),this._rock.instanceMatrix.needsUpdate=!0,this._rock.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new g.Tween(o).to(a,500).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(b(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};this.updateInstance(e,n,o),new g.Tween(o).to(a,500).easing(g.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(b(500,750)).start()})}):Promise.resolve()}}const gt=new Tn,$t=[ae,re,le,ce],q=new A;class Rn{constructor(){l(this,"_tiles",[]);l(this,"_clouds",new A);l(this,"_animate",()=>{});l(this,"_instances",[]);l(this,"_tick",0)}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._clouds=new A,this._animate=()=>{},this._instances=[],this._tick=0}create(){let t=0;return this._tiles.forEach(e=>{const n=b(8,12);t+=n;const s=$t[b(0,$t.length-1)],o=b(5,9);for(let a=0;a<n;a++)this._instances.push({pos:{x:-3+Math.random()*6,y:-.2+Math.random()*.4,z:-3+Math.random()*6},rot:{x:Math.PI*2*Math.random(),y:Math.PI*2*Math.random(),z:Math.PI*2*Math.random()},altitude:e.position.y||o,animation:{direction:Math.random()>.5?1:-1,speed:b(200,300)},scale:.5+Math.random()*1.5,color:s,isReady:!1,tile:e})}),this._clouds=new K(de,On,t),this._animate=()=>{this._instances.forEach((e,n)=>{const{isReady:s}=e;s&&this.updateInstance(e,n)}),this._tick++},this._clouds}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:r,animation:c,tile:u,altitude:f}=t,{x:m,y:d,z:x}=s,{x:E,y:L,z:v}=o,{direction:M,speed:I}=c,k=Math.sin((this._tick+e*50)/10/Math.PI)/20;q.position.set(m+u.position.x*10,f*5+(d+k)*a,x+u.position.z*10),q.rotation.set(E,L,v+this._tick/I*M),n?q.scale.set(n.x,n.y,n.z):q.scale.setScalar(a),q.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,q.matrixWorld),this._clouds.setColorAt(e,r),this._clouds.instanceMatrix.needsUpdate=!0,this._clouds.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new g.Tween(o).to(a,500).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(()=>{e.isReady=!0,t()}).delay(b(1e3,1250)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};this.updateInstance(e,n,o),new g.Tween(o).to(a,500).easing(g.Easing.Elastic.In).onStart(()=>e.isReady=!1).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(b(250,500)).start()})}):Promise.resolve()}}const V=new Rn,he=C.clone();he.color.set(zn);const pe=C.clone();pe.color.set(En);const ue=C.clone();ue.color.set(Sn);const me=C.clone();me.color.set(In);class Ln{constructor(){l(this,"_tiles",[]);l(this,"_airstrip",null);l(this,"_strips",null);l(this,"_stripes",null);l(this,"_greenLights",null);l(this,"_redLights",null)}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._airstrip=null,this._strips=null,this._stripes=null,this._greenLights=null,this._redLights=null}create(){this._airstrip=new Q;const t=[],e=[],n=[],s=[];if(this._tiles.forEach(o=>{const a=Pn.clone();a.rotateY(o.direction*Math.PI/-4),a.translate(o.position.x*10,.1+o.position.y*5,o.position.z*10),t.push(a);for(let r=0;r<7;r++){const c=Gn.clone();c.translate(0,0,-3+r),c.rotateY(o.direction*Math.PI/-4),c.translate(o.position.x*10,.2+o.position.y*5,o.position.z*10),e.push(c)}for(let r=0;r<5;r++){const c=Wt.clone();c.translate(-1+r*.5,0,4),c.rotateY(o.direction*Math.PI/-4),c.translate(o.position.x*10,o.position.y*5,o.position.z*10),n.push(c);const u=Wt.clone();u.translate(-1+r*.5,0,-4),u.rotateY(o.direction*Math.PI/-4),u.translate(o.position.x*10,o.position.y*5,o.position.z*10),s.push(u)}}),this._tiles.length){const o=G(t),a=G(e),r=G(n),c=G(s);this._strips=new P(o,he),this._stripes=new P(a,pe),this._greenLights=new P(r,ue),this._redLights=new P(c,me),this._greenLights.position.y=.2,this._redLights.position.y=.2,this._airstrip.add(this._strips,this._stripes,this._greenLights,this._redLights)}return this._airstrip}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new g.Tween(e).to(n,500).easing(g.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new g.Tween(e).to(n,500).easing(g.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._airstrip.scale.setScalar(t.scale)}}const Et=new Ln,jt=[xn,vn,kn],U=new A;class Nn{constructor(){l(this,"_tiles",[]);l(this,"_beams",null);l(this,"_rails",null);l(this,"_beamInstances",[]);l(this,"_railInstances",[])}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._beams=null,this._rails=null,this._beamInstances=[],this._railInstances=[]}create(){const t=new Q;let e=0,n=0;if(this._tiles.forEach(s=>{const a=s.direction===2||s.direction===6;e+=11;for(let r=0;r<11;r++)this._beamInstances.push({pos:{x:a?-4.6+r*10/11:0,y:0,z:a?0:-4.6+r*10/11},rot:{x:0,y:-.08+Math.random()*.16+(a?Math.PI/2:0),z:0},color:jt[b(0,jt.length-1)],tile:s});n+=2;for(let r=0;r<2;r++)this._railInstances.push({pos:{x:a?0:-.7+r*1.4,y:.2,z:a?-.7+r*1.4:0},rot:{x:0,y:a?Math.PI/2:0,z:0},color:Mn,tile:s})}),this._tiles.length){const s=R.clone();s.scale(2,.3,.3),this._beams=new K(s,C,e),this._beams.castShadow=!0,this._beams.receiveShadow=!0;const o=R.clone();o.scale(.2,.2,10),this._rails=new K(o,C,n),this._rails.castShadow=!0,this._rails.receiveShadow=!0,t.add(this._beams,this._rails)}return t}updateBeamInstance(t,e,n){const{pos:s,rot:o,color:a,tile:r}=t,{x:c,y:u,z:f}=s,{x:m,y:d,z:x}=o;U.position.set(c+r.position.x*10,u+r.position.y*5,f+r.position.z*10),U.rotation.set(m,d,x),U.scale.set(n.x,n.y,n.z),U.updateMatrixWorld(!0),this._beams.setMatrixAt(e,U.matrixWorld),this._beams.setColorAt(e,a),this._beams.instanceMatrix.needsUpdate=!0,this._beams.instanceColor.needsUpdate=!0}updateRailInstance(t,e,n){const{pos:s,rot:o,color:a,tile:r}=t,{x:c,y:u,z:f}=s,{x:m,y:d,z:x}=o;U.position.set(c+r.position.x*10,u+n.y+r.position.y*10,f+r.position.z*10),U.rotation.set(m,d,x),U.scale.set(n.scale,n.scale,n.scale),U.updateMatrixWorld(!0),this._rails.setMatrixAt(e,U.matrixWorld),this._rails.setColorAt(e,a),this._rails.instanceMatrix.needsUpdate=!0,this._rails.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:0,y:0,z:0},o={x:1,y:1,z:1};this.updateBeamInstance(e,n,s),new g.Tween(s).to(o,500).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(b(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:5,scale:0},o={y:0,scale:1};this.updateRailInstance(e,n,s),new g.Tween(s).to(o,500).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(b(750,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:1,y:1,z:1},o={x:0,y:0,z:0};new g.Tween(s).to(o,500).easing(g.Easing.Elastic.In).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(b(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:0,scale:1},o={y:5,scale:0};new g.Tween(s).to(o,500).easing(g.Easing.Elastic.In).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(b(750,1e3)).start()})}):Promise.resolve()}}const ge=new Nn,Qt=i=>{i.dispose();for(const t of Object.keys(i)){const e=i[t];e&&typeof e=="object"&&"minFilter"in e&&e.dispose()}};class fe{constructor(){l(this,"_scene",null);l(this,"_anims",[]);l(this,"_lights",[]);l(this,"_models",[]);l(this,"_fog",null);l(this,"_elements",[zt,ut,mt,gt,V,Et,ge]);l(this,"_airplanes",J([]));l(this,"_board",null);l(this,"_tick",J(-1));l(this,"_isAnimating",!1);l(this,"_score",J(0));l(this,"_animate",()=>{V._animate(),this._airplanes.value.forEach(t=>t==null?void 0:t.animate())});this._scene=new Lt}addLight(t){this._lights.push(t)}addFog(t){this._fog=t}addBoard(t){this._board=t}addAirplane(t){this._airplanes.value.push(t),this._scene.add(t._model)}removeAirplane(t){this._airplanes.value=this._airplanes.value.filter(n=>n._id!==t._id),this._board._airplanesQueue.map(n=>(n._id===t._id&&(n._landed=!0),n));const e=this._scene.getObjectById(t._model.id);this._scene.remove(e)}reset(){this._scene.traverse(t=>{if(!!t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)Qt(t.material);else for(const e of t.material)Qt(e)}),this._scene=new Lt,this._anims=[],this._lights=[],this._models=[],this._fog=null,this._elements.forEach(t=>t.reset())}async animateIn(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateIn())),Promise.resolve()}async animateOut(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateOut())),Promise.resolve()}render(){this._scene.fog=this._fog,this._lights.forEach(t=>{this._scene.add(t)}),this._elements.forEach(t=>this._scene.add(t.create()))}checkGhosts(){this._airplanes.value.forEach(t=>t.unsetGhost())}}class It{constructor({position:t={x:0,y:0,z:0}}={}){l(this,"_position",{x:0,y:0,z:0});l(this,"_model",null);l(this,"_hasAnimations",!1);l(this,"_isAnimating",!1);l(this,"_shouldBeRemoved",!1);l(this,"_tick",0);l(this,"displayName","");this._position=t}updatePosition(){this._model.position.x=this._position.x*10,this._model.position.y=this._position.y*5,this._model.position.z=this._position.z*10}get position(){return this._position}set position(t){this._position=t,this.updatePosition()}get model(){return this._model}set model(t){this._model=t,this.updatePosition(),this._hasAnimations}get isAnimating(){return this._isAnimating}set isAnimating(t){this._isAnimating=t}}class _e extends It{constructor({position:t={x:0,y:0,z:0}}={}){super({position:t});this.create()}create(){ut.add({position:this._position}),mt.add({position:this._position}),gt.add({position:this._position})}}class Mt extends It{constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});l(this,"_tiles",[]);l(this,"_direction",0);this._direction=e,this.create()}create(){ut.add({position:this._position}),mt.add({position:this._position,exclude:{width:3,direction:this._direction}}),gt.add({position:this._position,exclude:{width:3,direction:this._direction}}),ge.add({position:this._position,direction:this._direction})}}class we extends It{constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});l(this,"_tiles",[]);l(this,"_direction",0);this._direction=e,this.create()}create(){ut.add({position:this._position}),mt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),gt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Et.add({position:this._position,direction:this._direction})}}const Un=new _(16777215),Dn=i=>{const t=R.clone();t.scale(1,1,2),y(0,t,-.2,-.1),y(2,t,-.2,.3),y(4,t,.2,-.1),y(6,t,.2,.3);const e=R.clone();e.scale(3,.1,1),y(1,e,.2,.05),y(3,e,.2,-.05),y(5,e,-.2,.05),y(7,e,-.2,-.05);const n=R.clone();n.scale(.1,.75,.5),n.translate(0,.5,.95),y(0,n,-.04,.05),y(2,n,-.04),y(3,n,0,-.05),y(4,n,.04,.05),y(6,n,.04),y(7,n,0,-.05);const s=R.clone();s.scale(.4,.5,.6);const o=s.clone();o.translate(0,-.3,.6),o.rotateX(-.2);const a=s.clone();a.translate(.3,-.3,-.65);const r=s.clone();r.translate(-.3,-.3,-.65);const c=G([t,e,n,o,a,r]),u=R.clone();u.scale(.7,.4,.05),u.translate(0,.5,-.7),u.rotateX(.2),y(0,u,-.05),y(1,u,-.05),y(4,u,.05),y(5,u,.05);const f=G([u]),m=R.clone();m.scale(1,1,.5),m.translate(0,0,-1.25),y(1,m,-.1,-.1),y(3,m,-.1,.1),y(5,m,.1,-.1),y(7,m,.1,.1);const d=R.clone();d.scale(.1,.1,.5),y(2,d,null,null,.01),y(1,d,null,null,-.009),y(3,d,null,null,-.009),y(7,d,null,null,-.01);const x=d.clone();x.rotateZ(Math.PI/4),x.rotateY(.2),x.translate(.5,.2,-1.05);const E=d.clone();E.rotateZ(Math.PI/4),E.translate(.55,.2,-.55);const L=d.clone();L.rotateZ(Math.PI/4)+Math.PI/2,L.rotateY(-.2),L.translate(-.5,.2,-1.05);const v=d.clone();v.rotateZ(Math.PI/4),v.translate(-.55,.2,-.55);const M=G([m,x,E,L,v]),I=R.clone();I.scale(.2,.2,.2),I.translate(0,0,-1.55),y(0,I,.07,.07),y(2,I,.07,-.07),y(4,I,-.07,.07),y(6,I,-.07,-.07);const k=R.clone();k.scale(.2,.4,.4);const S=k.clone();S.translate(0,-.6,.6),S.rotateX(-.2);const et=k.clone();et.translate(-.3,-.6,-.65);const nt=k.clone();nt.translate(.3,-.6,-.65);const w=G([I,S,et,nt]),Y=R.clone();Y.scale(.15,1.5,.05),Y.translate(0,0,-1.6);const it=Y.clone();it.rotateZ(Math.PI/2);const ye=G([Y,it]),at=R.clone();at.scale(.34,.2,.2);const ft=at.clone();ft.translate(0,-.6,.6),ft.rotateX(-.2);const St=at.clone();St.translate(-.3,-.6,-.65);const At=at.clone();At.translate(.3,-.6,-.65);const xe=G([ft,St,At]),rt=dt.clone();rt.scale(1.2,.42,1.2),rt.rotateX(Math.PI),rt.translate(0,2,0);const ve=G([rt]),Ot=new Q,_t=C.clone();_t.color.set(i),_t.name="base";const Pt=An.clone(),Gt=C.clone(),Ct=C.clone(),wt=C.clone(),Tt=C.clone(),ke=new _(14872564),Me=new _(0),ze=new _(10053706),Ee=new _(16777215),Ie=new _(65280);Pt.color.set(ke),Gt.color.set(Ee),Ct.color.set(ze),wt.color.set(Me),Tt.color.set(Ie);const Se=new P(c,_t),Ae=new P(f,Pt),Oe=new P(M,Gt),Pe=new P(w,wt),Rt=new P(ye,wt);Rt.name="props";const Ge=new P(xe,Ct),bt=new P(ve,Tt);return bt.name="selector",bt.visible=!1,Ot.add(Se,Ae,Oe,Pe,Rt,Ge,bt),Ot};class be{constructor(t){l(this,"_start",null);l(this,"_end",null);l(this,"_startTime",0);l(this,"_position",{x:0,y:0,z:0});l(this,"_direction",0);l(this,"_targetAltitude",0);l(this,"_targetDirection",0);l(this,"_endPosition",{x:0,y:0,z:0});l(this,"_endDirection",0);l(this,"_spawned",!1);l(this,"_takenOff",!1);l(this,"_isGhost",!1);l(this,"_isSelected",!1);l(this,"_name","");l(this,"_id",null);l(this,"_color",null);l(this,"_model",null);l(this,"_tick",0);l(this,"_fuel",0);l(this,"animate",()=>this.animateIdle());const{id:e,start:n,end:s,fuel:o,startTime:a}=t;return this._start=n,this._end=s,this._position=n.position,this._direction=n.direction,this._targetAltitude=this._position.y||1,this._takenOff=this._position.y!==0,this._id=e,this._name="GJK",this._color=new _(Math.random()*16777215),this._fuel=o,this._startTime=a,this.create(),this}updateAnimation(t){this._model.position.x=t.position.x*10,this._model.position.z=t.position.z*10,this._takenOff?this._model.position.y=t.position.y*5:this._model.position.y=(.18+t.position.y)*5,this._model.scale.setScalar(t.scale)}animateIn(t=1250,e=500){return new Promise(n=>{if(this._takenOff){const{_position:s,_direction:o}=this,a={position:an(s,o),direction:o,scale:0},r={position:s,direction:o,scale:1};this.updateAnimation(a),new g.Tween(a).to(r,e).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()}else{const{_position:s,_direction:o}=this,a={position:s,direction:o,scale:0},r={position:s,direction:o,scale:1};this.updateAnimation(a),new g.Tween(a).to(r,e).easing(g.Easing.Elastic.Out).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()}})}animateOut(t=0,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this,a={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._direction,scale:1},r={position:yt(s,o),direction:this._direction,scale:0};this.updateAnimation(a),new g.Tween(a).to(r,e).easing(g.Easing.Elastic.In).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()})}animateIdle(){const t=Math.sin(this._tick/10/Math.PI)/100,e=Math.sin(this._tick/15/Math.PI)/10,n=Math.sin(this._tick/20/Math.PI)/20;this._position.y>=1&&(this._model.position.y+=t,this._model.rotation.z=e,this._model.rotation.x=n),this._model.children.forEach(s=>{s.name==="props"&&(s.rotation.z+=.3),s.name==="selector"&&(s.rotation.y+=.01,s.position.y+=t)}),this._tick++}create(){this._spawned=!0;const t=Dn(this._color);t.position.x=this._position.x*10,t.position.z=this._position.z*10,t.position.y=this._position.y*5,t.rotation.y=this._direction*(Math.PI/-4),this._takenOff||t.rotateX(.1),this._model=t}async next(t=0,e=1){const n=yt(this._position,this._direction);let s=0,o=0;this._targetAltitude>this._position.y?s=1:this._targetAltitude<this._position.y&&(s=-1),this._targetDirection>0?(this._targetDirection--,o=1):this._targetDirection<0&&(this._targetDirection++,o=-1),await this.animateNext(s,o,t,e,this._takenOff?0:.1),this._takenOff=!0,n.y+=s,this._position=n,this._direction=(8+(this._direction+o))%8,this._model.rotation.y=this._direction*(Math.PI/-4),JSON.stringify(this._position)===JSON.stringify(this._end.position)&&this._direction===this._end.direction&&console.log("yay, plane landed at target!"),this._fuel-=1}async animateNext(t,e,n=0,s=1){return new Promise(o=>{const a={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._model.rotation.y,scale:s},r=yt(this._position,this._direction);r.y+=t;const c={position:r,direction:this._model.rotation.y+e*Math.PI/-4,scale:1};new g.Tween(a).to(c,500).easing(g.Easing.Cubic.InOut).onUpdate(()=>this.updateAnimation(a,this._targetDirection>0)).onComplete(o).delay(n).start()})}setGhost(){this._isGhost=!0,this._model.children.forEach(t=>{t.material.name==="base"&&t.material.color.set(Un),t.material&&t.material.name!=="selector"&&(t.material.transparent=!0,t.material.opacity=.75,t.material.needsUpdate=!0)})}unsetGhost(){this._isGhost=!1,this._model.children.forEach(t=>{t.material.name==="base"&&t.material.color.set(this._color),t.material&&t.material.name!=="selector"&&(t.material.transparent=!1,t.material.opacity=1,t.material.needsUpdate=!0)})}setSelected(){this._isSelected=!0,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!0)})}unsetSelected(){this._isSelected=!1,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!1)})}setHeight(t){this._targetAltitude=t}setDirection(t){this._targetDirection+=t}}const O=new fe,Xn=[_e,Mt,we],Zn=Z(Xn);O.start=()=>{const i=new ee(16777215,526338,.7);i.position.set(15,25,15);const t=new A;t.rotation.x=Math.PI/-3;const e=new ht(16777215,.3);t.add(e),e.position.set(60,0,0),e.lookAt(t.position),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.top=90,e.shadow.camera.bottom=-120,e.shadow.camera.left=-90,e.shadow.camera.right=90,t.rotation.y=Math.PI/-1.5;const n=new ht(11592173,.2);n.position.set(-20,25,-10),O.addLight(i),O.addLight(t),O.addLight(n),new Zn;const s=new be({id:0,start:{position:{x:0,y:1,z:0},direction:1,name:""},end:{position:{x:0,y:0,z:0},direction:1,name:""},fuel:100});O.addAirplane(s),zt.add(),V.add({position:{x:0,y:2,z:0}});const o=new ne(new _(10209513),15,30);O.addFog(o);const a=new A;a.position.y=2.5,z.target=a.position};const Yn={EASY:"EASY",NORMAL:"NORMAL",HARD:"HARD"},qt={EASY:{width:9,depth:9},NORMAL:{width:11,depth:11},HARD:{width:13,depth:13}},Jt={EASY:{min:1,max:2},NORMAL:{min:2,max:3},HARD:{min:3,max:5}},Kt={EASY:{min:1,max:2},NORMAL:{min:3,max:5},HARD:{min:6,max:9}},xt={EASY:{amount:24,height:5},NORMAL:{amount:48,height:7},HARD:{amount:96,height:9}};class Bn{constructor(t=Yn.NORMAL){l(this,"_width",0);l(this,"_depth",0);l(this,"_difficulty",null);l(this,"_airfields",0);l(this,"_clouds",0);l(this,"_airplanes",0);l(this,"_airplanesQueue",[]);l(this,"_tiles",[]);l(this,"_tick",0);this._difficulty=t,this._width=qt[this._difficulty].width,this._depth=qt[this._difficulty].depth,this._airfields=b(Jt[this._difficulty].min,Jt[this._difficulty].max),this._clouds=b(Kt[this._difficulty].min,Kt[this._difficulty].max),this._airplanes=xt[this._difficulty].amount}generate(){const t=Math.ceil(0-this._width/2),e=Math.ceil(0-this._depth/2),n=Math.abs(e);this._tiles=Array.from({length:this._depth},()=>Array.from({length:this._width},()=>null));const s=Math.random()>.5,o=Z(s?[0,1,this._depth-1,this._depth-2]:[0,1,this._width-1,this._width-2]);s?this._tiles[o].forEach((r,c)=>{this._tiles[o][c]=new Mt({position:{x:c+t,y:0,z:o+e},direction:2})}):this._tiles.forEach((r,c)=>{this._tiles[c][o]=new Mt({position:{x:o+t,y:0,z:c+e}})});const a=[];for(let r=0;r<this._airfields;r++){const c=sn(this._tiles,this._width,this._depth,3);if(c){const{x:u,z:f,tile:m}=c,d={position:m,direction:b(0,7),name:`AP${a.length+1}`};a.push(d),this._tiles[f][u]=new we(d)}}this._tiles.forEach((r,c)=>{r.forEach((u,f)=>{if(!u)return new _e({position:{x:f+t,y:0,z:c+e}})})}),zt.add({scale:{x:this._width,y:1,z:this._depth}});for(let r=0;r<this._clouds;r++)V.add({position:{x:b(t,n),y:b(xt[this._difficulty].height-2,xt[this._difficulty].height),z:b(e,n)}});V.add({position:{x:0,y:1,z:0}});for(let r=0;r<this._airplanes;r++){const c=ln(this._width,this._depth,a);let u=Bt(this._width,this._depth,a);for(;c.name===u.name;)u=Bt(this._width,this._depth,a);this._airplanesQueue.push({_id:He(),_start:c,_end:u,_startTime:b(0,96),_fuel:b(20,35)})}this._airplanesQueue.sort((r,c)=>r._startTime<c._startTime?-1:r._startTime>c._startTime?1:0)}}const p=new fe,Vt=new Bn;p.start=()=>{const i=new ee(16777215,526338,.7);i.position.set(15,25,15);const t=new A;t.rotation.x=Math.PI/-3;const e=new ht(16777215,.3);t.add(e),e.position.set(60,0,0),e.lookAt(t.position),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.top=90,e.shadow.camera.bottom=-120,e.shadow.camera.left=-90,e.shadow.camera.right=90,t.rotation.y=Math.PI/-1.5;const n=new ht(11592173,.2);n.position.set(-20,25,-10);const s=new A;s.position.y=2.5,z.target=s.position,p.addLight(i),p.addLight(t),p.addLight(n);const o=new ne(new _(10209513),15,250);Vt.generate(),p.addFog(o),p.addBoard(Vt),ot.start(),p.nextTick()};p.nextTick=async()=>{if(!p._isAnimating){p._isAnimating=!0,p._tick.value++;const i=Promise.all(p._airplanes.value.map(e=>e.next())),t=Promise.all(p._board._airplanesQueue.filter(e=>e._startTime===p._tick.value).map(e=>{const n=new be({id:e._id,start:e._start,end:e._end,fuel:e._fuel,startTime:e._startTime});return p.addAirplane(n),n.setGhost(),n.animateIn(0,500)}));await i,await t,p.checkGhosts(),p.checkDestinations(),p.checkOutOfBounds(),p.checkOutOfFuel(),p._isAnimating=!1}};p.checkGhosts=()=>{const i=0-Math.floor(p._board._width/2),t=0-Math.floor(p._board._depth/2),e=Math.abs(i),n=Math.abs(t);V._tiles.forEach(s=>{p._airplanes.value.forEach(o=>{const{x:a,y:r,z:c}=s.position,{x:u,y:f,z:m}=o._position;a===u&&r===f&&c===m||u<i||u>e||m<t||m>n||!o._takenOff?o.setGhost():o.unsetGhost()})})};p.checkCollisions=()=>{p._airplanes.value.forEach(i=>{const{x:t,y:e,z:n}=i._position;i._takenOff&&(e===0&&Et._tiles.forEach(s=>{const{x:o,y:a,z:r}=s.position;t===o&&n===r&&i._direction===s.direction?console.log("plane landed on airport, check if it's the right airport!"):(console.log(`plane crashed at ${o}, ${a}, ${r}`),ot.send("LOSE"))}),p._airplanes.value.forEach(s=>{if(i._id!==s._id){const{x:o,y:a,z:r}=s._position;t===o&&e===a&&n===r&&ot.send("LOSE")}}))})};p.checkDestinations=()=>{p._airplanes.value.forEach(i=>{if(i._takenOff){const{x:t,y:e,z:n}=i._position,s=i._direction,{x:o,y:a,z:r}=i._endPosition,c=i._endPosition;t===o&&e===a&&n===r&&s===c?(p._score.value+=100+i._fuel*10,i.setGhost()):e===0&&(console.log("game over!"),ot.send("LOSE"))}})};p.checkOutOfBounds=()=>{p._airplanes.value.forEach(i=>{const{x:t,z:e}=i._position,n=0-Math.ceil(p._board._width/2),s=0-Math.ceil(p._board._depth/2),o=Math.abs(n),a=Math.abs(s);(t<n||t>o||e<s||e>a)&&(p._score.value-=500,p.removeAirplane(i))})};p.checkOutOfFuel=()=>{p._airplanes.value.forEach(i=>{i._fuel<=0&&(console.log("game over!"),ot.send("LOSE"))})};p.selectPlane=i=>{p._airplanes.value.forEach(t=>{t.unsetSelected(),t._id===i&&!t._isGhost&&t.setSelected()})};const Wn=h("div",{id:"three"},null,-1),Fn={class:""},Hn={key:0,class:"absolute top-32 left-1/2 transform -translate-x-1/2"},$n=h("h1",{class:"font-callout text-6xl stage"},[h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("span",{class:"opacity-0"},"Air Traffic Control")],-1),jn=[$n],Qn={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},qn=h("div",{class:"absolute inset-0 bg-sky-800 bg-opacity-80"},null,-1),Jn={class:"relative z-10 p-4 rounded bg-white shadow-xl"},Kn=h("h2",{class:"text-lg font-bold"}," Are you sure you want to quit? ",-1),Vn={class:"flex space-x-4 items-center justify-center mt-4"},ts={class:"fixed top-1 left-1/2 transform -translate-x-1/2 bg-white rounded px-4 py-2 font-bold w-20 text-center"},es={class:"fixed bottom-2 right-2 bg-white rounded-lg text-sm shadow-lg overflow-hidden"},ns=h("h2",{class:"font-bold p-4"}," Flight Schedule ",-1),ss={class:"text-center"},os=h("thead",{class:"bg-slate-100"},[h("tr",null,[h("th",{class:"py-1 px-2"}," Time "),h("th",{class:"py-1 px-2"}," Status "),h("th",{class:"py-1 px-2"}," From "),h("th",{class:"py-1 px-2"}," To "),h("th",{class:"py-1 px-2"}," Fuel ")])],-1),is={class:"text-xs"},as=["onClick"],rs={class:"py-1 px-2"},ls={class:"py-1 px-2"},cs={class:"p-2 font-bold"},ds={class:"py-1 px-2"},hs={class:"py-1 px-2"},ps={class:"py-1 px-2"},us={class:"grid grid-cols-3"},ms=["disabled"],gs=["disabled"],fs={class:"grid grid-cols-3"},_s=["disabled","onClick"],ws={setup(i){const{state:t,send:e,service:n}=$e(Ve),s=J(!0),o=Nt(()=>p._board._airplanesQueue.map(v=>p._airplanes.value.find(I=>I._id===v._id)||v)),a=Nt(()=>Yt(p._tick.value));je(()=>{tn(),en(),z.autoRotate=!1,z.enablePan=!0,n.onTransition(async k=>{if(k.changed&&k.matches("introIn")&&(z.autoRotate=!0,O.start(),O.render(),await O.animateIn(),n.send("DONE")),k.changed&&k.matches("introOut")&&(z.enableRotate=!1,z.autoRotate=!1,await O.animateOut(),n.send("DONE")),k.changed&&k.matches("gameIn")){O.reset(),p.start(),p.render();const S=D.position;new g.Tween(S).to({x:80,y:35,z:80},1500).easing(g.Easing.Cubic.InOut).onUpdate(()=>D.position.set(S.x,S.y,S.z)).onComplete(()=>{z.enableRotate=!0,z.enableZoom=!0,n.send("DONE")}).start(),await p.animateIn()}if(k.changed&&k.matches("gamePlaying")&&(z.enableRotate=!0),k.changed&&k.matches("gameOut")){z.enableRotate=!1;const S=D.position;new g.Tween(S).to({x:15,y:9,z:15},1500).easing(g.Easing.Cubic.InOut).onUpdate(()=>D.position.set(S.x,S.y,S.z)).onComplete(()=>{z.enableRotate=!0,z.enableZoom=!0,n.send("DONE")}).delay(500).start(),await p.animateOut(),p.reset()}});let v=0,M=1/60;X.setAnimationLoop(async k=>{v+=nn.getDelta(),pt.begin(),n.state.hasTag("intro")&&O._scene?(X.render(O._scene,D),v>M&&O._animate()):n.state.hasTag("board")&&p._scene&&(X.render(p._scene,D),v>M&&p._animate()),z.update(),g.update(k),pt.end(),v=v%M});const I=()=>{D.aspect=window.innerWidth/window.innerHeight,D.updateProjectionMatrix(),X.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",I,!1),e("INTRO_IN")});const r=()=>{Object.values(X.info).forEach(v=>{console.table({item:v})})},c=async()=>{await p.nextTick()},u=J(!1),f=()=>{u.value=!0},m=()=>{console.log("quit"),u.value=!1,e("GAME_OUT")},d=J(null),x=v=>{p.selectPlane(v),d.value=p._airplanes.value.find(M=>M._isSelected)},E=v=>{d.value&&!d.value._isGhost&&d.value.setHeight(v)},L=v=>{d.value&&!d.value._isGhost&&d.value.setDirection(v)};return(v,M)=>{var I,k,S,et,nt;return W(),F(ct,null,[Wn,h("div",Fn,[Ut(Dt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)]","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:Xt(()=>[T(t).matches("introIdle")?(W(),F("div",Hn,jn)):lt("",!0)]),_:1}),T(t).hasTag("intro")?(W(),F("button",{key:0,class:"fixed top-1 right-1 bg-white rounded px-4 py-2 font-bold",onClick:M[0]||(M[0]=w=>T(e)("INTRO_OUT"))}," Play ")):lt("",!0),T(t).hasTag("board")?(W(),F(ct,{key:1},[h("button",{class:"fixed top-1 right-20 bg-white rounded px-4 py-2 font-bold",onClick:c}," Tick "),h("button",{class:"fixed top-1 right-1 bg-white rounded px-4 py-2 font-bold",onClick:f}," Quit "),Ut(Dt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Xt(()=>[u.value?(W(),F("div",Qn,[qn,h("div",Jn,[Kn,h("div",Vn,[h("button",{class:"rounded py-2 px-6 bg-gray-200",onClick:M[1]||(M[1]=w=>u.value=!1)}," No "),h("button",{class:"rounded py-2 px-6 bg-sky-700 text-white",onClick:m}," Yes ")])])])):lt("",!0)]),_:1}),h("div",ts,B(T(a))+" "+B(T(p)._score),1),h("div",es,[ns,h("div",{class:"absolute top-1 right-1",onClick:M[2]||(M[2]=w=>s.value=!s.value)}," x "),h("div",{class:N(["max-h-64 overflow-auto",s.value?"":"h-0"])},[h("table",ss,[os,h("tbody",is,[(W(!0),F(ct,null,Zt(T(o),(w,Y)=>(W(),F("tr",{key:w._id,class:N([w._landed?"opacity-50":d.value&&d.value._id===w._id?"bg-sky-500":Y%2===0?"bg-slate-50 hover:bg-slate-100":"hover:bg-slate-100","cursor-pointer transition-colors"]),onClick:it=>w._landed?null:x(w._id)},[h("td",rs,[h("div",{class:N(["inline-block rounded-full border px-2",w._startTime<T(p)._tick.value?"bg-green-100 border-green-300 text-green-700":w._startTime===T(p)._tick.value?"bg-orange-100 border-orange-300 text-orange-700":"bg-blue-100 border-blue-300 text-blue-700"])},B(T(Yt)(w._startTime)),3)]),h("td",ls,[h("div",cs,B(w._startTime>T(p)._tick.value?"Scheduled":w._startTime===T(p)._tick.value?"Approaching":w._landed?"Passed":"In flight"),1)]),h("td",ds,[h("div",{class:N(["inline-block rounded-full border px-2",w._start.name.substring(0,2)==="AP"?"bg-orange-100 border-orange-300 text-orange-700":"bg-blue-100 border-blue-300 text-blue-700"])},B(w._start.name),3)]),h("td",hs,[h("div",{class:N(["inline-block rounded-full border px-2",w._end.name.substring(0,2)==="AP"?"bg-orange-100 border-orange-300 text-orange-700":"bg-blue-100 border-blue-300 text-blue-700"])},B(w._end.name),3)]),h("td",ps,[h("div",{class:N(["inline-block rounded-full border px-2",w._fuel<10?"bg-red-100 border-red-300 text-red-700":w._fuel<20?"bg-orange-100 border-orange-300 text-orange-700":"bg-green-100 border-green-300 text-green-700"])},B(w._fuel),3)])],10,as))),128))])])],2)]),h("div",{class:N(["fixed bottom-24 left-2 bg-white rounded-lg text-sm shadow-lg overflow-hidden",!d.value||((I=d.value)==null?void 0:I._isGhost)?"opacity-50":""])},[h("div",us,[h("button",{class:N(["h-8 hover:bg-slate-200 flex items-center justify-center",((k=d.value)==null?void 0:k._targetDirection)<0?"bg-red-500":""]),disabled:(S=d.value)==null?void 0:S._isGhost,onClick:M[3]||(M[3]=w=>L(-1))}," left ",10,ms),Qe(" "+B(d.value?T(rn)(d.value._direction):"N/A")+" ",1),h("button",{class:N(["h-8 hover:bg-slate-200 flex items-center justify-center",((et=d.value)==null?void 0:et._targetDirection)>0?"bg-red-500":""]),disabled:(nt=d.value)==null?void 0:nt._isGhost,onClick:M[4]||(M[4]=w=>L(1))}," right ",10,gs)]),h("div",fs,[(W(),F(ct,null,Zt([9,8,7,6,5,4,3,2,1,0],w=>{var Y;return h("button",{key:w,class:N(["w-8 h-8 hover:bg-slate-200 flex items-center justify-center",d.value&&(d.value._position.y===w||d.value._targetAltitude===w)?"bg-red-500":""]),disabled:(Y=d.value)==null?void 0:Y._isGhost,onClick:it=>E(w)},B(w),11,_s)}),64))])],2)],64)):lt("",!0),h("button",{class:"fixed bottom-1 left-1 bg-white rounded px-4 py-2 font-bold",onClick:r}," Stats ")])],64)}}};qe(ws).mount("#app");
