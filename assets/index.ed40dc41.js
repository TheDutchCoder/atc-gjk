import{c as rn,a as ln,i as cn,r as nt,S as dn,W as hn,P as un,b as pn,O as mn,V as _e,e as m,C as gn,M as _t,B as ut,d as T,f as A,G as Q,m as Z,g as y,h as fn,D as wn,j as ye,I as lt,E as be,F as _n,T as ve,k as Dt,l as se,w as gt,H as xe,n as Rt,o as Qt,v as yn,p as ae,t as bn,q as ht,s as Y,u as U,x as h,y as ft,z as _,A as vn,J as xn,K as kn,R as zn,L as Mn,N as z,Q as J,U as M,X as Ot,Y as tt,Z as P,_ as W,$ as En,a0 as oe,a1 as In,a2 as Sn,a3 as Cn,a4 as Pn}from"./vendor.5f15e3e4.js";const Ln=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}};Ln();const On=rn({id:"main",initial:"loading",context:{difficulty:0},states:{loading:{on:{INTRO_IN:"introIn"}},introIn:{tags:"intro",on:{DONE:"introIdle"}},introIdle:{tags:"intro",on:{INTRO_OUT:"introOut",DIFFICULTY:{actions:["setDifficulty"]}}},introOut:{tags:"intro",on:{DONE:"gameIn"}},gameIn:{tags:"board",on:{DONE:"gamePlaying"}},gamePlaying:{tags:"board",initial:"playing",states:{playing:{on:{LOSE:"lose",WIN:"win",QUIT:"quit"}},lose:{on:{DONE:"#main.gameOut"}},win:{on:{DONE:"#main.gameOut"}},quit:{on:{DONE:"#main.gameOut",CANCEL:"playing"}}},on:{GAME_OUT:"gameOut"}},gameOut:{tags:"board",on:{DONE:"introIn"}}}},{actions:{setDifficulty:ln({difficulty:l=>(l.difficulty+1)%3})}}),S=cn(On).start(),D=nt(S.state);S.onTransition(l=>D.value=l);const ie=new dn,An=()=>{const l=document.getElementById("three");l.innerHTML="",l.appendChild(rt.domElement)},rt=new hn({antialias:!0,alpha:!0,shadow:!0});rt.setSize(window.innerWidth,window.innerHeight);rt.shadowMap.enabled=!0;rt.shadowMap.type=un;const O=new pn(50,window.innerWidth/window.innerHeight,1,1e3);O.position.set(15,9,15);const I=new mn(O,rt.domElement);I.enableDamping=!0;I.enableRotate=!0;I.enableZoom=!0;I.enablePan=!1;I.autoRotate=!0;I.autoRotateSpeed=-2;const Gn=new _e(0,0,0),Tn=()=>{const l=I.target,t=Gn;new m.Tween(l).to(t,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>I.target=l).start();const e={x:O.position.x,y:O.position.y,z:O.position.z},n={x:80,y:35,z:80};new m.Tween(e).to(n,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{O.position.set(e.x,e.y,e.z),I.update()}).start()},Xn=new gn,E=(l,t,e,n,s,a=!0)=>{[[0,11,17],[1,9,20],[2,13,19],[3,15,22],[5,10,16],[4,8,21],[7,12,18],[6,14,23]][l].forEach(r=>{let c,d,i,u=t.attributes.position.getX(r),p=t.attributes.position.getY(r),g=t.attributes.position.getZ(r);a?(c=e?u+e:u,d=n?p+n:p,i=s?g+s:g):(c=e||u,d=n||p,i=s||g),t.attributes.position.setXYZ(r,c,d,i)}),t.attributes.position.needsUpdate=!0},wt=(l,t,e)=>{const n=Math.round(Math.random()*(t*1e5-l*1e5)+l*1e5)/1e5;return e&&n>=e.min&&n<=e.max?wt(l,t,e):n},k=(l,t,e)=>{let n=Math.round(Math.random()*(t-l)+l);return n===e&&(n=k(l,t,e)),n},H=(l,t=!1)=>{const e=Math.floor(Math.random()*l.length),n=l[e];return t&&l.splice(e,1),n},St=(l,t,e)=>{var n=+l.replace("#","0x"),s=n>>16,a=n>>8&255,o=n&255,r=+t.replace("#","0x"),c=r>>16,d=r>>8&255,i=r&255,u=s+e*(c-s),p=a+e*(d-a),g=o+e*(i-o);return"#"+((1<<24)+(u<<16)+(p<<8)+g|0).toString(16).slice(1)},Dn=(l,t,e,n=0)=>{const s=JSON.parse(JSON.stringify(l)),a=JSON.parse(JSON.stringify(l));if(n>0&&(a.splice(-n),a.splice(0,n),a.forEach(u=>{u.splice(-n),u.splice(0,n)})),a.flat(2).every(u=>!!u))return null;const o=0-Math.floor(t/2),r=0-Math.floor(e/2);let c,d;do c=k(n,t-n-1),d=k(n,e-n-1);while(s[d][c]);return{tile:{x:c+o,y:0,z:d+r},x:c,z:d}},ke=(l,t,e={width:0,direction:0})=>{const{width:n,direction:s}=e,a=n/2;let o,r,c=wt(l,t),d=0,i=wt(l,t);for(s===0||s==4?(o=u=>u>a||u<-a,r=()=>!0):s===3||s==7?(o=()=>!0,r=(u,p)=>p>u+a||p<u-a):s===2||s==6?(o=()=>!0,r=(u,p)=>p>a||p<-a):(s===1||s==5)&&(o=()=>!0,r=(u,p)=>p>-u+a||p<-u-a);!o(c);)c=wt(l,t);for(;!r(c,i);)i=wt(l,t);return{x:c,y:d,z:i}},ze=(l,t,e,n=1)=>{const s=Math.ceil(0-t/2),a=Math.abs(s),o=Math.ceil(0-e/2),r=Math.abs(o),{x:c,z:d}=l;return c===s-n?d===o-n?3:d===r+n?1:2:c===a+n?d===o-n?5:d===r+n?7:6:d===o-n?4:0},Rn=(l,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),a=Math.ceil(0-e/2),o=Math.abs(a),{x:r,z:c}=l;return r===n-1?c===a-1?7:c===o+1?5:6:r===s+1?c===a-1?1:c===o+1?3:2:c===a-1?0:4},Gt=(l,t)=>{let{x:e,y:n,z:s}=l;return t===0?s--:t===1?(e++,s--):t===2?e++:t===3?(e++,s++):t===4?s++:t===5?(e--,s++):t===6?e--:t===7&&(e--,s--),{x:e,y:n,z:s}},Yn=(l,t)=>{let{x:e,y:n,z:s}=l;return t===0?s++:t===1?(e--,s++):t===2?e--:t===3?(e--,s--):t===4?s--:t===5?(e++,s--):t===6?e++:t===7&&(e++,s++),{x:e,y:n,z:s}},re=l=>{const t=Math.floor(l/4).toString(),e=(l%4*15).toString();return`${t.padStart(2,"0")}:${e.padStart(2,"0")}`},Un=(l,t,e)=>{const n=Math.ceil(0-l/2),s=Math.abs(n),a=2,o=e-2,r=Math.ceil(0-t/2),c=Math.abs(r),d=[n,s,0],i=[r,c],u=[r,c,0],p=H(d),g=k(a,o),b=H(p===0?i:u),x={x:p,y:g,z:b},$=ze(x,l,t,0);return{position:x,direction:$}},Nn=(l,t,e,n)=>{const s=Math.random()>.7,a=Math.ceil(0-l/2)-1,o=Math.abs(a),r=Math.ceil(0-t/2)-1,c=Math.abs(r),d=[a,o,0],i=[r,c],u=[r,c,0],p=H(d),g=Math.ceil(Math.random()*e),b=H(p===0?i:u),x={x:p,y:g,z:b};return s?Me(n):{position:x,direction:ze(x,l,t),name:`${Ee(x)}${g}`}},le=(l,t,e,n)=>{const s=Math.random()>.3,a=Math.ceil(0-l/2)-1,o=Math.abs(a),r=Math.ceil(0-t/2)-1,c=Math.abs(r),d=[a,o,0],i=[r,c],u=[r,c,0],p=H(d),g=Math.ceil(Math.random()*e),b=H(p===0?i:u),x={x:p,y:g,z:b};return s?Me(n):{position:x,direction:Rn(x,l,t),name:`${Ee(x)}${g}`}},Me=l=>H(l),Ee=l=>{const{x:t,z:e}=l;if(t===0){if(e>0)return"S";if(e<0)return"N"}else if(t<0){if(e<0)return"NW";if(e===0)return"W";if(e>0)return"SW"}else if(t>0){if(e<0)return"NE";if(e===0)return"E";if(e>0)return"SE"}},Zn=(l=0)=>{if(l===0)return{x:0,z:1};if(l===1)return{x:-1,z:1};if(l===2)return{x:-1,z:0};if(l===3)return{x:-1,z:-1};if(l===4)return{x:0,z:-1};if(l===5)return{x:1,z:-1};if(l===6)return{x:1,z:0};if(l===7)return{x:1,z:1}},Ie=["EASY","NORMAL","HARD"],ce={EASY:{width:11,depth:11},NORMAL:{width:15,depth:15},HARD:{width:21,depth:21}},de={EASY:{min:1,max:2},NORMAL:{min:2,max:3},HARD:{min:3,max:5}},At={EASY:{count:{min:1,max:1},size:{min:2,max:2}},NORMAL:{count:{min:1,max:2},size:{min:2,max:3}},HARD:{count:{min:1,max:3},size:{min:3,max:5}}},Ct={EASY:{amount:24,height:6},NORMAL:{amount:48,height:7},HARD:{amount:96,height:8}},C={SCHEDULED:"Scheduled",APPROACHING:"Approaching",IN_FLIGHT:"In flight",OBSTRUCTED:"Obstructed",LANDED:"Landed",EXITED:"Exited",LOST:"Lost",CRASHED:"Crashed"},Bn=new _t({color:10053706,flatShading:!0});class $n{_tile=null;_dirt=null;constructor(){}add(t={scale:{x:1,y:1,z:1}}){this._tile=t}reset(){this._tile=null,this._dirt=null}create(){const t=new ut(10,3,10);return t.translate(0,-2.5,0),t.scale(this._tile.scale.x,this._tile.scale.y,this._tile.scale.z),this._dirt=new T(t,Bn),this._dirt.scale.setScalar(0),this._dirt}animateIn(){return this._tile?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tile?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._dirt.scale.setScalar(t.scale)}}const qt=new $n;class Vt{_position={x:0,y:0,z:0};_model=null;_hasAnimations=!1;_isAnimating=!1;_shouldBeRemoved=!1;_tick=0;displayName="";constructor({position:t={x:0,y:0,z:0}}={}){this._position=t}updatePosition(){this._model.position.x=this._position.x*10,this._model.position.y=this._position.y*5,this._model.position.z=this._position.z*10}get position(){return this._position}set position(t){this._position=t,this.updatePosition()}get model(){return this._model}set model(t){this._model=t,this.updatePosition(),this._hasAnimations}get isAnimating(){return this._isAnimating}set isAnimating(t){this._isAnimating=t}}const Wt=10,Fn=1,Ht=10,Wn=new _t({color:11984276,flatShading:!0}),Hn=new _t({color:10010486,flatShading:!0}),jn=l=>{const t=l.getAttribute("position");for(let e=0;e<t.count;e++){const n=new _e;if(n.fromBufferAttribute(t,e),n.y>=.5&&n.x!==-5&&n.x!==5&&n.z!==-5&&n.z!==5){const s=.15-Math.random()*.3,a=Wt/40-Math.random()*(Wt/20),o=Ht/40-Math.random()*(Ht/20);t.setXYZ(e,n.x+a,n.y+s,n.z+o)}}l.attributes.position.needsUpdate=!0};class Qn{_tiles=[];_grassLight=new A;_grassDark=new A;_grassAll=new Q;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._grassLight=new A,this._grassDark=new A,this._grassAll=new Q}create(){const t=[],e=[];if(this._tiles.forEach(n=>{const s=new ut(10,1,10,Wt,Fn,Ht);jn(s),s.rotateY(k(0,4)*2*(-Math.PI/4)),s.translate(n.position.x*10,-.5+n.position.y*5,n.position.z*10),n.position.x&1&&n.position.z&1||!(n.position.x&1)&&!(n.position.z&1)?t.push(s):e.push(s)}),this._tiles.length){if(t.length){const n=Z(t);this._grassLight=new T(n,Wn),this._grassLight.receiveShadow=!0}if(e.length){const n=Z(e);this._grassDark=new T(n,Hn),this._grassDark.receiveShadow=!0}this._grassAll.add(this._grassLight,this._grassDark),this._grassAll.scale.setScalar(0)}return this._grassAll}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(250).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._grassAll.scale.setScalar(t.scale)}}const Ut=new Qn,qn="#ffff00",Vn=new y(11371131),Kn=new y(10473352),Jn=new y(9157493),ts=new y(13617032),es=new y(13340781),Se=new y(11910596),Ce=new y(9542564),Pe=new y(7964047),Le=new y(5857641);new y(11910596);new y(9542564);new y(7964047);const ns=new y(5124632),ss=new y(6307874),as=new y(5914664),os=new y(15658734);new y(16711680);new y(65280);new y(255);const is=new y(0),rs=new y(16751104),ls=new y(16711680),Oe=new y(65280),he=new y(11371131),R=new _t({flatShading:!0}),Tt=new _t({flatShading:!0,transparent:!0,opacity:.75}),cs=new _t({flatShading:!0,transparent:!0,opacity:.85}),N=new ut(1,1,1),Xt=new fn(.3,2,4),Ae=new wn(1,0),ds=new ye(1,1,1,8),hs=new ye(.5,1,1,8);new ut(2,.15,.2);new ut(.1,.1,10);const us=new ut(3,.2,9),ps=new ut(.2,.05,.75),ue=new ut(.2,.2,.2),pe=[Kn,Jn,ts,es],mt=new A;class ms{_tiles=[];_trunk=null;_foliage=null;_trees=new Q;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._trunk=null,this._foliage=null,this._trees=new Q,this._instances=[]}create(){let t=0;if(this._tiles.forEach(e=>{const n=k(20,30);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:ke(-4.75,4.75,e.exclude),rot:{x:wt(-.12,.12),y:wt(-.12,.12),z:0},scale:.5+Math.random()*.75,color:pe[k(0,pe.length-1)],tile:e})}),this._tiles.length){this._trunk=new lt(Xt.clone(),R,t),this._trunk.castShadow=!0;const e=Xt.clone();e.scale(1.3,1.3,1.3),e.translate(0,.5,0);const n=Xt.clone();n.scale(1.1,1.1,1.1),n.translate(0,1.1,0);const s=Z([e,n]);this._foliage=new lt(s,R,t),this._foliage.castShadow=!0,this._foliage.receiveShadow=!0,this._trunk.geometry.computeBoundingBox(),this._foliage.geometry.computeBoundingBox(),this._trunk.geometry.translate(0,this._trunk.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,this._foliage.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,.3,0),this._trees.add(this._trunk,this._foliage)}return this._trees}updateInstance(t,e,n){const{pos:s,rot:a,scale:o,color:r,tile:c}=t,{x:d,y:i,z:u}=s,{x:p,y:g,z:b}=a,x=new be(p,g,b,"XYZ");mt.position.set(d+c.position.x*10,(i+c.position.y*5)*o,u+c.position.z*10),mt.setRotationFromEuler(x),mt.scale.set(n.x,n.y,n.z),mt.updateMatrixWorld(!0),this._trunk.setMatrixAt(e,mt.matrixWorld),this._trunk.setColorAt(e,Vn),mt.updateMatrixWorld(!0),this._foliage.setMatrixAt(e,mt.matrixWorld),this._foliage.setColorAt(e,r),this._trunk.instanceMatrix.needsUpdate=!0,this._trunk.instanceColor.needsUpdate=!0,this._foliage.instanceMatrix.needsUpdate=!0,this._foliage.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:0,y:0,z:0},o={x:s,y:s,z:s};this.updateInstance(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:s,y:s,z:s},o={x:0,y:0,z:0};new m.Tween(a).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(500,750)).start()})}):Promise.resolve()}}const Nt=new ms,me=[Se,Ce,Pe,Le],Pt=new A;class gs{_tiles=[];_rock=new A;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._rock=new A,this._instances=[]}create(){let t=0;return this._tiles.forEach(e=>{const n=k(6,12);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:ke(-4.5,4.5,e.exclude),rot:{x:-.1+Math.random()*.2,y:Math.PI/2*Math.random(),z:-.1+Math.random()*.2},scale:.1+Math.random()*.3,color:me[k(0,me.length-1)],tile:e})}),this._tiles.length&&(this._rock=new lt(Ae,R,t),this._rock.castShadow=!0,this._rock.receiveShadow=!0),this._rock}updateInstance(t,e,n){const{pos:s,rot:a,scale:o,color:r,tile:c}=t,{x:d,y:i,z:u}=s,{x:p,y:g,z:b}=a;Pt.position.set(d+c.position.x*10,(i+c.position.y+n.y)*o,u+c.position.z*10),Pt.rotation.set(p,g,b),Pt.scale.set(n.x,n.y,n.z),Pt.updateMatrixWorld(!0),this._rock.setMatrixAt(e,Pt.matrixWorld),this._rock.setColorAt(e,r),this._rock.instanceMatrix.needsUpdate=!0,this._rock.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:0,y:0,z:0},o={x:s,y:s,z:s};this.updateInstance(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:s,y:s,z:s},o={x:0,y:0,z:0};this.updateInstance(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(500,750)).start()})}):Promise.resolve()}}const Zt=new gs;class Ge extends Vt{constructor({position:t={x:0,y:0,z:0}}={}){super({position:t});this.create()}create(){Ut.add({position:this._position}),Nt.add({position:this._position}),Zt.add({position:this._position})}}const ge=[ns,ss,as],at=new A;class fs{_tiles=[];_beams=null;_rails=null;_beamInstances=[];_railInstances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._beams=null,this._rails=null,this._beamInstances=[],this._railInstances=[]}create(){const t=new Q;let e=0,n=0;if(this._tiles.forEach(s=>{const o=s.direction===2||s.direction===6;e+=11;for(let r=0;r<11;r++)this._beamInstances.push({pos:{x:o?-4.6+r*10/11:0,y:0,z:o?0:-4.6+r*10/11},rot:{x:0,y:-.08+Math.random()*.16+(o?Math.PI/2:0),z:0},color:ge[k(0,ge.length-1)],tile:s});n+=2;for(let r=0;r<2;r++)this._railInstances.push({pos:{x:o?0:-.7+r*1.4,y:.2,z:o?-.7+r*1.4:0},rot:{x:0,y:o?Math.PI/2:0,z:0},color:os,tile:s})}),this._tiles.length){const s=N.clone();s.scale(2,.3,.3),this._beams=new lt(s,R,e),this._beams.castShadow=!0,this._beams.receiveShadow=!0;const a=N.clone();a.scale(.2,.2,10),this._rails=new lt(a,R,n),this._rails.castShadow=!0,this._rails.receiveShadow=!0,t.add(this._beams,this._rails)}return t}updateBeamInstance(t,e,n){const{pos:s,rot:a,color:o,tile:r}=t,{x:c,y:d,z:i}=s,{x:u,y:p,z:g}=a;at.position.set(c+r.position.x*10,d+r.position.y*5,i+r.position.z*10),at.rotation.set(u,p,g),at.scale.set(n.x,n.y,n.z),at.updateMatrixWorld(!0),this._beams.setMatrixAt(e,at.matrixWorld),this._beams.setColorAt(e,o),this._beams.instanceMatrix.needsUpdate=!0,this._beams.instanceColor.needsUpdate=!0}updateRailInstance(t,e,n){const{pos:s,rot:a,color:o,tile:r}=t,{x:c,y:d,z:i}=s,{x:u,y:p,z:g}=a;at.position.set(c+r.position.x*10,d+n.y+r.position.y*10,i+r.position.z*10),at.rotation.set(u,p,g),at.scale.set(n.scale,n.scale,n.scale),at.updateMatrixWorld(!0),this._rails.setMatrixAt(e,at.matrixWorld),this._rails.setColorAt(e,o),this._rails.instanceMatrix.needsUpdate=!0,this._rails.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:0,y:0,z:0},a={x:1,y:1,z:1};this.updateBeamInstance(e,n,s),new m.Tween(s).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(k(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:5,scale:0},a={y:0,scale:1};this.updateRailInstance(e,n,s),new m.Tween(s).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(k(750,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:1,y:1,z:1},a={x:0,y:0,z:0};new m.Tween(s).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(k(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:0,scale:1},a={y:5,scale:0};new m.Tween(s).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(k(750,1e3)).start()})}):Promise.resolve()}}const Te=new fs;class jt extends Vt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){Ut.add({position:this._position}),Nt.add({position:this._position,exclude:{width:3,direction:this._direction}}),Zt.add({position:this._position,exclude:{width:3,direction:this._direction}}),Te.add({position:this._position,direction:this._direction})}}var ws="/atc-gjk/assets/helvetiker_regular.typeface.d5c54676.json",_s="/atc-gjk/assets/helvetiker_bold.typeface.bd68159e.json";const ys=new _n,bs=async l=>new Promise((t,e)=>{ys.load(l,n=>t(n),null,n=>e(n))}),vs=[ws,_s],Xe=await Promise.all(vs.map(async l=>await bs(l)));Xe[0];const De=Xe[1],Re=R.clone();Re.color.set(is);const Ye=R.clone();Ye.color.set(rs);const Ue=R.clone();Ue.color.set(Oe);const Ne=R.clone();Ne.color.set(ls);const Ze=R.clone();Ze.color.set(qn);class xs{_tiles=[];_airstrip=null;_strips=null;_stripes=null;_greenLightMeshes=null;_greenLights=null;_redLightMeshes=null;_redLights=null;_label=null;_tick=0;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._airstrip=null,this._strips=null,this._stripes=null,this._greenLightMeshes=null,this._redLightMeshes=null,this._greenLights=null,this._redLights=null,this._label=null,this._tick=0}create(){this._airstrip=new Q,this._greenLights=new Q,this._redLights=new Q;const t=[],e=[],n=[],s=[],a=[];if(this._tiles.forEach((o,r)=>{const c=us.clone();c.rotateY(o.direction*Math.PI/-4),c.translate(o.position.x*10,.1+o.position.y*5,o.position.z*10),t.push(c);for(let b=0;b<7;b++){const x=ps.clone();x.translate(0,0,-3+b),x.rotateY(o.direction*Math.PI/-4),x.translate(o.position.x*10,.2+o.position.y*5,o.position.z*10),e.push(x)}for(let b=0;b<5;b++){const x=ue.clone();x.translate(-1+b*.5,0,4),x.rotateY(o.direction*Math.PI/-4),x.translate(o.position.x*10,o.position.y*5,o.position.z*10),n.push(x);const $=ue.clone();$.translate(-1+b*.5,0,-4),$.rotateY(o.direction*Math.PI/-4),$.translate(o.position.x*10,o.position.y*5,o.position.z*10),s.push($)}const d=new ve(`AP${r+1}`,{font:De,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});d.center(),d.scale(.01,.01,.01),d.translate(0,-3,0),d.rotateX(Math.PI/-2),d.rotateY(o.direction*Math.PI/-4),d.translate(o.position.x*10,.2+o.position.y*5,o.position.z*10),a.push(d);const i=new A,u=new Dt(65280,1.2,3);u.translateX(-1.5),u.translateZ(4),u.visible=!1,i.add(u),i.translateX(o.position.x*10),i.translateY(.5),i.translateZ(o.position.z*10),i.rotateY(o.direction*Math.PI/-4);const p=new A,g=new Dt(16711680,1.2,3);g.translateX(1.5),g.translateZ(-4),g.visible=!1,p.add(g,g),p.translateX(o.position.x*10),p.translateY(.5),p.translateZ(o.position.z*10),p.rotateY(o.direction*Math.PI/-4),this._greenLights.add(i),this._redLights.add(p)}),this._tiles.length){const o=Z(t),r=Z(e),c=Z(n),d=Z(s),i=Z(a);this._strips=new T(o,Re),this._stripes=new T(r,Ye),this._greenLightMeshes=new T(c,Ue),this._redLightMeshes=new T(d,Ne),this._labels=new T(i,Ze),this._greenLightMeshes.position.y=.2,this._redLightMeshes.position.y=.2,this._airstrip.add(this._strips,this._stripes,this._greenLightMeshes,this._redLightMeshes,this._labels,this._greenLights,this._redLights)}return this._airstrip}_animate=()=>{this._greenLights.children.forEach(t=>{if(this._tick>=160){const e=this._tick%160;(e===0||e===10||e===20||e===30||e===40)&&(t.children[0].visible=!0,t.translateX(.5)),e===41&&(t.children[0].visible=!1),e===159&&(t.children[0].visible=!0,t.translateX(-2.5))}}),this._redLights.children.forEach(t=>{if(this._tick>=160){const e=this._tick%160;(e===50||e===60||e===70||e===80||e===90)&&(t.children[0].visible=!0,t.translateX(.5)),e===91&&(t.children[0].visible=!1),e===49&&(t.children[0].visible=!0,t.translateX(-2.5))}}),this._tick++};animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._airstrip.scale.setScalar(t.scale)}}const Yt=new xs;class Be extends Vt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){Ut.add({position:this._position}),Nt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Zt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Yt.add({position:this._position,direction:this._direction})}}const fe=[Se,Ce,Pe,Le],et=new A;class ks{_tiles=[];_clouds=new A;_animate=()=>{};_instances=[];_tick=0;_pause=!1;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._clouds=new A,this._animate=()=>{},this._instances=[],this._tick=0}create(){let t=0;return this._tiles.forEach(e=>{const n=k(12,24);t+=n;const s=fe[k(0,fe.length-1)],a=k(5,9);for(let o=0;o<n;o++)this._instances.push({pos:{x:-4.8+Math.random()*9.6,y:-.4+Math.random()*.8,z:-4.8+Math.random()*9.6},rot:{x:Math.PI*2*Math.random(),y:Math.PI*2*Math.random(),z:Math.PI*2*Math.random()},altitude:e.position.y||a,animation:{direction:Math.random()>.5?1:-1,speed:k(200,300)},scale:.5+Math.random()*1.5,color:s,isReady:!1,tile:e})}),this._clouds=new lt(Ae,cs,t),this._animate=()=>{this._pause||(this._instances.forEach((e,n)=>{const{isReady:s}=e;s&&this.updateInstance(e,n)}),this._tick++)},this._clouds}async next(t=0){await this.animateNext(t)}updateInstance(t,e,n){const{pos:s,rot:a,scale:o,color:r,animation:c,tile:d,altitude:i}=t,{x:u,y:p,z:g}=s,{x:b,y:x,z:$}=a,{direction:vt,speed:v}=c,f=Math.sin((this._tick+e*50)/10/Math.PI)/20;et.position.set(u+d.position.x*10,i*5+(p+f)*o,g+d.position.z*10),et.rotation.set(b,x,$+this._tick/v*vt),n?et.scale.set(n.x,n.y,n.z):et.scale.setScalar(o),et.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,et.matrixWorld),this._clouds.setColorAt(e,r),this._clouds.instanceMatrix.needsUpdate=!0,this._clouds.instanceColor.needsUpdate=!0}updateInstancePosition(t,e,n){const{pos:s,altitude:a,scale:o,rot:r,animation:c}=t,{x:d,y:i,z:u}=r,{direction:p,speed:g}=c,b=Math.sin((this._tick+e*50)/10/Math.PI)/20;et.position.set(s.x+n.x*10,a*5+(s.y+b)*o,s.z+n.z*10),et.rotation.set(d,i,u+this._tick/g*p),et.scale.setScalar(o),et.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,et.matrixWorld),this._clouds.instanceMatrix.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:0,y:0,z:0},o={x:s,y:s,z:s};this.updateInstance(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(()=>{e.isReady=!0,t()}).delay(k(1e3,1250)).start()})}):Promise.resolve()}async animateNext(){return this._tiles.length?new Promise(t=>{this._pause=!0,this._instances.forEach((e,n)=>{const s=Gt(e.tile.position,e.tile.direction),a=e.tile.position,o=s;this.updateInstancePosition(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>this.updateInstancePosition(e,n,a)).onComplete(()=>{this._pause=!1,t()}).delay(k(250,500)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:s,y:s,z:s},o={x:0,y:0,z:0};this.updateInstance(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Elastic.In).onStart(()=>e.isReady=!1).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(250,500)).start()})}):Promise.resolve()}}const bt=new ks,zs=new y(16777215),Ms=l=>{const t=N.clone();t.scale(1,1,2),E(0,t,-.2,-.1),E(2,t,-.2,.3),E(4,t,.2,-.1),E(6,t,.2,.3);const e=N.clone();e.scale(3,.1,1),E(1,e,.2,.05),E(3,e,.2,-.05),E(5,e,-.2,.05),E(7,e,-.2,-.05);const n=N.clone();n.scale(.1,.75,.5),n.translate(0,.5,.95),E(0,n,-.04,.05),E(2,n,-.04),E(3,n,0,-.05),E(4,n,.04,.05),E(6,n,.04),E(7,n,0,-.05);const s=N.clone();s.scale(.4,.5,.6);const a=s.clone();a.translate(0,-.3,.6),a.rotateX(-.2);const o=s.clone();o.translate(.3,-.3,-.65);const r=s.clone();r.translate(-.3,-.3,-.65);const c=Z([t,e,n,a,o,r]),d=N.clone();d.scale(.7,.4,.05),d.translate(0,.5,-.7),d.rotateX(.2),E(0,d,-.05),E(1,d,-.05),E(4,d,.05),E(5,d,.05);const i=Z([d]),u=N.clone();u.scale(1,1,.5),u.translate(0,0,-1.25),E(1,u,-.1,-.1),E(3,u,-.1,.1),E(5,u,.1,-.1),E(7,u,.1,.1);const p=N.clone();p.scale(.1,.1,.5),E(2,p,null,null,.01),E(1,p,null,null,-.009),E(3,p,null,null,-.009),E(7,p,null,null,-.01);const g=p.clone();g.rotateZ(Math.PI/4),g.rotateY(.2),g.translate(.5,.2,-1.05);const b=p.clone();b.rotateZ(Math.PI/4),b.translate(.55,.2,-.55);const x=p.clone();x.rotateZ(Math.PI/4)+Math.PI/2,x.rotateY(-.2),x.translate(-.5,.2,-1.05);const $=p.clone();$.rotateZ(Math.PI/4),$.translate(-.55,.2,-.55);const vt=Z([u,g,b,x,$]),v=N.clone();v.scale(.2,.2,.2),v.translate(0,0,-1.55),E(0,v,.07,.07),E(2,v,.07,-.07),E(4,v,-.07,.07),E(6,v,-.07,-.07);const f=N.clone();f.scale(.2,.4,.4);const w=f.clone();w.translate(0,-.6,.6),w.rotateX(-.2);const B=f.clone();B.translate(-.3,-.6,-.65);const q=f.clone();q.translate(.3,-.6,-.65);const ct=Z([v,w,B,q]),F=N.clone();F.scale(.15,1.5,.05),F.translate(0,0,-1.6);const j=F.clone();j.rotateZ(Math.PI/2);const xt=Z([F,j]),yt=N.clone();yt.scale(.34,.2,.2);const kt=yt.clone();kt.translate(0,-.6,.6),kt.rotateX(-.2);const G=yt.clone();G.translate(-.3,-.6,-.65);const X=yt.clone();X.translate(.3,-.6,-.65);const st=Z([kt,G,X]),ot=Xt.clone();ot.scale(1.2,.42,1.2),ot.rotateX(Math.PI),ot.translate(0,2,0);const V=Z([ot]),pt=N.clone();pt.scale(.1,.1,.1),pt.translate(1.7,0,-.5);const zt=N.clone();zt.scale(.1,.1,.1),zt.translate(-1.7,0,-.5);const Mt=new Q;Mt.name="plane";const K=R.clone();K.color.set(l),K.name="base";const Bt=Tt.clone(),Lt=R.clone(),Kt=R.clone(),$t=R.clone(),Jt=R.clone(),te=Tt.clone(),ee=Tt.clone(),We=new y(14872564),He=new y(0),je=new y(10053706),Qe=new y(16777215),qe=new y(65280),Ve=new y(65280),Ke=new y(16711680);Bt.color.set(We),Lt.color.set(Qe),Kt.color.set(je),$t.color.set(He),Jt.color.set(qe),te.color.set(Ve),ee.color.set(Ke);const Je=new T(c,K),tn=new T(i,Bt),en=new T(vt,Lt),nn=new T(ct,$t),ne=new T(xt,$t);ne.name="props";const sn=new T(st,Kt),Ft=new T(V,Jt);Ft.name="selector",Ft.visible=!1;const an=new T(pt,te),on=new T(zt,ee),Et=new Dt(65280,1.2,3);Et.name="green",Et.translateX(1.7),Et.translateY(0),Et.translateZ(-.6);const It=new Dt(16711680,1.2,3);return It.name="red",It.translateX(-1.7),It.translateY(0),It.translateZ(-.6),Mt.add(Je,tn,en,nn,ne,sn,Ft,an,on,Et,It),Mt};class $e{_startTime=0;_position={x:0,y:0,z:0};_direction=0;_targetAltitude=0;_targetDirection=0;_start=null;_end=null;_spawned=!1;_takenOff=!1;_landed=!1;_isGhost=!1;_isSelected=!1;_name="";_id=null;_color=null;_model=null;_tick=0;_fuel=0;_flightStatus=C.SCHEDULED;constructor(t){const{id:e,start:n,end:s,fuel:a,startTime:o}=t;return this._start=n,this._end=s,this._position=n.position,this._direction=n.direction,this._targetAltitude=this._position.y||1,this._takenOff=this._position.y!==0,this._id=e,this._name="GJK",this._color=new y(Math.random()*16777215),this._fuel=a,this._startTime=o,this.create(),this}animate=()=>this.animateIdle();updateAnimation(t){this._model.position.x=t.position.x*10,this._model.position.y=t.position.y*5,this._model.position.z=t.position.z*10,this._model.scale.setScalar(t.scale)}animateIn(t=1250,e=500){return new Promise(n=>{const{_position:s,_direction:a}=this;let o,r;this._takenOff?(o={position:Yn({...s},a),direction:a,scale:0},r={position:{...s},direction:a,scale:1}):(o={position:{...s},direction:a,scale:0},r={position:{...s},direction:a,scale:1},o.position.y=.18,r.position.y=.18),this.updateAnimation(o),new m.Tween(o).to(r,e).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateAnimation(o)).onComplete(n).delay(t).start()})}animateOut(t=0,e=500){return new Promise(n=>{const{_position:s,_direction:a}=this,o={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._direction,scale:1},r={position:Gt(s,a),direction:this._direction,scale:0};this.updateAnimation(o),new m.Tween(o).to(r,e).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateAnimation(o)).onComplete(n).delay(t).start()})}animateIdle(){const t=Math.sin(this._tick/10/Math.PI)/100,e=Math.sin(this._tick/15/Math.PI)/10,n=Math.sin(this._tick/20/Math.PI)/20;this._position.y>=1&&(this._model.position.y+=t,this._model.rotation.z=e,this._model.rotation.x=n),this._model.children.forEach(s=>{s.name==="props"&&(s.rotation.z+=.3),s.name==="selector"&&(s.rotation.y+=.01,s.position.y+=t),s.name==="green"&&(this._tick%120===0&&(s.visible=!0),this._tick%120===4&&(s.visible=!1)),s.name==="red"&&(this._tick%120===40&&(s.visible=!0),this._tick%120===44&&(s.visible=!1))}),this._tick++}create(){const t=Ms(this._color);t.position.x=this._position.x*10,t.position.z=this._position.z*10,t.position.y=this._position.y*5,t.rotation.y=this._direction*(Math.PI/-4),this._takenOff||t.rotateX(.1),t._id=this._id,this._model=t}async next(t=0,e=1){const n=Gt(this._position,this._direction);let s=0,a=0;this._targetAltitude>this._position.y?s=1:this._targetAltitude<this._position.y&&(s=-1),this._targetDirection>0?(this._targetDirection--,a=1):this._targetDirection<0&&(this._targetDirection++,a=-1),await this.animateNext(s,a,t,e,this._takenOff?0:.1),this.unsetGhost(),this._takenOff=!0,this._flightStatus=C.IN_FLIGHT,n.y+=s,this._position=n,this._direction=(8+(this._direction+a))%8,this._model.rotation.y=this._direction*(Math.PI/-4),this._fuel-=1}async animateNext(t,e,n=0,s=1){return new Promise(a=>{const o={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._model.rotation.y,scale:s},r=Gt(this._position,this._direction);r.y+=t,r.y===0&&(r.y=.18);const c={position:r,direction:this._model.rotation.y+e*Math.PI/-4,scale:1};new m.Tween(o).to(c,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>this.updateAnimation(o,this._targetDirection>0)).onComplete(a).delay(n).start()})}setGhost(){this._isGhost=!0,this._model.children.forEach(t=>{t.material&&t.material.name==="base"&&t.material.color.set(zs),t.material&&t.material.name!=="selector"&&(t.material.transparent=!0,t.material.opacity=.75,t.material.needsUpdate=!0)})}unsetGhost(){this._isGhost=!1,this._model.children.forEach(t=>{t.material&&t.material.name==="base"&&t.material.color.set(this._color),t.material&&t.material.name!=="selector"&&(t.material.transparent=!1,t.material.opacity=1,t.material.needsUpdate=!0)})}setSpawned(){this._spawned=!0,this._flightStatus=C.APPROACHING}setExited(){this._flightStatus=C.EXITED}setLanded(){this._flightStatus=C.LANDED}setLost(){this._flightStatus=C.LOST}setCrashed(){this._flightStatus=C.CRASHED}setSelected(){this._isSelected=!0,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!0)})}unsetSelected(){this._isSelected=!1,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!1)})}setHeight(t){this._targetAltitude=t}setDirection(t){this._targetDirection=t}}const Es=new _t({color:3900150,flatShading:!0});class Is{_tiles=[];_labels=new Q;constructor(){}add(t={position:{x:1,y:1,z:1},direction:0,text:"N"}){this._tiles.push(t)}reset(){this._tiles=[]}create(){return this._tiles.forEach(t=>{const e=new ve(t.text,{font:De,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});e.center(),e.scale(.03,.03,.03),e.rotateX(Math.PI/-2),e.rotateY(t.direction*Math.PI/-4),e.translate(t.position.x*10,-.5+t.position.y*5,t.position.z*10),this._labels.add(new T(e,Es))}),this._labels}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._labels.scale.setScalar(t.scale)}}const it=new Is,dt=new A;class Ss{_tiles=[];_pole=null;_beam=null;_pegs=null;_powerline=new Q;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._pole=null,this._beam=null,this._pegs=null,this._powerline=new Q,this._instances=[]}create(){const t=[];if(this._tiles.forEach(e=>{this._instances.push({pos:{x:0,y:0,z:0},rot:{x:0,y:0,z:0},scale:1,tile:e})}),this._tiles.length){this._pole=new lt(hs.clone(),R,1),this._pole.geometry.scale(.25,10,.25),this._pole.geometry.computeBoundingBox(),this._pole.geometry.translate(0,this._pole.geometry.boundingBox.min.y*-1,0),this._pole.castShadow=!0,this._beam=new lt(N.clone(),R,1),this._beam.geometry.scale(3,.2,.2),this._beam.geometry.computeBoundingBox(),this._beam.geometry.translate(0,this._beam.geometry.boundingBox.min.y*-1,0),this._beam.geometry.translate(0,9,0),this._beam.castShadow=!0;for(let n=0;n<4;n++){const s=ds.clone();s.scale(.15,.5,.15),s.translate(-1.2+n*.8,0,0),s.translate(0,9.45,0),t.push(s)}const e=Z(t);this._pegs=new lt(e,Tt,4),this._powerline.add(this._pole,this._beam,this._pegs)}return this._powerline}updateInstance(t,e,n){const{pos:s,rot:a,scale:o,tile:r}=t,{x:c,y:d,z:i}=s,{x:u,y:p,z:g}=a,b=new be(u,p,g,"XYZ");dt.position.set(c+r.position.x*10,(d+r.position.y*5)*o,i+r.position.z*10),dt.setRotationFromEuler(b),dt.scale.set(n.x,n.y,n.z),dt.updateMatrixWorld(!0),this._pole.setMatrixAt(e,dt.matrixWorld),this._pole.setColorAt(e,he),this._beam.setMatrixAt(e,dt.matrixWorld),this._beam.setColorAt(e,he),this._pegs.setMatrixAt(e,dt.matrixWorld),this._pegs.setColorAt(e,Oe),dt.updateMatrixWorld(!0),this._pole.instanceMatrix.needsUpdate=!0,this._pole.instanceColor.needsUpdate=!0,this._beam.instanceMatrix.needsUpdate=!0,this._beam.instanceColor.needsUpdate=!0,this._pegs.instanceMatrix.needsUpdate=!0,this._pegs.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:0,y:0,z:0},o={x:s,y:s,z:s};this.updateInstance(e,n,a),new m.Tween(a).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,a={x:s,y:s,z:s},o={x:0,y:0,z:0};new m.Tween(a).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,a)).onComplete(t).delay(k(500,750)).start()})}):Promise.resolve()}}const Cs=new Ss,we=l=>{l.dispose();for(const t of Object.keys(l)){const e=l[t];e&&typeof e=="object"&&"minFilter"in e&&e.dispose()}};class Fe{_scene=null;_anims=[];_lights=[];_models=[];_fog=null;_elements=[it,qt,Ut,Nt,Zt,bt,Yt,Te,Cs];_airplanes=nt([]);_clouds=bt;_board=null;_tick=nt(-1);_tickWatcher=null;_isAnimating=!1;_score=nt(0);_animate=()=>{bt._animate(),Yt._animate(),this._airplanes.value.forEach(t=>t?.animate())};constructor(){this._scene=new se,this._tickWatcher=gt(this._tick,t=>{t>=96&&(S.send("WIN"),this._tickWatcher())})}addLight(t){this._lights.push(t)}addFog(t){this._fog=t}addBoard(t){this._board=t}addAirplane(t){this._airplanes.value.push(t),this._scene.add(t._model)}removeAirplane(t){this._airplanes.value=this._airplanes.value.filter(n=>n._id!==t._id);const e=this._scene.getObjectById(t._model.id);this._scene.remove(e)}reset(){this._scene.traverse(t=>{if(!!t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)we(t.material);else for(const e of t.material)we(e)}),this._scene=new se,this._board=null,this._anims=[],this._lights=[],this._models=[],this._fog=null,this._airplanes.value=[],this._tick.value=-1,this._score.value=0,this._elements.forEach(t=>t.reset())}async animateIn(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateIn())),Promise.resolve()}async animateOut(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateOut())),Promise.resolve()}render(){this._scene.fog=this._fog,this._lights.forEach(t=>{this._scene.add(t)}),this._elements.forEach(t=>this._scene.add(t.create()))}}const Ps=[Ge,jt,Be],Ls=H(Ps);class Os extends Fe{start=()=>{const t=new xe(16777215,526338,.7);t.position.set(15,25,15);const e=new A;e.rotation.x=Math.PI/-3;const n=new Rt(16777215,.3);e.add(n),n.position.set(60,0,0),n.lookAt(e.position),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.near=.5,n.shadow.camera.far=500,n.shadow.camera.top=90,n.shadow.camera.bottom=-120,n.shadow.camera.left=-90,n.shadow.camera.right=90,e.rotation.y=Math.PI/-1.5;const s=new Rt(11592173,.2);s.position.set(-20,25,-10),this.addLight(t),this.addLight(e),this.addLight(s),new Ls;const a=new $e({id:0,start:{position:{x:0,y:1,z:0},direction:1,name:""},end:{position:{x:0,y:0,z:0},direction:1,name:""},fuel:100});this.addAirplane(a),qt.add(),bt.add({position:{x:0,y:2,z:0}});const o=new Qt(new y(10209513),15,30);this.addFog(o);const r=new A;r.position.y=2.5,I.target=r.position}}class As{_width=0;_depth=0;_difficulty=null;_airfields=0;_clouds=0;_airplanes=0;_airplanesQueue=[];_tiles=[];_tick=0;constructor(t=1){this._difficulty=Ie[t],this._width=ce[this._difficulty].width,this._depth=ce[this._difficulty].depth,this._airfields=k(de[this._difficulty].min,de[this._difficulty].max),this._clouds=k(At[this._difficulty].count.min,At[this._difficulty].count.max),this._airplanes=Ct[this._difficulty].amount}generate(){const t=Math.ceil(0-this._width/2),e=Math.ceil(0-this._depth/2),n=Math.abs(t),s=Math.abs(e);this._tiles=Array.from({length:this._depth},()=>Array.from({length:this._width},()=>null));const a=Math.random()>.5,o=H(a?[0,1,this._depth-1,this._depth-2]:[0,1,this._width-1,this._width-2]);a?this._tiles[o].forEach((c,d)=>{this._tiles[o][d]=new jt({position:{x:d+t,y:0,z:o+e},direction:2})}):this._tiles.forEach((c,d)=>{this._tiles[d][o]=new jt({position:{x:o+t,y:0,z:d+e}})});const r=[];for(let c=0;c<this._airfields;c++){const d=Dn(this._tiles,this._width,this._depth,3);if(d){const{x:i,z:u,tile:p}=d,g={position:p,direction:k(0,7),name:`AP${r.length+1}`};r.push(g),this._tiles[u][i]=new Be(g)}}this._tiles.forEach((c,d)=>{c.forEach((i,u)=>{if(!i)return new Ge({position:{x:u+t,y:0,z:d+e}})})}),qt.add({scale:{x:this._width,y:1,z:this._depth}});for(let c=0;c<this._clouds;c++){const d=k(At[this._difficulty].size.min,At[this._difficulty].size.max),i=Un(this._width,this._depth,Ct[this._difficulty].height);for(let u=0;u<d;u++)for(let p=0;p<d;p++)bt.add({position:{x:i.position.x+u,y:i.position.y,z:i.position.z+p},direction:i.direction})}for(let c=0;c<this._airplanes;c++){const d=Nn(this._width,this._depth,Ct[this._difficulty].height,r);let i=le(this._width,this._depth,Ct[this._difficulty].height,r);for(;d.name===i.name;)i=le(this._width,this._depth,Ct[this._difficulty].height,r);this._airplanesQueue.push(new $e({id:yn(),start:d,end:i,startTime:k(0,96-(this._width+4)),fuel:k(20,35)}))}it.add({position:{x:0,y:0,z:e-2},direction:0,text:"N"}),it.add({position:{x:n+1,y:0,z:e-1},direction:1,text:"NE"}),it.add({position:{x:n+2,y:0,z:0},direction:2,text:"E"}),it.add({position:{x:n+1,y:0,z:s+1},direction:3,text:"SE"}),it.add({position:{x:0,y:0,z:s+2},direction:4,text:"S"}),it.add({position:{x:t-1,y:0,z:s+1},direction:5,text:"SW"}),it.add({position:{x:t-2,y:0,z:0},direction:6,text:"W"}),it.add({position:{x:t-1,y:0,z:e-1},direction:7,text:"NW"}),this._airplanesQueue.sort((c,d)=>c._startTime<d._startTime?-1:c._startTime>d._startTime?1:0)}}class Gs extends Fe{start(){const t=new xe(16777215,526338,.7);t.name="hemi",t.position.set(15,25,15);const e=new A;e.name="sun";const n=new Rt(16777215,.3),s=new ae(n,5);e.add(n),n.position.set(0,60,0),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.near=.5,n.shadow.camera.far=500,n.shadow.camera.top=90,n.shadow.camera.bottom=-120,n.shadow.camera.left=-90,n.shadow.camera.right=90;const a=new Rt(11592173,.2);n.name="sunlight";const o=new ae(a,5);a.position.set(-20,25,-10);const r=new A;r.position.y=2.5,I.target=r.position,this.addLight(t),this.addLight(e),this.addLight(s),this.addLight(o),this.addLight(a);const c=new Qt(new y(10209513),15,350);e.rotation.x=Math.PI/4,e.rotation.z=Math.PI;const d=new As(S.state.context.difficulty);d.generate(),this.addFog(c),this.addBoard(d),this.nextTick()}async nextTick(){if(!this._isAnimating){this._isAnimating=!0,this._tick.value++,this._airplanes.value=this._airplanes.value.filter(s=>{if(s._flightStatus===C.LANDED||s._flightStatus===C.EXITED||s._flightStatus===C.LOST)this.removeAirplane(s);else return s});const t=Promise.all(this._airplanes.value.map(s=>s.next())),e=Promise.all(this._board._airplanesQueue.filter(s=>s._startTime===this._tick.value).map(s=>(this.addAirplane(s),s.setSpawned(),s.setGhost(),s.animateIn(0,500)))),n=new Promise(s=>{const a=this._lights.find(c=>c.name==="sun"),o={rot:a.rotation.z},r={rot:a.rotation.z+Math.PI*2*(1/96)};new m.Tween(o).to(r,500).easing(m.Easing.Quadratic.InOut).onUpdate(()=>a.rotation.z=o.rot).onComplete(s).start()});this._tick.value%Math.floor(96/this._board._width)===0&&this._tick.value>0&&await this._clouds.next(),await t,await e,await n,this.checkObstructions(),this.checkDestinations(),this.checkOutOfBounds(),this.checkOutOfFuel(),this._isAnimating=!1}}checkObstructions(){const t=0-Math.floor(this._board._width/2),e=0-Math.floor(this._board._depth/2),n=Math.abs(t),s=Math.abs(e);this._airplanes.value.forEach(a=>{const{x:o,y:r,z:c}=a._position;let d=!1,i=!1;bt._tiles.forEach(u=>{const{x:p,y:g,z:b}=u.position;p===o&&g===r&&b===c&&(d=!0)}),(o<t||o>n||c<e||c>s)&&(i=!0),(d||i)&&a.setGhost()})}checkCollisions(){this._airplanes.value.forEach(t=>{const{x:e,y:n,z:s}=t._position;t._takenOff&&(n===0&&Yt._tiles.forEach(a=>{const{x:o,y:r,z:c}=a.position;e===o&&s===c&&t._direction===a.direction?console.log("plane landed on airport, check if it's the right airport!"):(console.log(`plane crashed at ${o}, ${r}, ${c}`),S.send("LOSE"))}),this._airplanes.value.forEach(a=>{if(t._id!==a._id){const{x:o,y:r,z:c}=a._position;e===o&&n===r&&s===c&&S.send("LOSE")}}))})}checkDestinations(){this._airplanes.value.forEach(t=>{if(t._takenOff){const{x:e,y:n,z:s}=t._position,a=t._direction,{position:{x:o,y:r,z:c},direction:d}=t._end;e===o&&n===r&&s===c&&a===d?(this._score.value+=100+t._fuel*10,t.setGhost(),n===0?t.setLanded():t.setExited()):n===0&&(console.log("game over!"),t.setCrashed(),S.send("LOSE"))}})}checkOutOfBounds(){this._airplanes.value.forEach(t=>{const{x:e,z:n}=t._position,s=0-Math.ceil(this._board._width/2),a=0-Math.ceil(this._board._depth/2),o=Math.abs(s),r=Math.abs(a);(e<=s||e>=o||n<=a||n>=r)&&t._flightStatus!==C.APPROACHING&&t._startTime<this._tick.value&&(this._score.value-=500,t.setLost())})}checkOutOfFuel(){this._airplanes.value.forEach(t=>{t._fuel<=0&&(console.log("game over!"),S.send("LOSE"))})}selectPlane(t){this._airplanes.value.forEach(e=>{if(e._id===t&&e._isSelected){e.unsetSelected();return}e.unsetSelected(),e._id===t&&!e._isGhost&&e.setSelected()})}}const L={props:{size:{type:String,default:"md"},isDisabled:{type:Boolean,default:!1},isPrimary:{type:Boolean,default:!1},isSecondary:{type:Boolean,default:!1}},setup(l){const t=l,{size:e,isDisabled:n,isPrimary:s,isSecondary:a}=bn(t),o=ht(()=>{switch(e.value){case"control":return["w-7 min-h-7"];case"xs":return[];case"md":default:return[]}}),r=ht(()=>{const i=["blur-[2px]",!s.value&&!a.value&&"bg-gray-800",n.value&&"bg-gray-600",s.value&&!n.value&&"bg-blue-800",a.value&&!n.value&&"bg-blue-600"];switch(e.value){case"control":return[...i,"rounded-sm translate-y-[1px] group-active:translate-y-[0px] group-hover:translate-y-[2px]"];case"xs":return[...i,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"];case"sm":return[...i,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"];case"md":default:return[...i,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"]}}),c=ht(()=>{const i=[!s.value&&!a.value&&"group-hover:bg-gray-300",n.value&&"bg-gray-400",n.value&&a.value&&"bg-gray-500",n.value&&s.value&&"bg-gray-600",s.value&&!n.value&&"bg-blue-800 group-hover:bg-blue-900",a.value&&!n.value&&"bg-blue-400 group-hover:bg-blue-500"];switch(e.value){case"control":return[...i,"w-7 min-h-7 p-[2px] rounded-sm"];case"xs":return[...i,"py-1 px-1 rounded"];case"sm":return[...i,"py-2 px-5 rounded"];case"md":default:return[...i,"py-3 px-7 rounded"];case"lg":return[...i,"py-4 px-8 rounded"]}}),d=ht(()=>{const i=[!s.value&&!a.value&&!n.value&&"text-gray-800 group-hover:bg-gray-100",n.value&&"bg-gray-200 border-gray-300 text-gray-400 cursor-not-allowed",n.value&&a.value&&"bg-gray-300 border-gray-400 text-gray-500 cursor-not-allowed",n.value&&s.value&&"bg-gray-400 border-gray-500 text-gray-600 cursor-not-allowed",s.value&&!n.value&&"bg-blue-500 border-blue-700 text-white group-hover:bg-blue-600",a.value&&!n.value&&"bg-blue-200 border-blue-300 text-blue-700 group-hover:bg-blue-300"];switch(e.value){case"control":return[...i,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[3px]","absolute inset-0 border rounded-sm text-xs -translate-y-[1px]"];case"xs":return[...i,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-1 px-1 text-xs rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"sm":return[...i,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-2 px-5 text-sm rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"md":default:return[...i,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-2 px-7 text-sm rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"lg":return[...i,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-3 px-8 text-xl rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"]}});return(i,u)=>(Y(),U("button",{class:ft(["relative group select-none",_(o)])},[h("span",{class:ft(["absolute inset-0 bg-opacity-50 transition-transform transform",_(r)])},null,2),h("span",{class:ft(["absolute inset-0 bg-gray-200",_(c)])},null,2),h("span",{class:ft(["flex justify-center items-center bg-white font-bold transition-all transform",_(d)])},[vn(i.$slots,"default")],2)],2))}};const Ts=h("div",{id:"three"},null,-1),Xs={key:0,class:"absolute top-32 left-1/2 transform -translate-x-1/2"},Ds=h("h1",{class:"font-callout text-6xl stage"},[h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("span",{class:"opacity-0"},"Air Traffic Control")],-1),Rs=[Ds],Ys={key:0,class:"fixed bottom-1/4 left-1/2 transform -translate-x-1/2"},Us=P(" Play "),Ns={key:0,class:"fixed top-3 right-2"},Zs={key:0,class:"fixed top-2 left-1/2 transform -translate-x-1/2 bg-white rounded shadow-block origin-top"},Bs={class:"pt-2 pb-3 px-4 text-center text-sm"},$s=h("div",{class:"font-bold text-gray-800"}," Score ",-1),Fs={key:0,class:"fixed top-2 right-2 text-xs font-bold origin-top-right"},Ws={class:"absolute -bottom-16 left-1/2 w-16 transform -translate-x-1/2 bg-white pt-2 pb-3 px-3 rounded shadow-block text-center"},Hs=h("div",{class:"font-bold text-sm"}," Time ",-1),js={class:"text-blue-500"},Qs={key:0,class:"fixed bottom-2 right-2 w-80 bg-white rounded shadow-block origin-bottom-right"},qs={class:"p-2 pb-3 text-center"},Vs=h("div",{class:"font-bold text-sm text-gray-800"}," Flight Schedule ",-1),Ks={class:"space-y-1 max-h-48 overflow-auto mt-2"},Js={class:"text-sm font-bold w-full"},ta=h("thead",null,[h("tr",{class:"sticky top-0 bg-white bg-opacity-80"},[h("th",{class:"font-bold text-sm text-gray-700"}," Time "),h("th",{class:"font-bold text-sm text-gray-700"}," Status "),h("th",{class:"font-bold text-sm text-gray-700"}," Entry "),h("th",{class:"font-bold text-sm text-gray-700"}," Exit "),h("th",{class:"font-bold text-sm text-gray-700"}," Fuel ")])],-1),ea={class:"text-xs"},na=["onClick"],sa={class:"py-1"},aa={class:"py-1"},oa={class:"py-1"},ia={class:"py-1"},ra={class:"py-1"},la={key:0,class:"fixed top-3 left-2 origin-top-left"},ca=P(" Quit "),da={class:"fixed bottom-2 left-2 bg-white rounded shadow-block origin-bottom-left"},ha={class:"p-2 pb-3 text-center"},ua=h("div",{class:"font-bold text-sm text-gray-800"}," Flight Controls ",-1),pa={class:"flex"},ma={class:"p-2 space-y-1"},ga=h("div",{class:"font-bold text-sm text-gray-700"}," Direction ",-1),fa={class:"grid grid-cols-3 gap-1"},wa=P(" 45 "),_a=P(" \u2191 "),ya=P(" 45 "),ba=P(" 90 "),va=P(" 90 "),xa=P(" 135 "),ka=P(" L "),za=P(" 135 "),Ma=P(" 180 "),Ea=P(" \u221E "),Ia=P(" 180 "),Sa={class:"p-2 space-y-1"},Ca=h("div",{class:"font-bold text-sm text-gray-700"}," Altitude ",-1),Pa={class:"grid grid-cols-3 gap-1"},La={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Oa={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block"},Aa=h("h2",{class:"text-base font-bold"}," Are you sure you want to quit? ",-1),Ga={class:"flex space-x-4 items-center justify-center mt-6"},Ta=P(" No "),Xa=P(" Yes "),Da={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Ra=h("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80"},null,-1),Ya={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block"},Ua=h("h2",{class:"text-base font-bold"}," You lost! ",-1),Na={class:"flex space-x-4 items-center justify-center mt-6"},Za=P(" Admit Defeat "),Ba={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},$a=h("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80"},null,-1),Fa={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block text-center"},Wa={class:"text-base font-bold"},Ha={class:"mt-2 text-sm"},ja=P(" You scored a total of "),Qa=P(" points. "),qa={class:"flex space-x-4 items-center justify-center mt-6"},Va={setup(l){xn(v=>({"34b637ab":_(vt)}));let t=null,e=null;const n=nt([]),s=ht(()=>re(e._tick.value)),a=ht(()=>e._score.value),o=(v,f)=>{const w=v._id===i.value?._id,B=v._flightStatus===C.IN_FLIGHT,q=[v._flightStatus===C.APPROACHING&&"bg-blue-200 text-blue-400 cursor-not-allowed",v._flightStatus===C.SCHEDULED&&"text-gray-400 cursor-not-allowed",v._flightStatus===C.LANDED&&"bg-teal-100 text-teal-500 cursor-not-allowed",v._flightStatus===C.EXITED&&"bg-teal-100 text-teal-500 cursor-not-allowed",v._flightStatus===C.LOST&&"bg-rose-100 text-rose-400 cursor-not-allowed"],ct=["bg-blue-500 text-white hover:bg-blue-600 border-b-2 border-blue-800"],F=[!w&&f%2===0&&"bg-gray-100",!w&&"hover:bg-gray-200"];return[...w?[]:q,...w?ct:[],...B?F:[]]},r=nt("#ecfeff"),c=nt("#7dd3fc");kn(()=>{An(),I.autoRotate=!1,I.enablePan=!0;let v,f,w;S.onTransition(async G=>{if(G.changed&&G.matches("introIn")&&(I.autoRotate=!0,t=new Os,t.start(),t.render(),await t.animateIn(),S.send("DONE")),G.changed&&G.matches("introOut")&&(I.enableRotate=!1,I.autoRotate=!1,await t.animateOut(),S.send("DONE")),G.changed&&G.matches("gameIn")){t.reset(),e=new Gs,v=gt(e._tick,st=>{clearInterval(x.value),b.value=0,x.value=setInterval(()=>{b.value++},1e3);const ot=st/96,V=Math.sin(ot*Math.PI);r.value=St("#4a6263","#ecfeff",V),c.value=St("#1d3743","#7dd3fc",V);const pt=St("#1d3743","#9bc8e9",V),zt=St("#1d3743","#9bc8e9",V),Mt=St("#c09db2","#f4efd4",V);e._scene.fog=new Qt(new y(pt),15,350),e._scene.children.forEach(K=>{K.name==="hemi"&&(K.color=new y(zt)),K.name==="sun"&&(K.children[0].color=new y(Mt))}),n.value=e._board._airplanesQueue.map(K=>e._airplanes.value.find(Lt=>Lt._id===K._id)||K)}),e.start(),e.render();const X=O.position;new m.Tween(X).to({x:80,y:35,z:80},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>O.position.set(X.x,X.y,X.z)).onComplete(()=>{I.enableRotate=!0,I.enableZoom=!0,S.send("DONE")}).start(),await e.animateIn()}if(G.changed&&G.matches("gamePlaying")&&(I.enableRotate=!0,f=gt(e._airplanes,X=>{X.find(st=>st._id===i.value?._id)||(i.value=null)}),w=gt(n,X=>{X.every(st=>st._flightStatus===C.LANDED||st._flightStatus===C.EXITED||st._flightStatus===C.LOST)&&S.send("WIN")})),G.changed&&G.matches("gameOut")){I.enableRotate=!1;const X=O.position;new m.Tween(X).to({x:15,y:9,z:15},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>O.position.set(X.x,X.y,X.z)).onComplete(()=>{I.enableRotate=!0,I.enableZoom=!0,S.send("DONE")}).delay(500).start(),await e.animateOut(),e.reset(),r.value="#ecfeff",c.value="#7dd3fc",v(),f(),w()}});let B=0,q=1/60;const ct=new zn,F=new Mn;let j=!1;const xt=G=>{j=!0,F.x=G.clientX/window.innerWidth*2-1,F.y=-(G.clientY/window.innerHeight)*2+1},yt=()=>{j=!1};rt.setAnimationLoop(async G=>{if(B+=Xn.getDelta(),ie.begin(),S.state.hasTag("intro")&&t?._scene)rt.render(t._scene,O),B>q&&t._animate();else if(S.state.hasTag("board")&&e?._scene){if(j){ct.setFromCamera(F,O);const ot=ct.intersectObjects(e._scene.children).sort((V,pt)=>V.distance<pt.distance).find(V=>V.object.parent.name==="plane");ot&&(u(ot.object.parent),j=!1)}rt.render(e._scene,O),B>q&&e._animate()}I.update(),m.update(G),ie.end(),B=B%q});const kt=()=>{O.aspect=window.innerWidth/window.innerHeight,O.updateProjectionMatrix(),rt.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",kt,!1),window.addEventListener("mousedown",xt),window.addEventListener("mouseup",yt),S.send("INTRO_IN")});const d=async()=>{await e.nextTick()};nt(!1);const i=nt(null);gt(i,v=>{v||Tn()});const u=v=>{if(e.selectPlane(v._id),i.value=e._airplanes.value.find(f=>f._isSelected),i.value){const f=I.target,w=i.value._model.position;new m.Tween(f).to(w,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>I.target=f).start();const{x:B,y:q,z:ct}=i.value._model.position,F=Zn(i.value._direction),j={x:O.position.x,y:O.position.y,z:O.position.z},xt={x:B+20*F.x,y:q+10,z:ct+20*F.z};new m.Tween(j).to(xt,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{O.position.set(j.x,j.y,j.z),I.update()}).start()}},p=v=>{i.value&&!i.value._isGhost&&i.value.setHeight(v)},g=v=>{i.value&&!i.value._isGhost&&i.value.setDirection(v)},b=nt(0),x=nt(null);gt(b,async v=>{v===30&&await e.nextTick()}),gt(D,v=>{(v.matches("gamePlaying.lose")||v.matches("gamePlaying.win")||v.matches("gameOut"))&&clearInterval(x.value)});const $=ht(()=>({background:`conic-gradient(#3b82f6 ${b.value/30*360}deg, transparent ${b.value/30*360}deg)`})),vt=ht(()=>`radial-gradient(${r.value}, ${c.value})`);return(v,f)=>(Y(),U(Ot,null,[Ts,h("div",null,[z(J,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)]","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:M(()=>[_(D).matches("introIdle")?(Y(),U("div",Xs,Rs)):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)] delay-100","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in delay-200","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:M(()=>[_(D).matches("introIdle")?(Y(),U("div",Ys,[z(L,{size:"lg",onClick:f[0]||(f[0]=w=>_(S).send("INTRO_OUT"))},{default:M(()=>[Us]),_:1})])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)] delay-200","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in delay-100","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:M(()=>[_(D).matches("introIdle")?(Y(),U("div",Ns,[z(L,{"is-secondary":_(D).context.difficulty===1,"is-primary":_(D).context.difficulty===2,onClick:f[1]||(f[1]=w=>_(S).send("DIFFICULTY"))},{default:M(()=>[P(W(_(Ie)[_(D).context.difficulty]),1)]),_:1},8,["is-secondary","is-primary"])])):tt("",!0)]),_:1}),_(D).hasTag("board")?(Y(),U(Ot,{key:0},[z(J,{"enter-active-class":"transition duration-200 ease-in-out delay-100","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out delay-300","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying")?(Y(),U("div",Zs,[h("div",Bs,[$s,h("div",{class:ft(["font-bold",_(a)<0?"text-rose-500":_(a)>0?"text-green-500":"text-blue-500"])},W(_(a)),3)])])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-200 ease-in-out delay-200","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out delay-200","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying")?(Y(),U("div",Fs,[h("div",{class:"flex justify-center items-center rounded-full w-16 h-16 shadow-block bg-white cursor-pointer transform hover:bg-blue-200 transition-colors",onClick:d},[h("div",{class:"rounded-full w-16 h-16 border-2 border-white",style:En(_($))},null,4)]),h("div",Ws,[Hs,h("div",js,W(_(s)),1)])])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-200 ease-in-out delay-300","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out delay-100","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying")?(Y(),U("div",Qs,[h("div",qs,[Vs,h("div",Ks,[h("table",Js,[ta,h("tbody",ea,[(Y(!0),U(Ot,null,oe(n.value,(w,B)=>(Y(),U("tr",{key:w._id,class:ft(["transition-colors cursor-pointer",o(w,B)]),onClick:q=>w._flightStatus===_(C).IN_FLIGHT?u(w):null},[h("td",sa,W(_(re)(w._startTime)),1),h("td",aa,W(w._flightStatus),1),h("td",oa,W(w._start.name),1),h("td",ia,W(w._end.name),1),h("td",ra,W(w._fuel),1)],10,na))),128))])])])])])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-200 ease-in-out delay-[400ms]","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying")?(Y(),U("div",la,[z(L,{onClick:f[2]||(f[2]=w=>_(S).send("QUIT"))},{default:M(()=>[ca]),_:1})])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-200 ease-in-out","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:M(()=>[In(h("div",da,[h("div",ha,[ua,h("div",pa,[h("div",ma,[ga,h("div",fa,[z(L,{size:"control","is-primary":i.value?._targetDirection===-1,"is-disabled":i.value?._isGhost,onClick:f[3]||(f[3]=w=>g(-1))},{default:M(()=>[wa]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control",class:"row-span-2","is-primary":i.value?._targetDirection===0&&i.value?._targetAltitude!==0,"is-disabled":i.value?._isGhost,onClick:f[4]||(f[4]=w=>{g(0),p(i.value?._position.y)})},{default:M(()=>[_a]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===1,"is-disabled":i.value?._isGhost,onClick:f[5]||(f[5]=w=>g(1))},{default:M(()=>[ya]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===-2,"is-disabled":i.value?._isGhost,onClick:f[6]||(f[6]=w=>g(-2))},{default:M(()=>[ba]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===2,"is-disabled":i.value?._isGhost,onClick:f[7]||(f[7]=w=>g(2))},{default:M(()=>[va]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===-3,"is-disabled":i.value?._isGhost,onClick:f[8]||(f[8]=w=>g(-3))},{default:M(()=>[xa]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===0&&i.value?._targetAltitude===0,"is-disabled":i.value?._isGhost,onClick:f[9]||(f[9]=w=>{g(0),p(0)})},{default:M(()=>[ka]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===3,"is-disabled":i.value?._isGhost,onClick:f[10]||(f[10]=w=>g(3))},{default:M(()=>[za]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-primary":i.value?._targetDirection===-4,"is-disabled":i.value?._isGhost,onClick:f[11]||(f[11]=w=>g(-4))},{default:M(()=>[Ma]),_:1},8,["is-primary","is-disabled"]),z(L,{size:"control","is-disabled":""},{default:M(()=>[Ea]),_:1}),z(L,{size:"control","is-primary":i.value?._targetDirection===4,"is-disabled":i.value?._isGhost,onClick:f[12]||(f[12]=w=>g(4))},{default:M(()=>[Ia]),_:1},8,["is-primary","is-disabled"])])]),h("div",Sa,[Ca,h("div",Pa,[(Y(),U(Ot,null,oe([0,1,2,3,4,5,6,7,8],w=>z(L,{key:w,size:"control","is-secondary":i.value?._position.y===w&&i.value?._targetAltitude!==w,"is-primary":i.value?._targetAltitude===w,"is-disabled":i.value?._isGhost,onClick:B=>p(w)},{default:M(()=>[P(W(w),1)]),_:2},1032,["is-secondary","is-primary","is-disabled","onClick"])),64))])])])])],512),[[Sn,_(D).matches("gamePlaying")&&i.value]])]),_:1}),z(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying.quit")?(Y(),U("div",La,[h("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80",onClick:f[13]||(f[13]=Cn(w=>_(S).send("CANCEL"),["self"]))}),h("div",Oa,[Aa,h("div",Ga,[z(L,{size:"sm","is-secondary":"",onClick:f[14]||(f[14]=w=>_(S).send("CANCEL"))},{default:M(()=>[Ta]),_:1}),z(L,{size:"sm","is-primary":"",onClick:f[15]||(f[15]=w=>_(S).send("DONE"))},{default:M(()=>[Xa]),_:1})])])])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying.lose")?(Y(),U("div",Da,[Ra,h("div",Ya,[Ua,h("div",Na,[z(L,{size:"sm","is-primary":""},{default:M(()=>[Za]),_:1})])])])):tt("",!0)]),_:1}),z(J,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:M(()=>[_(D).matches("gamePlaying.win")?(Y(),U("div",Ba,[$a,h("div",Fa,[h("h2",Wa," You won"+W(_(a)<0?" (sort of)":"")+"! "+W(_(a)<0?"\u{1F605}":"\u{1F389}"),1),h("p",Ha,[ja,h("span",{class:ft(["font-bold",_(a)<0?"text-rose-500":_(a)>0?"text-green-500":"text-blue-500"])},W(_(a)),3),Qa]),h("div",qa,[z(L,{size:"sm","is-primary":"",onClick:f[16]||(f[16]=w=>_(S).send("DONE"))},{default:M(()=>[P(" Nice"+W(_(a)<0?"-ish":"")+"! ",1)]),_:1})])])])):tt("",!0)]),_:1})],64)):tt("",!0)])],64))}};Pn(Va).mount("#app");
