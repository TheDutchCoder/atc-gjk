import{c as an,a as rn,i as ln,r as st,S as cn,W as dn,P as hn,b as un,O as pn,V as xe,e as m,C as mn,M as bt,B as mt,d as D,f as T,G as Q,m as N,g as x,h as gn,D as fn,j as ve,I as it,E as wn,F as _n,T as ke,k as Ut,l as ae,w as wt,H as ze,n as Yt,o as Kt,v as yn,p as ie,t as bn,q as pt,s as Z,u as B,x as h,y as _t,z as b,A as xn,J as vn,K as kn,R as zn,L as Mn,N as M,Q as tt,U as E,X as Tt,Y as et,Z as L,_ as H,$ as En,a0 as re,a1 as In,a2 as Sn,a3 as Cn,a4 as Pn}from"./vendor.5f15e3e4.js";const Ln=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};Ln();const An=an({id:"main",initial:"loading",context:{difficulty:0},states:{loading:{on:{INTRO_IN:"introIn"}},introIn:{tags:"intro",on:{DONE:"introIdle"}},introIdle:{tags:"intro",on:{INTRO_OUT:"introOut",DIFFICULTY:{actions:["setDifficulty"]}}},introOut:{tags:"intro",on:{DONE:"gameIn"}},gameIn:{tags:"board",on:{DONE:"gamePlaying"}},gamePlaying:{tags:"board",initial:"playing",states:{playing:{on:{LOSE:"lose",WIN:"win",QUIT:"quit"}},lose:{on:{DONE:"#main.gameOut"}},win:{on:{DONE:"#main.gameOut"}},quit:{on:{DONE:"#main.gameOut",CANCEL:"playing"}}},on:{GAME_OUT:"gameOut"}},gameOut:{tags:"board",on:{DONE:"introIn"}}}},{actions:{setDifficulty:rn({difficulty:r=>(r.difficulty+1)%3})}}),C=ln(An).start(),U=st(C.state);C.onTransition(r=>U.value=r);const le=new cn,On=()=>{const r=document.getElementById("three");r.innerHTML="",r.appendChild(ht.domElement)},ht=new dn({antialias:!0,alpha:!0,shadow:!0});ht.setSize(window.innerWidth,window.innerHeight);ht.shadowMap.enabled=!0;ht.shadowMap.type=hn;const O=new un(50,window.innerWidth/window.innerHeight,1,1e3);O.position.set(15,9,15);const S=new pn(O,ht.domElement);S.enableDamping=!0;S.enableRotate=!0;S.enableZoom=!0;S.enablePan=!1;S.autoRotate=!0;S.autoRotateSpeed=-2;const Gn=new xe(0,0,0),Tn=()=>{const r=S.target,t=Gn;new m.Tween(r).to(t,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>S.target=r).start();const e={x:O.position.x,y:O.position.y,z:O.position.z},n={x:80,y:35,z:80};new m.Tween(e).to(n,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{O.position.set(e.x,e.y,e.z),S.update()}).start()},Xn=new mn,I=(r,t,e,n,s,o=!0)=>{[[0,11,17],[1,9,20],[2,13,19],[3,15,22],[5,10,16],[4,8,21],[7,12,18],[6,14,23]][r].forEach(i=>{let c,d,l,p=t.attributes.position.getX(i),g=t.attributes.position.getY(i),u=t.attributes.position.getZ(i);o?(c=e?p+e:p,d=n?g+n:g,l=s?u+s:u):(c=e||p,d=n||g,l=s||u),t.attributes.position.setXYZ(i,c,d,l)}),t.attributes.position.needsUpdate=!0},yt=(r,t,e)=>{const n=Math.round(Math.random()*(t*1e5-r*1e5)+r*1e5)/1e5;return e&&n>=e.min&&n<=e.max?yt(r,t,e):n},z=(r,t,e)=>{let n=Math.round(Math.random()*(t-r)+r);return n===e&&(n=z(r,t,e)),n},F=(r,t=!1)=>{const e=Math.floor(Math.random()*r.length),n=r[e];return t&&r.splice(e,1),n},St=(r,t,e)=>{var n=+r.replace("#","0x"),s=n>>16,o=n>>8&255,a=n&255,i=+t.replace("#","0x"),c=i>>16,d=i>>8&255,l=i&255,p=s+e*(c-s),g=o+e*(d-o),u=a+e*(l-a);return"#"+((1<<24)+(p<<16)+(g<<8)+u|0).toString(16).slice(1)},Dn=(r,t,e)=>{let n=[];return r.forEach((s,o)=>{s.forEach((a,i)=>{if(e){let c=!0;for(let d=0;d<t;d++)s[i+d]!==null&&(c=!1);c&&n.push({start:{x:i,y:0,z:o},end:{x:i+(t-1),y:0,z:o}})}else{let c=!0;for(let d=0;d<t;d++)(!r[o+d]||r[o+d][i]!==null)&&(c=!1);c&&n.push({start:{x:i,y:0,z:o},end:{x:i,y:0,z:o+(t-1)}})}})}),n},Rn=(r,t,e,n=0)=>{const s=JSON.parse(JSON.stringify(r)),o=JSON.parse(JSON.stringify(r));if(n>0&&(o.splice(-n),o.splice(0,n),o.forEach(p=>{p.splice(-n),p.splice(0,n)})),o.flat(2).every(p=>!!p))return null;const a=0-Math.floor(t/2),i=0-Math.floor(e/2);let c,d;do c=z(n,t-n-1),d=z(n,e-n-1);while(s[d][c]);return{tile:{x:c+a,y:0,z:d+i},x:c,z:d}},Me=(r,t,e={width:0,direction:0})=>{const{width:n,direction:s}=e,o=n/2;let a,i,c=yt(r,t),d=0,l=yt(r,t);for(s===0||s==4?(a=p=>p>o||p<-o,i=()=>!0):s===3||s==7?(a=()=>!0,i=(p,g)=>g>p+o||g<p-o):s===2||s==6?(a=()=>!0,i=(p,g)=>g>o||g<-o):(s===1||s==5)&&(a=()=>!0,i=(p,g)=>g>-p+o||g<-p-o);!a(c);)c=yt(r,t);for(;!i(c,l);)l=yt(r,t);return{x:c,y:d,z:l}},Ee=(r,t,e,n=1)=>{const s=Math.ceil(0-t/2),o=Math.abs(s),a=Math.ceil(0-e/2),i=Math.abs(a),{x:c,z:d}=r;return c===s-n?d===a-n?3:d===i+n?1:2:c===o+n?d===a-n?5:d===i+n?7:6:d===a-n?4:0},Un=(r,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),o=Math.ceil(0-e/2),a=Math.abs(o),{x:i,z:c}=r;return i===n-1?c===o-1?7:c===a+1?5:6:i===s+1?c===o-1?1:c===a+1?3:2:c===o-1?0:4},Dt=(r,t)=>{let{x:e,y:n,z:s}=r;return t===0?s--:t===1?(e++,s--):t===2?e++:t===3?(e++,s++):t===4?s++:t===5?(e--,s++):t===6?e--:t===7&&(e--,s--),{x:e,y:n,z:s}},Yn=(r,t)=>{let{x:e,y:n,z:s}=r;return t===0?s++:t===1?(e--,s++):t===2?e--:t===3?(e--,s--):t===4?s--:t===5?(e++,s--):t===6?e++:t===7&&(e++,s++),{x:e,y:n,z:s}},ce=r=>{const t=Math.floor(r/4).toString(),e=(r%4*15).toString();return`${t.padStart(2,"0")}:${e.padStart(2,"0")}`},Nn=(r,t,e)=>{const n=Math.ceil(0-r/2),s=Math.abs(n),o=2,a=e-2,i=Math.ceil(0-t/2),c=Math.abs(i),d=[n,s,0],l=[i,c],p=[i,c,0],g=F(d),u=z(o,a),w=F(g===0?l:p),f={x:g,y:u,z:w},k=Ee(f,r,t,0);return{position:f,direction:k}},Zn=(r,t,e,n)=>{const s=Math.random()>.7,o=Math.ceil(0-r/2)-1,a=Math.abs(o),i=Math.ceil(0-t/2)-1,c=Math.abs(i),d=[o,a,0],l=[i,c],p=[i,c,0],g=F(d),u=Math.ceil(Math.random()*e),w=F(g===0?l:p),f={x:g,y:u,z:w};return s?Ie(n):{position:f,direction:Ee(f,r,t),name:`${Se(f)}${u}`}},de=(r,t,e,n)=>{const s=Math.random()>.3,o=Math.ceil(0-r/2)-1,a=Math.abs(o),i=Math.ceil(0-t/2)-1,c=Math.abs(i),d=[o,a,0],l=[i,c],p=[i,c,0],g=F(d),u=z(3,e),w=F(g===0?l:p),f={x:g,y:u,z:w};return s?Ie(n):{position:f,direction:Un(f,r,t),name:`${Se(f)}${u}`}},Ie=r=>F(r),Se=r=>{const{x:t,z:e}=r;if(t===0){if(e>0)return"S";if(e<0)return"N"}else if(t<0){if(e<0)return"NW";if(e===0)return"W";if(e>0)return"SW"}else if(t>0){if(e<0)return"NE";if(e===0)return"E";if(e>0)return"SE"}},Bn=(r=0)=>{if(r===0)return{x:0,z:1};if(r===1)return{x:-1,z:1};if(r===2)return{x:-1,z:0};if(r===3)return{x:-1,z:-1};if(r===4)return{x:0,z:-1};if(r===5)return{x:1,z:-1};if(r===6)return{x:1,z:0};if(r===7)return{x:1,z:1}},$n=(r,t,e,n=0)=>{const s=(t-r)/(e-1),o=[];let a=r;for(let i=0;i<e;i++){const c=z(-n,n);o.push(Math.floor(a)+c),a+=s}return o},Ce=["EASY","NORMAL","HARD"],he={EASY:{width:11,depth:11},NORMAL:{width:15,depth:15},HARD:{width:21,depth:21}},ue={EASY:{min:1,max:2},NORMAL:{min:2,max:3},HARD:{min:3,max:5}},Fn={EASY:2,NORMAL:3,HARD:5},Xt={EASY:{count:{min:1,max:1},size:{min:2,max:2}},NORMAL:{count:{min:1,max:2},size:{min:2,max:3}},HARD:{count:{min:1,max:3},size:{min:3,max:5}}},Ct={EASY:{amount:24,height:6},NORMAL:{amount:48,height:7},HARD:{amount:96,height:8}},P={SCHEDULED:"Scheduled",APPROACHING:"Approaching",IN_FLIGHT:"In flight",OBSTRUCTED:"Obstructed",LANDED:"Landed",EXITED:"Exited",LOST:"Lost",CRASHED:"Crashed"},Wn=new bt({color:10053706,flatShading:!0});class Hn{_tile=null;_dirt=null;constructor(){}add(t={scale:{x:1,y:1,z:1}}){this._tile=t}reset(){this._tile=null,this._dirt=null}create(){const t=new mt(10,3,10);return t.translate(0,-2.5,0),t.scale(this._tile.scale.x,this._tile.scale.y,this._tile.scale.z),this._dirt=new D(t,Wn),this._dirt.scale.setScalar(0),this._dirt}animateIn(){return this._tile?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tile?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._dirt.scale.setScalar(t.scale)}}const Jt=new Hn;class Zt{_position={x:0,y:0,z:0};_model=null;_hasAnimations=!1;_isAnimating=!1;_shouldBeRemoved=!1;_tick=0;displayName="";constructor({position:t={x:0,y:0,z:0}}={}){this._position=t}updatePosition(){this._model.position.x=this._position.x*10,this._model.position.y=this._position.y*5,this._model.position.z=this._position.z*10}get position(){return this._position}set position(t){this._position=t,this.updatePosition()}get model(){return this._model}set model(t){this._model=t,this.updatePosition(),this._hasAnimations}get isAnimating(){return this._isAnimating}set isAnimating(t){this._isAnimating=t}}const jt=10,jn=1,Qt=10,Qn=new bt({color:11984276,flatShading:!0}),qn=new bt({color:10010486,flatShading:!0}),Vn=r=>{const t=r.getAttribute("position");for(let e=0;e<t.count;e++){const n=new xe;if(n.fromBufferAttribute(t,e),n.y>=.5&&n.x!==-5&&n.x!==5&&n.z!==-5&&n.z!==5){const s=.15-Math.random()*.3,o=jt/40-Math.random()*(jt/20),a=Qt/40-Math.random()*(Qt/20);t.setXYZ(e,n.x+o,n.y+s,n.z+a)}}r.attributes.position.needsUpdate=!0};class Kn{_tiles=[];_grassLight=new T;_grassDark=new T;_grassAll=new Q;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._grassLight=new T,this._grassDark=new T,this._grassAll=new Q}create(){const t=[],e=[];if(this._tiles.forEach(n=>{const s=new mt(10,1,10,jt,jn,Qt);Vn(s),s.rotateY(z(0,4)*2*(-Math.PI/4)),s.translate(n.position.x*10,-.5+n.position.y*5,n.position.z*10),n.position.x&1&&n.position.z&1||!(n.position.x&1)&&!(n.position.z&1)?t.push(s):e.push(s)}),this._tiles.length){if(t.length){const n=N(t);this._grassLight=new D(n,Qn),this._grassLight.receiveShadow=!0}if(e.length){const n=N(e);this._grassDark=new D(n,qn),this._grassDark.receiveShadow=!0}this._grassAll.add(this._grassLight,this._grassDark),this._grassAll.scale.setScalar(0)}return this._grassAll}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(250).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._grassAll.scale.setScalar(t.scale)}}const At=new Kn,Jn="#ffff00",ts=new x(11371131),es=new x(10473352),ns=new x(9157493),ss=new x(13617032),os=new x(13340781),Pe=new x(11910596),Le=new x(9542564),Ae=new x(7964047),Oe=new x(5857641);new x(11910596);new x(9542564);new x(7964047);const as=new x(5124632),is=new x(6307874),rs=new x(5914664),ls=new x(15658734);new x(16711680);new x(65280);new x(255);const cs=new x(0),ds=new x(16751104),hs=new x(16711680),us=new x(65280),pe=new x(11371131),ps=new x(4251856),ms=new x(0),G=new bt({flatShading:!0}),Ht=new bt({flatShading:!0,transparent:!0,opacity:.75}),gs=new bt({flatShading:!0,transparent:!0,opacity:.85}),Y=new mt(1,1,1),Rt=new gn(.3,2,4),Ge=new fn(1,0),fs=new ve(1,1,1,8),ws=new ve(.5,1,1,8);new mt(2,.15,.2);new mt(.1,.1,10);const _s=new mt(3,.2,9),ys=new mt(.2,.05,.75),me=new mt(.2,.2,.2),ge=[es,ns,ss,os],ft=new T;class bs{_tiles=[];_trunk=null;_foliage=null;_trees=new Q;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._trunk=null,this._foliage=null,this._trees=new Q,this._instances=[]}create(){let t=0;if(this._tiles.forEach(e=>{const n=z(20,30);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:Me(-4.75,4.75,e.exclude),rot:{x:yt(-.12,.12),y:yt(-.12,.12),z:0},scale:.5+Math.random()*.75,color:ge[z(0,ge.length-1)],tile:e})}),this._tiles.length){this._trunk=new it(Rt.clone(),G,t),this._trunk.castShadow=!0;const e=Rt.clone();e.scale(1.3,1.3,1.3),e.translate(0,.5,0);const n=Rt.clone();n.scale(1.1,1.1,1.1),n.translate(0,1.1,0);const s=N([e,n]);this._foliage=new it(s,G,t),this._foliage.castShadow=!0,this._foliage.receiveShadow=!0,this._trunk.geometry.computeBoundingBox(),this._foliage.geometry.computeBoundingBox(),this._trunk.geometry.translate(0,this._trunk.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,this._foliage.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,.3,0),this._trees.add(this._trunk,this._foliage)}return this._trees}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:i,tile:c}=t,{x:d,y:l,z:p}=s,{x:g,y:u,z:w}=o,f=new wn(g,u,w,"XYZ");ft.position.set(d+c.position.x*10,(l+c.position.y*5)*a,p+c.position.z*10),ft.setRotationFromEuler(f),ft.scale.set(n.x,n.y,n.z),ft.updateMatrixWorld(!0),this._trunk.setMatrixAt(e,ft.matrixWorld),this._trunk.setColorAt(e,ts),ft.updateMatrixWorld(!0),this._foliage.setMatrixAt(e,ft.matrixWorld),this._foliage.setColorAt(e,i),this._trunk.instanceMatrix.needsUpdate=!0,this._trunk.instanceColor.needsUpdate=!0,this._foliage.instanceMatrix.needsUpdate=!0,this._foliage.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(500,750)).start()})}):Promise.resolve()}}const Bt=new bs,fe=[Pe,Le,Ae,Oe],Pt=new T;class xs{_tiles=[];_rock=new T;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._rock=new T,this._instances=[]}create(){let t=0;return this._tiles.forEach(e=>{const n=z(6,12);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:Me(-4.5,4.5,e.exclude),rot:{x:-.1+Math.random()*.2,y:Math.PI/2*Math.random(),z:-.1+Math.random()*.2},scale:.1+Math.random()*.3,color:fe[z(0,fe.length-1)],tile:e})}),this._tiles.length&&(this._rock=new it(Ge,G,t),this._rock.castShadow=!0,this._rock.receiveShadow=!0),this._rock}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:i,tile:c}=t,{x:d,y:l,z:p}=s,{x:g,y:u,z:w}=o;Pt.position.set(d+c.position.x*10,(l+c.position.y+n.y)*a,p+c.position.z*10),Pt.rotation.set(g,u,w),Pt.scale.set(n.x,n.y,n.z),Pt.updateMatrixWorld(!0),this._rock.setMatrixAt(e,Pt.matrixWorld),this._rock.setColorAt(e,i),this._rock.instanceMatrix.needsUpdate=!0,this._rock.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(500,750)).start()})}):Promise.resolve()}}const Ot=new xs;class lt extends Zt{constructor({position:t={x:0,y:0,z:0}}={}){super({position:t});this.create()}create(){At.add({position:this._position}),Bt.add({position:this._position}),Ot.add({position:this._position})}}const we=[as,is,rs],at=new T;class vs{_tiles=[];_beams=null;_rails=null;_beamInstances=[];_railInstances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._beams=null,this._rails=null,this._beamInstances=[],this._railInstances=[]}create(){const t=new Q;let e=0,n=0;if(this._tiles.forEach(s=>{const a=s.direction===2||s.direction===6;e+=11;for(let i=0;i<11;i++)this._beamInstances.push({pos:{x:a?-4.6+i*10/11:0,y:0,z:a?0:-4.6+i*10/11},rot:{x:0,y:-.08+Math.random()*.16+(a?Math.PI/2:0),z:0},color:we[z(0,we.length-1)],tile:s});n+=2;for(let i=0;i<2;i++)this._railInstances.push({pos:{x:a?0:-.7+i*1.4,y:.2,z:a?-.7+i*1.4:0},rot:{x:0,y:a?Math.PI/2:0,z:0},color:ls,tile:s})}),this._tiles.length){const s=Y.clone();s.scale(2,.3,.3),this._beams=new it(s,G,e),this._beams.castShadow=!0,this._beams.receiveShadow=!0;const o=Y.clone();o.scale(.2,.2,10),this._rails=new it(o,G,n),this._rails.castShadow=!0,this._rails.receiveShadow=!0,t.add(this._beams,this._rails)}return t}updateBeamInstance(t,e,n){const{pos:s,rot:o,color:a,tile:i}=t,{x:c,y:d,z:l}=s,{x:p,y:g,z:u}=o;at.position.set(c+i.position.x*10,d+i.position.y*5,l+i.position.z*10),at.rotation.set(p,g,u),at.scale.set(n.x,n.y,n.z),at.updateMatrixWorld(!0),this._beams.setMatrixAt(e,at.matrixWorld),this._beams.setColorAt(e,a),this._beams.instanceMatrix.needsUpdate=!0,this._beams.instanceColor.needsUpdate=!0}updateRailInstance(t,e,n){const{pos:s,rot:o,color:a,tile:i}=t,{x:c,y:d,z:l}=s,{x:p,y:g,z:u}=o;at.position.set(c+i.position.x*10,d+n.y+i.position.y*10,l+i.position.z*10),at.rotation.set(p,g,u),at.scale.set(n.scale,n.scale,n.scale),at.updateMatrixWorld(!0),this._rails.setMatrixAt(e,at.matrixWorld),this._rails.setColorAt(e,a),this._rails.instanceMatrix.needsUpdate=!0,this._rails.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:0,y:0,z:0},o={x:1,y:1,z:1};this.updateBeamInstance(e,n,s),new m.Tween(s).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(z(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:5,scale:0},o={y:0,scale:1};this.updateRailInstance(e,n,s),new m.Tween(s).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(z(750,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:1,y:1,z:1},o={x:0,y:0,z:0};new m.Tween(s).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(z(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:0,scale:1},o={y:5,scale:0};new m.Tween(s).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(z(750,1e3)).start()})}):Promise.resolve()}}const Te=new vs;class _e extends Zt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){At.add({position:this._position}),Bt.add({position:this._position,exclude:{width:3,direction:this._direction}}),Ot.add({position:this._position,exclude:{width:3,direction:this._direction}}),Te.add({position:this._position,direction:this._direction})}}const ct=new T;class ks{_tiles=[];_pole=null;_beam=null;_pegs=null;_lines=null;_powerline=new Q;_poleInstances=[];_beamInstances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._pole=null,this._beam=null,this._pegs=null,this._lines=null,this._powerline=new Q,this._poleInstances=[]}create(){const t=[],e=[];if(this._tiles.forEach(n=>{const s=n.direction===2||n.direction===6;this._poleInstances.push({pos:{x:0,y:0,z:0},rot:{x:0,y:s?Math.PI/2:0,z:0},scale:1,tile:n})}),this._tiles.length){this._pole=new it(ws.clone(),G,this._tiles.length),this._pole.geometry.scale(.25,10,.25),this._pole.geometry.computeBoundingBox(),this._pole.geometry.translate(0,this._pole.geometry.boundingBox.min.y*-1,0),this._pole.castShadow=!0,this._beam=new it(Y.clone(),G,this._tiles.length),this._beam.geometry.scale(3,.2,.2),this._beam.geometry.computeBoundingBox(),this._beam.geometry.translate(0,this._beam.geometry.boundingBox.min.y*-1,0),this._beam.geometry.translate(0,9,0),this._beam.castShadow=!0;for(let o=0;o<4;o++){const a=fs.clone();a.scale(.15,.5,.15),a.translate(-1.2+o*.8,0,0),a.translate(0,9.45,0),t.push(a);const i=Y.clone();i.scale(.1,10,.1),i.rotateX(Math.PI/2),i.translate(-1.2+o*.8,0,0),i.translate(0,9.45,0),e.push(i)}const n=N(t),s=N(e);this._pegs=new it(n,G,4),this._lines=new it(s,G,4),this._powerline.add(this._pole,this._beam,this._pegs,this._lines)}return this._powerline}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,tile:i}=t,{x:c,y:d,z:l}=s,{x:p,y:g,z:u}=o;ct.position.set(c+i.position.x*10,(d+i.position.y*5)*a,l+i.position.z*10),ct.rotation.set(p,g,u),ct.scale.set(n.x,n.y,n.z),ct.updateMatrixWorld(!0),this._pole.setMatrixAt(e,ct.matrixWorld),this._pole.setColorAt(e,pe),this._beam.setMatrixAt(e,ct.matrixWorld),this._beam.setColorAt(e,pe),this._pegs.setMatrixAt(e,ct.matrixWorld),this._pegs.setColorAt(e,ps),this._lines.setMatrixAt(e,ct.matrixWorld),this._lines.setColorAt(e,ms),ct.updateMatrixWorld(!0),this._pole.instanceMatrix.needsUpdate=!0,this._pole.instanceColor.needsUpdate=!0,this._beam.instanceMatrix.needsUpdate=!0,this._beam.instanceColor.needsUpdate=!0,this._pegs.instanceMatrix.needsUpdate=!0,this._pegs.instanceColor.needsUpdate=!0,this._lines.instanceMatrix.needsUpdate=!0,this._lines.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._poleInstances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._poleInstances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(500,750)).start()})}):Promise.resolve()}}const qt=new ks;class Vt extends Zt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){At.add({position:this._position}),Ot.add({position:this._position}),qt.add({position:this._position,direction:this._direction})}}var zs="/atc-gjk/assets/helvetiker_regular.typeface.d5c54676.json",Ms="/atc-gjk/assets/helvetiker_bold.typeface.bd68159e.json";const Es=new _n,Is=async r=>new Promise((t,e)=>{Es.load(r,n=>t(n),null,n=>e(n))}),Ss=[zs,Ms],Xe=await Promise.all(Ss.map(async r=>await Is(r)));Xe[0];const De=Xe[1],Re=G.clone();Re.color.set(cs);const Ue=G.clone();Ue.color.set(ds);const Ye=G.clone();Ye.color.set(us);const Ne=G.clone();Ne.color.set(hs);const Ze=G.clone();Ze.color.set(Jn);class Cs{_tiles=[];_airstrip=null;_strips=null;_stripes=null;_greenLightMeshes=null;_greenLights=null;_redLightMeshes=null;_redLights=null;_label=null;_tick=0;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._airstrip=null,this._strips=null,this._stripes=null,this._greenLightMeshes=null,this._redLightMeshes=null,this._greenLights=null,this._redLights=null,this._label=null,this._tick=0}create(){this._airstrip=new Q,this._greenLights=new Q,this._redLights=new Q;const t=[],e=[],n=[],s=[],o=[];if(this._tiles.forEach((a,i)=>{const c=_s.clone();c.rotateY(a.direction*Math.PI/-4),c.translate(a.position.x*10,.1+a.position.y*5,a.position.z*10),t.push(c);for(let w=0;w<7;w++){const f=ys.clone();f.translate(0,0,-3+w),f.rotateY(a.direction*Math.PI/-4),f.translate(a.position.x*10,.2+a.position.y*5,a.position.z*10),e.push(f)}for(let w=0;w<5;w++){const f=me.clone();f.translate(-1+w*.5,0,4),f.rotateY(a.direction*Math.PI/-4),f.translate(a.position.x*10,a.position.y*5,a.position.z*10),n.push(f);const k=me.clone();k.translate(-1+w*.5,0,-4),k.rotateY(a.direction*Math.PI/-4),k.translate(a.position.x*10,a.position.y*5,a.position.z*10),s.push(k)}const d=new ke(`AP${i+1}`,{font:De,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});d.center(),d.scale(.01,.01,.01),d.translate(0,-3,0),d.rotateX(Math.PI/-2),d.rotateY(a.direction*Math.PI/-4),d.translate(a.position.x*10,.2+a.position.y*5,a.position.z*10),o.push(d);const l=new T,p=new Ut(65280,1.2,3);p.translateX(-1.5),p.translateZ(4),p.visible=!1,l.add(p),l.translateX(a.position.x*10),l.translateY(.5),l.translateZ(a.position.z*10),l.rotateY(a.direction*Math.PI/-4);const g=new T,u=new Ut(16711680,1.2,3);u.translateX(1.5),u.translateZ(-4),u.visible=!1,g.add(u,u),g.translateX(a.position.x*10),g.translateY(.5),g.translateZ(a.position.z*10),g.rotateY(a.direction*Math.PI/-4),this._greenLights.add(l),this._redLights.add(g)}),this._tiles.length){const a=N(t),i=N(e),c=N(n),d=N(s),l=N(o);this._strips=new D(a,Re),this._stripes=new D(i,Ue),this._greenLightMeshes=new D(c,Ye),this._redLightMeshes=new D(d,Ne),this._labels=new D(l,Ze),this._greenLightMeshes.position.y=.2,this._redLightMeshes.position.y=.2,this._airstrip.add(this._strips,this._stripes,this._greenLightMeshes,this._redLightMeshes,this._labels,this._greenLights,this._redLights)}return this._airstrip}_animate=()=>{this._greenLights&&this._greenLights.children.forEach(t=>{if(this._tick>=160){const e=this._tick%160;(e===0||e===10||e===20||e===30||e===40)&&(t.children[0].visible=!0,t.translateX(.5)),e===41&&(t.children[0].visible=!1),e===159&&(t.children[0].visible=!0,t.translateX(-2.5))}}),this._redLights&&this._redLights.children.forEach(t=>{if(this._tick>=160){const e=this._tick%160;(e===50||e===60||e===70||e===80||e===90)&&(t.children[0].visible=!0,t.translateX(.5)),e===91&&(t.children[0].visible=!1),e===49&&(t.children[0].visible=!0,t.translateX(-2.5))}}),this._tick++};animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._airstrip.scale.setScalar(t.scale)}}const Nt=new Cs;class Ps extends Zt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){At.add({position:this._position}),Bt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Ot.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Nt.add({position:this._position,direction:this._direction})}}const ye=[Pe,Le,Ae,Oe],nt=new T;class Ls{_tiles=[];_clouds=new T;_animate=()=>{};_instances=[];_tick=0;_pause=!1;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._clouds=new T,this._animate=()=>{},this._instances=[],this._tick=0}create(){let t=0;return this._tiles.forEach(e=>{const n=z(12,24);t+=n;const s=ye[z(0,ye.length-1)],o=z(5,9);for(let a=0;a<n;a++)this._instances.push({pos:{x:-4.8+Math.random()*9.6,y:-.4+Math.random()*.8,z:-4.8+Math.random()*9.6},rot:{x:Math.PI*2*Math.random(),y:Math.PI*2*Math.random(),z:Math.PI*2*Math.random()},altitude:e.position.y||o,animation:{direction:Math.random()>.5?1:-1,speed:z(200,300)},scale:.5+Math.random()*1.5,color:s,isReady:!1,tile:e})}),this._clouds=new it(Ge,gs,t),this._animate=()=>{this._pause||(this._instances.forEach((e,n)=>{const{isReady:s}=e;s&&this.updateInstance(e,n)}),this._tick++)},this._clouds}async next(t=0){await this.animateNext(t)}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:i,animation:c,tile:d,altitude:l}=t,{x:p,y:g,z:u}=s,{x:w,y:f,z:k}=o,{direction:q,speed:v}=c,_=Math.sin((this._tick+e*50)/10/Math.PI)/20;nt.position.set(p+d.position.x*10,l*5+(g+_)*a,u+d.position.z*10),nt.rotation.set(w,f,k+this._tick/v*q),n?nt.scale.set(n.x,n.y,n.z):nt.scale.setScalar(a),nt.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,nt.matrixWorld),this._clouds.setColorAt(e,i),this._clouds.instanceMatrix.needsUpdate=!0,this._clouds.instanceColor.needsUpdate=!0}updateInstancePosition(t,e,n){const{pos:s,altitude:o,scale:a,rot:i,animation:c}=t,{x:d,y:l,z:p}=i,{direction:g,speed:u}=c,w=Math.sin((this._tick+e*50)/10/Math.PI)/20;nt.position.set(s.x+n.x*10,o*5+(s.y+w)*a,s.z+n.z*10),nt.rotation.set(d,l,p+this._tick/u*g),nt.scale.setScalar(a),nt.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,nt.matrixWorld),this._clouds.instanceMatrix.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(()=>{e.isReady=!0,t()}).delay(z(1e3,1250)).start()})}):Promise.resolve()}async animateNext(){return this._tiles.length?new Promise(t=>{this._pause=!0,this._instances.forEach((e,n)=>{const s=Dt(e.tile.position,e.tile.direction),o=e.tile.position,a=s;this.updateInstancePosition(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>this.updateInstancePosition(e,n,o)).onComplete(()=>{this._pause=!1,t()}).delay(z(250,500)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onStart(()=>e.isReady=!1).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(z(250,500)).start()})}):Promise.resolve()}}const Lt=new Ls,As=new x(16777215),Os=r=>{const t=Y.clone();t.scale(1,1,2),I(0,t,-.2,-.1),I(2,t,-.2,.3),I(4,t,.2,-.1),I(6,t,.2,.3);const e=Y.clone();e.scale(3,.1,1),I(1,e,.2,.05),I(3,e,.2,-.05),I(5,e,-.2,.05),I(7,e,-.2,-.05);const n=Y.clone();n.scale(.1,.75,.5),n.translate(0,.5,.95),I(0,n,-.04,.05),I(2,n,-.04),I(3,n,0,-.05),I(4,n,.04,.05),I(6,n,.04),I(7,n,0,-.05);const s=Y.clone();s.scale(.4,.5,.6);const o=s.clone();o.translate(0,-.3,.6),o.rotateX(-.2);const a=s.clone();a.translate(.3,-.3,-.65);const i=s.clone();i.translate(-.3,-.3,-.65);const c=N([t,e,n,o,a,i]),d=Y.clone();d.scale(.7,.4,.05),d.translate(0,.5,-.7),d.rotateX(.2),I(0,d,-.05),I(1,d,-.05),I(4,d,.05),I(5,d,.05);const l=N([d]),p=Y.clone();p.scale(1,1,.5),p.translate(0,0,-1.25),I(1,p,-.1,-.1),I(3,p,-.1,.1),I(5,p,.1,-.1),I(7,p,.1,.1);const g=Y.clone();g.scale(.1,.1,.5),I(2,g,null,null,.01),I(1,g,null,null,-.009),I(3,g,null,null,-.009),I(7,g,null,null,-.01);const u=g.clone();u.rotateZ(Math.PI/4),u.rotateY(.2),u.translate(.5,.2,-1.05);const w=g.clone();w.rotateZ(Math.PI/4),w.translate(.55,.2,-.55);const f=g.clone();f.rotateZ(Math.PI/4)+Math.PI/2,f.rotateY(-.2),f.translate(-.5,.2,-1.05);const k=g.clone();k.rotateZ(Math.PI/4),k.translate(-.55,.2,-.55);const q=N([p,u,w,f,k]),v=Y.clone();v.scale(.2,.2,.2),v.translate(0,0,-1.55),I(0,v,.07,.07),I(2,v,.07,-.07),I(4,v,-.07,.07),I(6,v,-.07,-.07);const _=Y.clone();_.scale(.2,.4,.4);const y=_.clone();y.translate(0,-.6,.6),y.rotateX(-.2);const $=_.clone();$.translate(-.3,-.6,-.65);const V=_.clone();V.translate(.3,-.6,-.65);const ut=N([v,y,$,V]),W=Y.clone();W.scale(.15,1.5,.05),W.translate(0,0,-1.6);const j=W.clone();j.rotateZ(Math.PI/2);const vt=N([W,j]),xt=Y.clone();xt.scale(.34,.2,.2);const kt=xt.clone();kt.translate(0,-.6,.6),kt.rotateX(-.2);const X=xt.clone();X.translate(-.3,-.6,-.65);const R=xt.clone();R.translate(.3,-.6,-.65);const ot=N([kt,X,R]),rt=Rt.clone();rt.scale(1.2,.42,1.2),rt.rotateX(Math.PI),rt.translate(0,2,0);const K=N([rt]),gt=Y.clone();gt.scale(.1,.1,.1),gt.translate(1.7,0,-.5);const zt=Y.clone();zt.scale(.1,.1,.1),zt.translate(-1.7,0,-.5);const Mt=new Q;Mt.name="plane";const J=G.clone();J.color.set(r),J.name="base";const $t=Ht.clone(),Gt=G.clone(),te=G.clone(),Ft=G.clone(),ee=G.clone(),ne=Ht.clone(),se=Ht.clone(),Fe=new x(14872564),We=new x(0),He=new x(10053706),je=new x(16777215),Qe=new x(65280),qe=new x(65280),Ve=new x(16711680);$t.color.set(Fe),Gt.color.set(je),te.color.set(He),Ft.color.set(We),ee.color.set(Qe),ne.color.set(qe),se.color.set(Ve);const Ke=new D(c,J),Je=new D(l,$t),tn=new D(q,Gt),en=new D(ut,Ft),oe=new D(vt,Ft);oe.name="props";const nn=new D(ot,te),Wt=new D(K,ee);Wt.name="selector",Wt.visible=!1;const sn=new D(gt,ne),on=new D(zt,se),Et=new Ut(65280,1.2,3);Et.name="green",Et.translateX(1.7),Et.translateY(0),Et.translateZ(-.6);const It=new Ut(16711680,1.2,3);return It.name="red",It.translateX(-1.7),It.translateY(0),It.translateZ(-.6),Mt.add(Ke,Je,tn,en,oe,nn,Wt,sn,on,Et,It),Mt};class Be{_startTime=0;_position={x:0,y:0,z:0};_direction=0;_targetAltitude=0;_targetDirection=0;_start=null;_end=null;_spawned=!1;_takenOff=!1;_landed=!1;_isGhost=!1;_isSelected=!1;_name="";_id=null;_color=null;_model=null;_tick=0;_fuel=0;_flightStatus=P.SCHEDULED;constructor(t){const{id:e,start:n,end:s,fuel:o,startTime:a}=t;return this._start=n,this._end=s,this._position=n.position,this._direction=n.direction,this._targetAltitude=this._position.y||1,this._takenOff=this._position.y!==0,this._id=e,this._name="GJK",this._color=new x(Math.random()*16777215),this._fuel=o,this._startTime=a,this.create(),this}animate=()=>this.animateIdle();updateAnimation(t){this._model.position.x=t.position.x*10,this._model.position.y=t.position.y*5,this._model.position.z=t.position.z*10,this._model.scale.setScalar(t.scale)}animateIn(t=1250,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this;let a,i;this._takenOff?(a={position:Yn({...s},o),direction:o,scale:0},i={position:{...s},direction:o,scale:1}):(a={position:{...s},direction:o,scale:0},i={position:{...s},direction:o,scale:1},a.position.y=.18,i.position.y=.18),this.updateAnimation(a),new m.Tween(a).to(i,e).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()})}animateOut(t=0,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this,a={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._direction,scale:1},i={position:Dt(s,o),direction:this._direction,scale:0};this.updateAnimation(a),new m.Tween(a).to(i,e).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()})}animateIdle(){const t=Math.sin(this._tick/10/Math.PI)/100,e=Math.sin(this._tick/15/Math.PI)/10,n=Math.sin(this._tick/20/Math.PI)/20;this._position.y>=1&&(this._model.position.y+=t,this._model.rotation.z=e,this._model.rotation.x=n),this._model.children.forEach(s=>{s.name==="props"&&(s.rotation.z+=.3),s.name==="selector"&&(s.rotation.y+=.01,s.position.y+=t),s.name==="green"&&(this._tick%120===0&&(s.visible=!0),this._tick%120===4&&(s.visible=!1)),s.name==="red"&&(this._tick%120===40&&(s.visible=!0),this._tick%120===44&&(s.visible=!1))}),this._tick++}create(){const t=Os(this._color);t.position.x=this._position.x*10,t.position.z=this._position.z*10,t.position.y=this._position.y*5,t.rotation.y=this._direction*(Math.PI/-4),this._takenOff||t.rotateX(.1),t._id=this._id,this._model=t}async next(t=0,e=1){const n=Dt(this._position,this._direction);let s=0,o=0;this._targetAltitude>this._position.y?s=1:this._targetAltitude<this._position.y&&(s=-1),this._targetDirection>0?(this._targetDirection--,o=1):this._targetDirection<0&&(this._targetDirection++,o=-1),await this.animateNext(s,o,t,e,this._takenOff?0:.1),this.unsetGhost(),this._takenOff=!0,this._flightStatus=P.IN_FLIGHT,n.y+=s,this._position=n,this._direction=(8+(this._direction+o))%8,this._model.rotation.y=this._direction*(Math.PI/-4),this._fuel-=1}async animateNext(t,e,n=0,s=1){return new Promise(o=>{const a={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._model.rotation.y,scale:s},i=Dt(this._position,this._direction);i.y+=t,i.y===0&&(i.y=.18);const c={position:i,direction:this._model.rotation.y+e*Math.PI/-4,scale:1};new m.Tween(a).to(c,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>this.updateAnimation(a,this._targetDirection>0)).onComplete(o).delay(n).start()})}setGhost(){this._isGhost=!0,this._model.children.forEach(t=>{t.material&&t.material.name==="base"&&t.material.color.set(As),t.material&&t.material.name!=="selector"&&(t.material.transparent=!0,t.material.opacity=.75,t.material.needsUpdate=!0)})}unsetGhost(){this._isGhost=!1,this._model.children.forEach(t=>{t.material&&t.material.name==="base"&&t.material.color.set(this._color),t.material&&t.material.name!=="selector"&&(t.material.transparent=!1,t.material.opacity=1,t.material.needsUpdate=!0)})}setSpawned(){this._spawned=!0,this._flightStatus=P.APPROACHING}setExited(){this._flightStatus=P.EXITED}setLanded(){this._flightStatus=P.LANDED}setLost(){this._flightStatus=P.LOST}setCrashed(){this._flightStatus=P.CRASHED}setSelected(){this._isSelected=!0,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!0)})}unsetSelected(){this._isSelected=!1,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!1)})}setHeight(t){this._targetAltitude=t}setDirection(t){this._targetDirection=t}}const Gs=new bt({color:3900150,flatShading:!0});class Ts{_tiles=[];_labels=new Q;constructor(){}add(t={position:{x:1,y:1,z:1},direction:0,text:"N"}){this._tiles.push(t)}reset(){this._tiles=[]}create(){return this._tiles.forEach(t=>{const e=new ke(t.text,{font:De,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});e.center(),e.scale(.03,.03,.03),e.rotateX(Math.PI/-2),e.rotateY(t.direction*Math.PI/-4),e.translate(t.position.x*10,-.5+t.position.y*5,t.position.z*10),this._labels.add(new D(e,Gs))}),this._labels}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._labels.scale.setScalar(t.scale)}}const dt=new Ts,be=r=>{r.dispose();for(const t of Object.keys(r)){const e=r[t];e&&typeof e=="object"&&"minFilter"in e&&e.dispose()}};class $e{_scene=null;_anims=[];_lights=[];_models=[];_fog=null;_elements=[dt,Jt,At,Bt,Ot,Lt,Nt,Te,qt];_airplanes=st([]);_clouds=Lt;_powerlines=qt;_board=null;_tick=st(-1);_tickWatcher=null;_isAnimating=!1;_score=st(0);_animate=()=>{Lt._animate(),Nt._animate(),this._airplanes.value.forEach(t=>t?.animate())};constructor(){this._scene=new ae,this._tickWatcher=wt(this._tick,t=>{t>=96&&(C.send("WIN"),this._tickWatcher())})}addLight(t){this._lights.push(t)}addFog(t){this._fog=t}addBoard(t){this._board=t}addAirplane(t){this._airplanes.value.push(t),this._scene.add(t._model)}removeAirplane(t){this._airplanes.value=this._airplanes.value.filter(n=>n._id!==t._id);const e=this._scene.getObjectById(t._model.id);this._scene.remove(e)}reset(){this._scene.traverse(t=>{if(!!t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)be(t.material);else for(const e of t.material)be(e)}),this._scene=new ae,this._board=null,this._anims=[],this._lights=[],this._models=[],this._fog=null,this._clouds=null,this._powerlines=null,this._airplanes.value=[],this._tick.value=-1,this._score.value=0,this._elements.forEach(t=>t.reset())}async animateIn(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateIn())),Promise.resolve()}async animateOut(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateOut())),Promise.resolve()}render(){this._scene.fog=this._fog,this._lights.forEach(t=>{this._scene.add(t)}),this._elements.forEach(t=>this._scene.add(t.create()))}}const Xs=[Vt],Ds=F(Xs);class Rs extends $e{start=()=>{const t=new ze(16777215,526338,.7);t.position.set(15,25,15);const e=new T;e.rotation.x=Math.PI/-3;const n=new Yt(16777215,.3);e.add(n),n.position.set(60,0,0),n.lookAt(e.position),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.near=.5,n.shadow.camera.far=500,n.shadow.camera.top=90,n.shadow.camera.bottom=-120,n.shadow.camera.left=-90,n.shadow.camera.right=90,e.rotation.y=Math.PI/-1.5;const s=new Yt(11592173,.2);s.position.set(-20,25,-10),this.addLight(t),this.addLight(e),this.addLight(s),new Ds({position:{x:0,y:0,z:0},direction:2});const o=new Be({id:0,start:{position:{x:0,y:1,z:0},direction:1,name:""},end:{position:{x:0,y:0,z:0},direction:1,name:""},fuel:100});this.addAirplane(o),Jt.add();const a=new Kt(new x(10209513),15,30);this.addFog(a);const i=new T;i.position.y=2.5,S.target=i.position}}class Us{_width=0;_depth=0;_difficulty=null;_airfields=0;_clouds=0;_airplanes=0;_airplanesQueue=[];_tiles=[];_tick=0;constructor(t=1){this._difficulty=Ce[t],this._width=he[this._difficulty].width,this._depth=he[this._difficulty].depth,this._airfields=z(ue[this._difficulty].min,ue[this._difficulty].max),this._clouds=z(Xt[this._difficulty].count.min,Xt[this._difficulty].count.max),this._airplanes=Ct[this._difficulty].amount}generate(){const t=Math.ceil(0-this._width/2),e=Math.ceil(0-this._depth/2),n=Math.abs(t),s=Math.abs(e);this._tiles=Array.from({length:this._depth},()=>Array.from({length:this._width},()=>null));const o=Math.random()>.5,a=F(o?[0,1,this._depth-1,this._depth-2]:[0,1,this._width-1,this._width-2]);o?this._tiles[a].forEach((u,w)=>{this._tiles[a][w]=new _e({position:{x:w+t,y:0,z:a+e},direction:2})}):this._tiles.forEach((u,w)=>{this._tiles[w][a]=new _e({position:{x:a+t,y:0,z:w+e}})});const i=[];for(let u=0;u<this._airfields;u++){const w=Rn(this._tiles,this._width,this._depth,3);if(w){const{x:f,z:k,tile:q}=w,v={position:q,direction:z(0,7),name:`AP${i.length+1}`};i.push(v),this._tiles[k][f]=new Ps(v),this._tiles[k-1][f-1]=new lt({position:{x:f+t-1,y:0,z:k+e-1}}),this._tiles[k-1][f]=new lt({position:{x:f+t,y:0,z:k+e-1}}),this._tiles[k-1][f+1]=new lt({position:{x:f+t+1,y:0,z:k+e-1}}),this._tiles[k][f-1]=new lt({position:{x:f+t-1,y:0,z:k+e}}),this._tiles[k][f+1]=new lt({position:{x:f+t+1,y:0,z:k+e}}),this._tiles[k+1][f-1]=new lt({position:{x:f+t-1,y:0,z:k+e+1}}),this._tiles[k+1][f]=new lt({position:{x:f+t,y:0,z:k+e+1}}),this._tiles[k+1][f+1]=new lt({position:{x:f+t+1,y:0,z:k+e+1}})}}const c=Math.random()>.5,d=Fn[this._difficulty],l=Dn(this._tiles,d,c),p=F(l);console.log(p);for(let u=0;u<d;u++)c?this._tiles[p.start.z][p.start.x+1]=new Vt({position:{x:p.start.x+t+u,y:0,z:p.start.z+e},direction:2}):this._tiles[p.start.z+u][p.start.x]=new Vt({position:{x:p.start.x+t,y:0,z:p.start.z+e+u},direction:0});this._tiles.forEach((u,w)=>{u.forEach((f,k)=>{if(!f)return new lt({position:{x:k+t,y:0,z:w+e}})})}),Jt.add({scale:{x:this._width,y:1,z:this._depth}});for(let u=0;u<this._clouds;u++){const w=z(Xt[this._difficulty].size.min,Xt[this._difficulty].size.max),f=Nn(this._width,this._depth,Ct[this._difficulty].height);for(let k=0;k<w;k++)for(let q=0;q<w;q++)Lt.add({position:{x:f.position.x+k,y:f.position.y,z:f.position.z+q},direction:f.direction})}const g=$n(2,96-(this._width+4),this._airplanes,2);for(let u=0;u<this._airplanes;u++){const w=Zn(this._width,this._depth,Ct[this._difficulty].height,i);let f=de(this._width,this._depth,Ct[this._difficulty].height,i);for(;w.name===f.name;)f=de(this._width,this._depth,Ct[this._difficulty].height,i);this._airplanesQueue.push(new Be({id:yn(),start:w,end:f,startTime:g[u],fuel:z(20,35)}))}dt.add({position:{x:0,y:0,z:e-2},direction:0,text:"N"}),dt.add({position:{x:n+1,y:0,z:e-1},direction:1,text:"NE"}),dt.add({position:{x:n+2,y:0,z:0},direction:2,text:"E"}),dt.add({position:{x:n+1,y:0,z:s+1},direction:3,text:"SE"}),dt.add({position:{x:0,y:0,z:s+2},direction:4,text:"S"}),dt.add({position:{x:t-1,y:0,z:s+1},direction:5,text:"SW"}),dt.add({position:{x:t-2,y:0,z:0},direction:6,text:"W"}),dt.add({position:{x:t-1,y:0,z:e-1},direction:7,text:"NW"}),this._airplanesQueue.sort((u,w)=>u._startTime<w._startTime?-1:u._startTime>w._startTime?1:0)}}class Ys extends $e{start(){const t=new ze(16777215,526338,.7);t.name="hemi",t.position.set(15,25,15);const e=new T;e.name="sun";const n=new Yt(16777215,.3),s=new ie(n,5);e.add(n),n.position.set(0,60,0),n.castShadow=!0,n.shadow.mapSize.width=2048,n.shadow.mapSize.height=2048,n.shadow.camera.near=.5,n.shadow.camera.far=500,n.shadow.camera.top=90,n.shadow.camera.bottom=-120,n.shadow.camera.left=-90,n.shadow.camera.right=90;const o=new Yt(11592173,.2);n.name="sunlight";const a=new ie(o,5);o.position.set(-20,25,-10);const i=new T;i.position.y=2.5,S.target=i.position,this.addLight(t),this.addLight(e),this.addLight(s),this.addLight(a),this.addLight(o);const c=new Kt(new x(10209513),15,350);e.rotation.x=Math.PI/4,e.rotation.z=Math.PI;const d=new Us(C.state.context.difficulty);d.generate(),this.addFog(c),this.addBoard(d),this.nextTick()}async nextTick(){if(!this._isAnimating){this._isAnimating=!0,this._tick.value++,this._airplanes.value=this._airplanes.value.filter(s=>{if(s._flightStatus===P.LANDED||s._flightStatus===P.EXITED||s._flightStatus===P.LOST)this.removeAirplane(s);else return s});const t=Promise.all(this._airplanes.value.map(s=>s.next())),e=Promise.all(this._board._airplanesQueue.filter(s=>s._startTime===this._tick.value).map(s=>(this.addAirplane(s),s.setSpawned(),s.setGhost(),s.animateIn(0,500)))),n=new Promise(s=>{const o=this._lights.find(c=>c.name==="sun"),a={rot:o.rotation.z},i={rot:o.rotation.z+Math.PI*2*(1/96)};new m.Tween(a).to(i,500).easing(m.Easing.Quadratic.InOut).onUpdate(()=>o.rotation.z=a.rot).onComplete(s).start()});this._tick.value%Math.floor(96/this._board._width)===0&&this._tick.value>0&&await this._clouds.next(),await t,await e,await n,this.checkObstructions(),this.checkCollisions(),this.checkDestinations(),this.checkOutOfBounds(),this.checkOutOfFuel(),this._isAnimating=!1}}checkObstructions(){const t=0-Math.floor(this._board._width/2),e=0-Math.floor(this._board._depth/2),n=Math.abs(t),s=Math.abs(e);this._airplanes.value.forEach(o=>{const{x:a,y:i,z:c}=o._position;let d=!1,l=!1;Lt._tiles.forEach(p=>{const{x:g,y:u,z:w}=p.position;g===a&&u===i&&w===c&&(d=!0)}),(a<t||a>n||c<e||c>s)&&(l=!0),(d||l)&&o.setGhost()})}checkCollisions(){this._airplanes.value.forEach(t=>{const{x:e,y:n,z:s}=t._position;t._takenOff&&(n===0&&Nt._tiles.forEach(o=>{const{x:a,y:i,z:c}=o.position;e===a&&s===c&&t._direction===o.direction?console.log("plane landed on airport, check if it's the right airport!"):(console.log(`plane crashed at ${a}, ${i}, ${c}`),C.send("LOSE"))}),this._airplanes.value.forEach(o=>{if(t._id!==o._id){const{x:a,y:i,z:c}=o._position;e===a&&n===i&&s===c&&C.send("LOSE")}}),this._powerlines._tiles.forEach(o=>{const{position:{x:a,z:i}}=o;e===a&&s===i&&n<=2&&C.send("LOSE")}))})}checkDestinations(){this._airplanes.value.forEach(t=>{if(t._takenOff){const{x:e,y:n,z:s}=t._position,o=t._direction,{position:{x:a,y:i,z:c},direction:d}=t._end;e===a&&n===i&&s===c&&o===d?(this._score.value+=100+t._fuel*10,t.setGhost(),n===0?t.setLanded():t.setExited()):n===0&&(console.log("game over!"),t.setCrashed(),C.send("LOSE"))}})}checkOutOfBounds(){this._airplanes.value.forEach(t=>{const{x:e,z:n}=t._position,s=0-Math.ceil(this._board._width/2),o=0-Math.ceil(this._board._depth/2),a=Math.abs(s),i=Math.abs(o);(e<=s||e>=a||n<=o||n>=i)&&t._flightStatus!==P.APPROACHING&&t._startTime<this._tick.value&&(this._score.value-=500,t.setLost())})}checkOutOfFuel(){this._airplanes.value.forEach(t=>{t._fuel<=0&&(console.log("game over!"),C.send("LOSE"))})}selectPlane(t){this._airplanes.value.forEach(e=>{if(e._id===t&&e._isSelected){e.unsetSelected();return}e.unsetSelected(),e._id===t&&!e._isGhost&&e.setSelected()})}}const A={props:{size:{type:String,default:"md"},isDisabled:{type:Boolean,default:!1},isPrimary:{type:Boolean,default:!1},isSecondary:{type:Boolean,default:!1}},setup(r){const t=r,{size:e,isDisabled:n,isPrimary:s,isSecondary:o}=bn(t),a=pt(()=>{switch(e.value){case"control":return["w-7 min-h-7"];case"xs":return[];case"md":default:return[]}}),i=pt(()=>{const l=["blur-[2px]",!s.value&&!o.value&&"bg-gray-800",n.value&&"bg-gray-600",s.value&&!n.value&&"bg-blue-800",o.value&&!n.value&&"bg-blue-600"];switch(e.value){case"control":return[...l,"rounded-sm translate-y-[1px] group-active:translate-y-[0px] group-hover:translate-y-[2px]"];case"xs":return[...l,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"];case"sm":return[...l,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"];case"md":default:return[...l,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"]}}),c=pt(()=>{const l=[!s.value&&!o.value&&"group-hover:bg-gray-300",n.value&&"bg-gray-400",n.value&&o.value&&"bg-gray-500",n.value&&s.value&&"bg-gray-600",s.value&&!n.value&&"bg-blue-800 group-hover:bg-blue-900",o.value&&!n.value&&"bg-blue-400 group-hover:bg-blue-500"];switch(e.value){case"control":return[...l,"w-7 min-h-7 p-[2px] rounded-sm"];case"xs":return[...l,"py-1 px-1 rounded"];case"sm":return[...l,"py-2 px-5 rounded"];case"md":default:return[...l,"py-3 px-7 rounded"];case"lg":return[...l,"py-4 px-8 rounded"]}}),d=pt(()=>{const l=[!s.value&&!o.value&&!n.value&&"text-gray-800 group-hover:bg-gray-100",n.value&&"bg-gray-200 border-gray-300 text-gray-400 cursor-not-allowed",n.value&&o.value&&"bg-gray-300 border-gray-400 text-gray-500 cursor-not-allowed",n.value&&s.value&&"bg-gray-400 border-gray-500 text-gray-600 cursor-not-allowed",s.value&&!n.value&&"bg-blue-500 border-blue-700 text-white group-hover:bg-blue-600",o.value&&!n.value&&"bg-blue-200 border-blue-300 text-blue-700 group-hover:bg-blue-300"];switch(e.value){case"control":return[...l,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[3px]","absolute inset-0 border rounded-sm text-xs -translate-y-[1px]"];case"xs":return[...l,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-1 px-1 text-xs rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"sm":return[...l,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-2 px-5 text-sm rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"md":default:return[...l,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-2 px-7 text-sm rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"lg":return[...l,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-3 px-8 text-xl rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"]}});return(l,p)=>(Z(),B("button",{class:_t(["relative group select-none",b(a)])},[h("span",{class:_t(["absolute inset-0 bg-opacity-50 transition-transform transform",b(i)])},null,2),h("span",{class:_t(["absolute inset-0 bg-gray-200",b(c)])},null,2),h("span",{class:_t(["flex justify-center items-center bg-white font-bold transition-all transform",b(d)])},[xn(l.$slots,"default")],2)],2))}};const Ns=h("div",{id:"three"},null,-1),Zs={key:0,class:"absolute top-32 left-1/2 transform -translate-x-1/2"},Bs=h("h1",{class:"font-callout text-6xl stage"},[h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("div",{class:"layer"}),h("span",{class:"opacity-0"},"Air Traffic Control")],-1),$s=[Bs],Fs={key:0,class:"fixed bottom-1/4 left-1/2 transform -translate-x-1/2"},Ws=L(" Play "),Hs={key:0,class:"fixed top-3 right-2"},js={key:0,class:"fixed top-2 left-1/2 transform -translate-x-1/2 bg-white rounded shadow-block origin-top"},Qs={class:"pt-2 pb-3 px-4 text-center text-sm"},qs=h("div",{class:"font-bold text-gray-800"}," Score ",-1),Vs={key:0,class:"fixed top-2 right-2 text-xs font-bold origin-top-right"},Ks={class:"absolute -bottom-16 left-1/2 w-16 transform -translate-x-1/2 bg-white pt-2 pb-3 px-3 rounded shadow-block text-center"},Js=h("div",{class:"font-bold text-sm"}," Time ",-1),to={class:"text-blue-500"},eo={key:0,class:"fixed bottom-2 right-2 w-80 bg-white rounded shadow-block origin-bottom-right"},no={class:"p-2 pb-3 text-center"},so=h("div",{class:"font-bold text-sm text-gray-800"}," Flight Schedule ",-1),oo={class:"space-y-1 max-h-48 overflow-auto mt-2"},ao={class:"text-sm font-bold w-full"},io=h("thead",null,[h("tr",{class:"sticky top-0 bg-white bg-opacity-80"},[h("th",{class:"font-bold text-sm text-gray-700"}," Time "),h("th",{class:"font-bold text-sm text-gray-700"}," Status "),h("th",{class:"font-bold text-sm text-gray-700"}," Entry "),h("th",{class:"font-bold text-sm text-gray-700"}," Exit "),h("th",{class:"font-bold text-sm text-gray-700"}," Fuel ")])],-1),ro={class:"text-xs"},lo=["onClick"],co={class:"py-1"},ho={class:"py-1"},uo={class:"py-1"},po={class:"py-1"},mo={class:"py-1"},go={key:0,class:"fixed top-3 left-2 origin-top-left"},fo=L(" Quit "),wo={class:"fixed bottom-2 left-2 bg-white rounded shadow-block origin-bottom-left"},_o={class:"p-2 pb-3 text-center"},yo=h("div",{class:"font-bold text-sm text-gray-800"}," Flight Controls ",-1),bo={class:"flex"},xo={class:"p-2 space-y-1"},vo=h("div",{class:"font-bold text-sm text-gray-700"}," Direction ",-1),ko={class:"grid grid-cols-3 gap-1"},zo=L(" 45 "),Mo=L(" \u2191 "),Eo=L(" 45 "),Io=L(" 90 "),So=L(" 90 "),Co=L(" 135 "),Po=L(" L "),Lo=L(" 135 "),Ao=L(" 180 "),Oo=L(" \u221E "),Go=L(" 180 "),To={class:"p-2 space-y-1"},Xo=h("div",{class:"font-bold text-sm text-gray-700"}," Altitude ",-1),Do={class:"grid grid-cols-3 gap-1"},Ro={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Uo={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block"},Yo=h("h2",{class:"text-base font-bold"}," Are you sure you want to quit? ",-1),No={class:"flex space-x-4 items-center justify-center mt-6"},Zo=L(" No "),Bo=L(" Yes "),$o={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Fo=h("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80"},null,-1),Wo={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block"},Ho=h("h2",{class:"text-base font-bold"}," You lost! ",-1),jo={class:"flex space-x-4 items-center justify-center mt-6"},Qo=L(" Admit Defeat "),qo={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Vo=h("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80"},null,-1),Ko={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block text-center"},Jo={class:"text-base font-bold"},ta={class:"mt-2 text-sm"},ea=L(" You scored a total of "),na=L(" points. "),sa={class:"flex space-x-4 items-center justify-center mt-6"},oa={setup(r){vn(v=>({"34b637ab":b(q)}));let t=null,e=null;const n=st([]),s=pt(()=>ce(e._tick.value)),o=pt(()=>e._score.value),a=(v,_)=>{const y=v._id===l.value?._id,$=v._flightStatus===P.IN_FLIGHT,V=[v._flightStatus===P.APPROACHING&&"bg-blue-200 text-blue-400 cursor-not-allowed",v._flightStatus===P.SCHEDULED&&"text-gray-400 cursor-not-allowed",v._flightStatus===P.LANDED&&"bg-teal-100 text-teal-500 cursor-not-allowed",v._flightStatus===P.EXITED&&"bg-teal-100 text-teal-500 cursor-not-allowed",v._flightStatus===P.LOST&&"bg-rose-100 text-rose-400 cursor-not-allowed"],ut=["bg-blue-500 text-white hover:bg-blue-600 border-b-2 border-blue-800"],W=[!y&&_%2===0&&"bg-gray-100",!y&&"hover:bg-gray-200"];return[...y?[]:V,...y?ut:[],...$?W:[]]},i=st("#ecfeff"),c=st("#7dd3fc");kn(()=>{On(),S.autoRotate=!1,S.enablePan=!0;let v,_,y;C.onTransition(async X=>{if(X.changed&&X.matches("introIn")&&(S.autoRotate=!0,t=new Rs,t.start(),t.render(),await t.animateIn(),C.send("DONE")),X.changed&&X.matches("introOut")&&(S.enableRotate=!1,S.autoRotate=!1,await t.animateOut(),C.send("DONE")),X.changed&&X.matches("gameIn")){t.reset(),e=new Ys,v=wt(e._tick,ot=>{clearInterval(f.value),w.value=0,f.value=setInterval(()=>{w.value++},1e3);const rt=ot/96,K=Math.sin(rt*Math.PI);i.value=St("#4a6263","#ecfeff",K),c.value=St("#1d3743","#7dd3fc",K);const gt=St("#1d3743","#9bc8e9",K),zt=St("#1d3743","#9bc8e9",K),Mt=St("#c09db2","#f4efd4",K);e._scene.fog=new Kt(new x(gt),15,350),e._scene.children.forEach(J=>{J.name==="hemi"&&(J.color=new x(zt)),J.name==="sun"&&(J.children[0].color=new x(Mt))}),n.value=e._board._airplanesQueue.map(J=>e._airplanes.value.find(Gt=>Gt._id===J._id)||J)}),e.start(),e.render();const R=O.position;new m.Tween(R).to({x:80,y:35,z:80},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>O.position.set(R.x,R.y,R.z)).onComplete(()=>{S.enableRotate=!0,S.enableZoom=!0,C.send("DONE")}).start(),await e.animateIn()}if(X.changed&&X.matches("gamePlaying")&&(S.enableRotate=!0,_=wt(e._airplanes,R=>{R.find(ot=>ot._id===l.value?._id)||(l.value=null)}),y=wt(n,R=>{R.every(ot=>ot._flightStatus===P.LANDED||ot._flightStatus===P.EXITED||ot._flightStatus===P.LOST)&&C.send("WIN")})),X.changed&&X.matches("gameOut")){S.enableRotate=!1;const R=O.position;new m.Tween(R).to({x:15,y:9,z:15},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>O.position.set(R.x,R.y,R.z)).onComplete(()=>{S.enableRotate=!0,S.enableZoom=!0,C.send("DONE")}).delay(500).start(),await e.animateOut(),e.reset(),i.value="#ecfeff",c.value="#7dd3fc",v(),_(),y()}});let $=0,V=1/60;const ut=new zn,W=new Mn;let j=!1;const vt=X=>{j=!0,W.x=X.clientX/window.innerWidth*2-1,W.y=-(X.clientY/window.innerHeight)*2+1},xt=()=>{j=!1};ht.setAnimationLoop(async X=>{if($+=Xn.getDelta(),le.begin(),C.state.hasTag("intro")&&t?._scene)ht.render(t._scene,O),$>V&&t._animate();else if(C.state.hasTag("board")&&e?._scene){if(j){ut.setFromCamera(W,O);const rt=ut.intersectObjects(e._scene.children).sort((K,gt)=>K.distance<gt.distance).find(K=>K.object.parent.name==="plane");rt&&(p(rt.object.parent),j=!1)}ht.render(e._scene,O),$>V&&e._animate()}S.update(),m.update(X),le.end(),$=$%V});const kt=()=>{O.aspect=window.innerWidth/window.innerHeight,O.updateProjectionMatrix(),ht.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",kt,!1),window.addEventListener("mousedown",vt),window.addEventListener("mouseup",xt),C.send("INTRO_IN")});const d=async()=>{await e.nextTick()};st(!1);const l=st(null);wt(l,v=>{v||Tn()});const p=v=>{if(e.selectPlane(v._id),l.value=e._airplanes.value.find(_=>_._isSelected),l.value){const _=S.target,y=l.value._model.position;new m.Tween(_).to(y,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>S.target=_).start();const{x:$,y:V,z:ut}=l.value._model.position,W=Bn(l.value._direction),j={x:O.position.x,y:O.position.y,z:O.position.z},vt={x:$+20*W.x,y:V+10,z:ut+20*W.z};new m.Tween(j).to(vt,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{O.position.set(j.x,j.y,j.z),S.update()}).start()}},g=v=>{l.value&&!l.value._isGhost&&l.value.setHeight(v)},u=v=>{l.value&&!l.value._isGhost&&l.value.setDirection(v)},w=st(0),f=st(null);wt(w,async v=>{v===30&&await e.nextTick()}),wt(U,v=>{(v.matches("gamePlaying.lose")||v.matches("gamePlaying.win")||v.matches("gameOut"))&&clearInterval(f.value)});const k=pt(()=>({background:`conic-gradient(#3b82f6 ${w.value/30*360}deg, transparent ${w.value/30*360}deg)`})),q=pt(()=>`radial-gradient(${i.value}, ${c.value})`);return(v,_)=>(Z(),B(Tt,null,[Ns,h("div",null,[M(tt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)]","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:E(()=>[b(U).matches("introIdle")?(Z(),B("div",Zs,$s)):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)] delay-100","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in delay-200","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:E(()=>[b(U).matches("introIdle")?(Z(),B("div",Fs,[M(A,{size:"lg",onClick:_[0]||(_[0]=y=>b(C).send("INTRO_OUT"))},{default:E(()=>[Ws]),_:1})])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)] delay-200","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in delay-100","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:E(()=>[b(U).matches("introIdle")?(Z(),B("div",Hs,[M(A,{"is-secondary":b(U).context.difficulty===1,"is-primary":b(U).context.difficulty===2,onClick:_[1]||(_[1]=y=>b(C).send("DIFFICULTY"))},{default:E(()=>[L(H(b(Ce)[b(U).context.difficulty]),1)]),_:1},8,["is-secondary","is-primary"])])):et("",!0)]),_:1}),b(U).hasTag("board")?(Z(),B(Tt,{key:0},[M(tt,{"enter-active-class":"transition duration-200 ease-in-out delay-100","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out delay-300","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying")?(Z(),B("div",js,[h("div",Qs,[qs,h("div",{class:_t(["font-bold",b(o)<0?"text-rose-500":b(o)>0?"text-green-500":"text-blue-500"])},H(b(o)),3)])])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-200 ease-in-out delay-200","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out delay-200","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying")?(Z(),B("div",Vs,[h("div",{class:"flex justify-center items-center rounded-full w-16 h-16 shadow-block bg-white cursor-pointer transform hover:bg-blue-200 transition-colors",onClick:d},[h("div",{class:"rounded-full w-16 h-16 border-2 border-white",style:En(b(k))},null,4)]),h("div",Ks,[Js,h("div",to,H(b(s)),1)])])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-200 ease-in-out delay-300","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out delay-100","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying")?(Z(),B("div",eo,[h("div",no,[so,h("div",oo,[h("table",ao,[io,h("tbody",ro,[(Z(!0),B(Tt,null,re(n.value,(y,$)=>(Z(),B("tr",{key:y._id,class:_t(["transition-colors cursor-pointer",a(y,$)]),onClick:V=>y._flightStatus===b(P).IN_FLIGHT?p(y):null},[h("td",co,H(b(ce)(y._startTime)),1),h("td",ho,H(y._flightStatus),1),h("td",uo,H(y._start.name),1),h("td",po,H(y._end.name),1),h("td",mo,H(y._fuel),1)],10,lo))),128))])])])])])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-200 ease-in-out delay-[400ms]","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying")?(Z(),B("div",go,[M(A,{onClick:_[2]||(_[2]=y=>b(C).send("QUIT"))},{default:E(()=>[fo]),_:1})])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-200 ease-in-out","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:E(()=>[In(h("div",wo,[h("div",_o,[yo,h("div",bo,[h("div",xo,[vo,h("div",ko,[M(A,{size:"control","is-primary":l.value?._targetDirection===-1,"is-disabled":l.value?._isGhost,onClick:_[3]||(_[3]=y=>u(-1))},{default:E(()=>[zo]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control",class:"row-span-2","is-primary":l.value?._targetDirection===0&&l.value?._targetAltitude!==0,"is-disabled":l.value?._isGhost,onClick:_[4]||(_[4]=y=>{u(0),g(l.value?._position.y)})},{default:E(()=>[Mo]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===1,"is-disabled":l.value?._isGhost,onClick:_[5]||(_[5]=y=>u(1))},{default:E(()=>[Eo]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===-2,"is-disabled":l.value?._isGhost,onClick:_[6]||(_[6]=y=>u(-2))},{default:E(()=>[Io]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===2,"is-disabled":l.value?._isGhost,onClick:_[7]||(_[7]=y=>u(2))},{default:E(()=>[So]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===-3,"is-disabled":l.value?._isGhost,onClick:_[8]||(_[8]=y=>u(-3))},{default:E(()=>[Co]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===0&&l.value?._targetAltitude===0,"is-disabled":l.value?._isGhost,onClick:_[9]||(_[9]=y=>{u(0),g(0)})},{default:E(()=>[Po]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===3,"is-disabled":l.value?._isGhost,onClick:_[10]||(_[10]=y=>u(3))},{default:E(()=>[Lo]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-primary":l.value?._targetDirection===-4,"is-disabled":l.value?._isGhost,onClick:_[11]||(_[11]=y=>u(-4))},{default:E(()=>[Ao]),_:1},8,["is-primary","is-disabled"]),M(A,{size:"control","is-disabled":""},{default:E(()=>[Oo]),_:1}),M(A,{size:"control","is-primary":l.value?._targetDirection===4,"is-disabled":l.value?._isGhost,onClick:_[12]||(_[12]=y=>u(4))},{default:E(()=>[Go]),_:1},8,["is-primary","is-disabled"])])]),h("div",To,[Xo,h("div",Do,[(Z(),B(Tt,null,re([0,1,2,3,4,5,6,7,8],y=>M(A,{key:y,size:"control","is-secondary":l.value?._position.y===y&&l.value?._targetAltitude!==y,"is-primary":l.value?._targetAltitude===y,"is-disabled":l.value?._isGhost,onClick:$=>g(y)},{default:E(()=>[L(H(y),1)]),_:2},1032,["is-secondary","is-primary","is-disabled","onClick"])),64))])])])])],512),[[Sn,b(U).matches("gamePlaying")&&l.value]])]),_:1}),M(tt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying.quit")?(Z(),B("div",Ro,[h("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80",onClick:_[13]||(_[13]=Cn(y=>b(C).send("CANCEL"),["self"]))}),h("div",Uo,[Yo,h("div",No,[M(A,{size:"sm","is-secondary":"",onClick:_[14]||(_[14]=y=>b(C).send("CANCEL"))},{default:E(()=>[Zo]),_:1}),M(A,{size:"sm","is-primary":"",onClick:_[15]||(_[15]=y=>b(C).send("DONE"))},{default:E(()=>[Bo]),_:1})])])])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying.lose")?(Z(),B("div",$o,[Fo,h("div",Wo,[Ho,h("div",jo,[M(A,{size:"sm","is-primary":""},{default:E(()=>[Qo]),_:1})])])])):et("",!0)]),_:1}),M(tt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:E(()=>[b(U).matches("gamePlaying.win")?(Z(),B("div",qo,[Vo,h("div",Ko,[h("h2",Jo," You won"+H(b(o)<0?" (sort of)":"")+"! "+H(b(o)<0?"\u{1F605}":"\u{1F389}"),1),h("p",ta,[ea,h("span",{class:_t(["font-bold",b(o)<0?"text-rose-500":b(o)>0?"text-green-500":"text-blue-500"])},H(b(o)),3),na]),h("div",sa,[M(A,{size:"sm","is-primary":"",onClick:_[16]||(_[16]=y=>b(C).send("DONE"))},{default:E(()=>[L(" Nice"+H(b(o)<0?"-ish":"")+"! ",1)]),_:1})])])])):et("",!0)]),_:1})],64)):et("",!0)])],64))}};Pn(oa).mount("#app");
