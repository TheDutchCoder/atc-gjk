import{c as Be,i as Fe,r as K,S as $e,W as He,P as We,a as je,O as Qe,V as re,e as m,C as qe,F as Ke,M as it,G as et,T as le,b as D,B as nt,d as R,m as U,f as y,g as Ve,D as Je,I as dt,E as tn,h as $t,H as ce,j as xt,k as de,v as en,l as Ht,t as nn,n as ot,o as F,p as $,q as c,s as ct,u as A,w as sn,x as on,R as an,y as rn,z as ut,A as z,J as pt,K as E,L as yt,N as ln,Q as tt,U as Wt,X as mt,Y as cn,Z as dn,_ as hn,$ as T,a0 as un}from"./vendor.25113b84.js";const pn=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};pn();const mn=Be({id:"main",initial:"loading",states:{loading:{on:{INTRO_IN:"introIn"}},introIn:{tags:"intro",on:{DONE:"introIdle"}},introIdle:{tags:"intro",on:{INTRO_OUT:"introOut"}},introOut:{tags:"intro",on:{DONE:"gameIn"}},gameIn:{tags:"board",on:{DONE:"gamePlaying"}},gamePlaying:{tags:"board",initial:"playing",states:{playing:{on:{LOSE:"lose",Win:"win"}},lose:{on:{DONE:"#main.gameOut"}},win:{on:{DONE:"#main.gameOut"}}},on:{GAME_OUT:"gameOut"}},gameOut:{tags:"board",on:{DONE:"introIn"}}}}),G=Fe(mn).start(),lt=K(G.state);G.onTransition(i=>lt.value=i);const jt=new $e,gn=()=>{const i=document.getElementById("three");i.innerHTML="",i.appendChild(V.domElement)},V=new He({antialias:!0,alpha:!0,shadow:!0});V.setSize(window.innerWidth,window.innerHeight);V.shadowMap.enabled=!0;V.shadowMap.type=We;const C=new je(50,window.innerWidth/window.innerHeight,1,1e3);C.position.set(15,9,15);const k=new Qe(C,V.domElement);k.enableDamping=!0;k.enableRotate=!0;k.enableZoom=!0;k.enablePan=!1;k.autoRotate=!0;k.autoRotateSpeed=-2;const wn=new re(0,0,0),fn=()=>{const i=k.target,t=wn;new m.Tween(i).to(t,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>k.target=i).start();const e={x:C.position.x,y:C.position.y,z:C.position.z},n={x:80,y:35,z:80};new m.Tween(e).to(n,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{C.position.set(e.x,e.y,e.z),k.update()}).start()},_n=new qe,v=(i,t,e,n,s,o=!0)=>{[[0,11,17],[1,9,20],[2,13,19],[3,15,22],[5,10,16],[4,8,21],[7,12,18],[6,14,23]][i].forEach(l=>{let r,h,u,d=t.attributes.position.getX(l),g=t.attributes.position.getY(l),b=t.attributes.position.getZ(l);o?(r=e?d+e:d,h=n?g+n:g,u=s?b+s:b):(r=e||d,h=n||g,u=s||b),t.attributes.position.setXYZ(l,r,h,u)}),t.attributes.position.needsUpdate=!0},at=(i,t,e)=>{const n=Math.round(Math.random()*(t*1e5-i*1e5)+i*1e5)/1e5;return e&&n>=e.min&&n<=e.max?at(i,t,e):n},x=(i,t,e)=>{let n=Math.round(Math.random()*(t-i)+i);return n===e&&(n=x(i,t,e)),n},H=(i,t=!1)=>{const e=Math.floor(Math.random()*i.length),n=i[e];return t&&i.splice(e,1),n},yn=(i,t,e,n=0)=>{const s=JSON.parse(JSON.stringify(i)),o=JSON.parse(JSON.stringify(i));if(n>0&&(o.splice(-n),o.splice(0,n),o.forEach(d=>{d.splice(-n),d.splice(0,n)})),o.flat(2).every(d=>!!d))return null;const a=0-Math.floor(t/2),l=0-Math.floor(e/2);let r,h;do r=x(n,t-n-1),h=x(n,e-n-1);while(s[h][r]);return{tile:{x:r+a,y:0,z:h+l},x:r,z:h}},he=(i,t,e={width:0,direction:0})=>{const{width:n,direction:s}=e,o=n/2;let a,l,r=at(i,t),h=0,u=at(i,t);for(s===0||s==4?(a=d=>d>o||d<-o,l=()=>!0):s===3||s==7?(a=()=>!0,l=(d,g)=>g>d+o||g<d-o):s===2||s==6?(a=()=>!0,l=(d,g)=>g>o||g<-o):(s===1||s==5)&&(a=()=>!0,l=(d,g)=>g>-d+o||g<-d-o);!a(r);)r=at(i,t);for(;!l(r,u);)u=at(i,t);return{x:r,y:h,z:u}},bn=(i,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),o=Math.ceil(0-e/2),a=Math.abs(o),{x:l,z:r}=i;return l===n-1?r===o-1?3:r===a+1?1:2:l===s+1?r===o-1?5:r===a+1?7:6:r===o-1?4:0},xn=(i,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),o=Math.ceil(0-e/2),a=Math.abs(o),{x:l,z:r}=i;return l===n-1?r===o-1?7:r===a+1?5:6:l===s+1?r===o-1?1:r===a+1?3:2:r===o-1?0:4},Pt=(i,t)=>{let{x:e,y:n,z:s}=i;return t===0?s--:t===1?(e++,s--):t===2?e++:t===3?(e++,s++):t===4?s++:t===5?(e--,s++):t===6?e--:t===7&&(e--,s--),{x:e,y:n,z:s}},vn=(i,t)=>{let{x:e,y:n,z:s}=i;return t===0?s++:t===1?(e--,s++):t===2?e--:t===3?(e--,s--):t===4?s--:t===5?(e++,s--):t===6?e++:t===7&&(e++,s++),{x:e,y:n,z:s}},Qt=i=>{const t=Math.floor(i/4).toString(),e=(i%4*15).toString();return`${t.padStart(2,"0")}:${e.padStart(2,"0")}`},kn=(i,t,e)=>{const n=Math.random()>.7,s=Math.ceil(0-i/2)-1,o=Math.abs(s),a=Math.ceil(0-t/2)-1,l=Math.abs(a),r=[s,o,0],h=[a,l],u=[a,l,0],d=H(r),g=Math.ceil(Math.random()*9),b=H(d===0?h:u),S={x:d,y:g,z:b};return n?ue(e):{position:S,direction:bn(S,i,t),name:`${pe(S)}${g}`}},qt=(i,t,e)=>{const n=Math.random()>.3,s=Math.ceil(0-i/2)-1,o=Math.abs(s),a=Math.ceil(0-t/2)-1,l=Math.abs(a),r=[s,o,0],h=[a,l],u=[a,l,0],d=H(r),g=Math.ceil(Math.random()*9),b=H(d===0?h:u),S={x:d,y:g,z:b};return n?ue(e):{position:S,direction:xn(S,i,t),name:`${pe(S)}${g}`}},ue=i=>H(i),pe=i=>{const{x:t,z:e}=i;if(t===0){if(e>0)return"S";if(e<0)return"N"}else if(t<0){if(e<0)return"NW";if(e===0)return"W";if(e>0)return"SW"}else if(t>0){if(e<0)return"NE";if(e===0)return"E";if(e>0)return"SE"}},zn=(i=0)=>{if(i===0)return{x:0,z:1};if(i===1)return{x:-1,z:1};if(i===2)return{x:-1,z:0};if(i===3)return{x:-1,z:-1};if(i===4)return{x:0,z:-1};if(i===5)return{x:1,z:-1};if(i===6)return{x:1,z:0};if(i===7)return{x:1,z:1}},En=["EASY","NORMAL","HARD"],Kt={EASY:{width:11,depth:11},NORMAL:{width:15,depth:15},HARD:{width:21,depth:21}},Vt={EASY:{min:1,max:2},NORMAL:{min:2,max:3},HARD:{min:3,max:5}},Jt={EASY:{min:1,max:2},NORMAL:{min:3,max:5},HARD:{min:6,max:9}},Ot={EASY:{amount:24,height:5},NORMAL:{amount:48,height:7},HARD:{amount:96,height:9}},P={SCHEDULED:"Scheduled",APPROACHING:"Approaching",IN_FLIGHT:"In flight",OBSTRUCTED:"Obstructed",LANDED:"Landed",EXITED:"Exited",LOST:"Lost",CRASHED:"Crashed"};var Mn="/atc-gjk/assets/helvetiker_regular.typeface.d5c54676.json",Sn="/atc-gjk/assets/helvetiker_bold.typeface.bd68159e.json";const In=new Ke,Cn=async i=>new Promise((t,e)=>{In.load(i,n=>t(n),null,n=>e(n))}),Pn=[Mn,Sn],me=await Promise.all(Pn.map(async i=>await Cn(i)));me[0];const ge=me[1],On=new it({color:3900150,flatShading:!0});class An{_tiles=[];_labels=new et;constructor(){}add(t={position:{x:1,y:1,z:1},direction:0,text:"N"}){this._tiles.push(t)}reset(){this._tiles=[]}create(){return this._tiles.forEach(t=>{const e=new le(t.text,{font:ge,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});e.center(),e.scale(.03,.03,.03),e.rotateX(Math.PI/-2),e.rotateY(t.direction*Math.PI/-4),e.translate(t.position.x*10,-.5+t.position.y*5,t.position.z*10),this._labels.add(new D(e,On))}),this._labels}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._labels.scale.setScalar(t.scale)}}const q=new An,Tn=new it({color:10053706,flatShading:!0});class Ln{_tile=null;_dirt=null;constructor(){}add(t={scale:{x:1,y:1,z:1}}){this._tile=t}reset(){this._tile=null,this._dirt=null}create(){const t=new nt(10,3,10);return t.translate(0,-2.5,0),t.scale(this._tile.scale.x,this._tile.scale.y,this._tile.scale.z),this._dirt=new D(t,Tn),this._dirt.scale.setScalar(0),this._dirt}animateIn(){return this._tile?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tile?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._dirt.scale.setScalar(t.scale)}}const Gt=new Ln,At=10,Gn=1,Tt=10,Dn=new it({color:11984276,flatShading:!0}),Rn=new it({color:10010486,flatShading:!0}),Xn=i=>{const t=i.getAttribute("position");for(let e=0;e<t.count;e++){const n=new re;if(n.fromBufferAttribute(t,e),n.y>=.5&&n.x!==-5&&n.x!==5&&n.z!==-5&&n.z!==5){const s=.15-Math.random()*.3,o=At/40-Math.random()*(At/20),a=Tt/40-Math.random()*(Tt/20);t.setXYZ(e,n.x+o,n.y+s,n.z+a)}}i.attributes.position.needsUpdate=!0};class Un{_tiles=[];_grassLight=new R;_grassDark=new R;_grassAll=new et;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._grassLight=new R,this._grassDark=new R,this._grassAll=new et}create(){const t=[],e=[];if(this._tiles.forEach(n=>{const s=new nt(10,1,10,At,Gn,Tt);Xn(s),s.rotateY(x(0,4)*2*(-Math.PI/4)),s.translate(n.position.x*10,-.5+n.position.y*5,n.position.z*10),n.position.x&1&&n.position.z&1||!(n.position.x&1)&&!(n.position.z&1)?t.push(s):e.push(s)}),this._tiles.length){if(t.length){const n=U(t);this._grassLight=new D(n,Dn),this._grassLight.receiveShadow=!0}if(e.length){const n=U(e);this._grassDark=new D(n,Rn),this._grassDark.receiveShadow=!0}this._grassAll.add(this._grassLight,this._grassDark),this._grassAll.scale.setScalar(0)}return this._grassAll}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(250).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._grassAll.scale.setScalar(t.scale)}}const vt=new Un,Yn="#ffff00",Nn=new y(11371131),Zn=new y(10473352),Bn=new y(9157493),Fn=new y(13617032),$n=new y(13340781),we=new y(11910596),fe=new y(9542564),_e=new y(7964047),ye=new y(5857641);new y(11910596);new y(9542564);new y(7964047);const Hn=new y(5124632),Wn=new y(6307874),jn=new y(5914664),Qn=new y(15658734);new y(16711680);new y(65280);new y(255);const qn=new y(0),Kn=new y(16751104),Vn=new y(16711680),Jn=new y(65280),Y=new it({flatShading:!0}),ts=new it({flatShading:!0,transparent:!0,opacity:.75}),es=new it({flatShading:!0,transparent:!0,opacity:.85}),Z=new nt(1,1,1),bt=new Ve(.3,2,4),be=new Je(1,0);new nt(2,.15,.2);new nt(.1,.1,10);const ns=new nt(3,.2,9),ss=new nt(.2,.05,.75),te=new nt(.2,.2,.2),ee=[Zn,Bn,Fn,$n],st=new R;class os{_tiles=[];_trunk=null;_foliage=null;_trees=new et;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._trunk=null,this._foliage=null,this._trees=new et,this._instances=[]}create(){let t=0;if(this._tiles.forEach(e=>{const n=x(20,30);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:he(-4.75,4.75,e.exclude),rot:{x:at(-.12,.12),y:at(-.12,.12),z:0},scale:.5+Math.random()*.75,color:ee[x(0,ee.length-1)],tile:e})}),this._tiles.length){this._trunk=new dt(bt.clone(),Y,t),this._trunk.castShadow=!0;const e=bt.clone();e.scale(1.3,1.3,1.3),e.translate(0,.5,0);const n=bt.clone();n.scale(1.1,1.1,1.1),n.translate(0,1.1,0);const s=U([e,n]);this._foliage=new dt(s,Y,t),this._foliage.castShadow=!0,this._foliage.receiveShadow=!0,this._trunk.geometry.computeBoundingBox(),this._foliage.geometry.computeBoundingBox(),this._trunk.geometry.translate(0,this._trunk.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,this._foliage.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,.3,0),this._trees.add(this._trunk,this._foliage)}return this._trees}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:l,tile:r}=t,{x:h,y:u,z:d}=s,{x:g,y:b,z:S}=o,_=new tn(g,b,S,"XYZ");st.position.set(h+r.position.x*10,(u+r.position.y*5)*a,d+r.position.z*10),st.setRotationFromEuler(_),st.scale.set(n.x,n.y,n.z),st.updateMatrixWorld(!0),this._trunk.setMatrixAt(e,st.matrixWorld),this._trunk.setColorAt(e,Nn),st.updateMatrixWorld(!0),this._foliage.setMatrixAt(e,st.matrixWorld),this._foliage.setColorAt(e,l),this._trunk.instanceMatrix.needsUpdate=!0,this._trunk.instanceColor.needsUpdate=!0,this._foliage.instanceMatrix.needsUpdate=!0,this._foliage.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(x(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(x(500,750)).start()})}):Promise.resolve()}}const kt=new os,ne=[we,fe,_e,ye],gt=new R;class as{_tiles=[];_rock=new R;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._rock=new R,this._instances=[]}create(){let t=0;return this._tiles.forEach(e=>{const n=x(6,12);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:he(-4.5,4.5,e.exclude),rot:{x:-.1+Math.random()*.2,y:Math.PI/2*Math.random(),z:-.1+Math.random()*.2},scale:.1+Math.random()*.3,color:ne[x(0,ne.length-1)],tile:e})}),this._tiles.length&&(this._rock=new dt(be,Y,t),this._rock.castShadow=!0,this._rock.receiveShadow=!0),this._rock}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:l,tile:r}=t,{x:h,y:u,z:d}=s,{x:g,y:b,z:S}=o;gt.position.set(h+r.position.x*10,(u+r.position.y+n.y)*a,d+r.position.z*10),gt.rotation.set(g,b,S),gt.scale.set(n.x,n.y,n.z),gt.updateMatrixWorld(!0),this._rock.setMatrixAt(e,gt.matrixWorld),this._rock.setColorAt(e,l),this._rock.instanceMatrix.needsUpdate=!0,this._rock.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(x(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(x(500,750)).start()})}):Promise.resolve()}}const zt=new as,se=[we,fe,_e,ye],rt=new R;class is{_tiles=[];_clouds=new R;_animate=()=>{};_instances=[];_tick=0;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._clouds=new R,this._animate=()=>{},this._instances=[],this._tick=0}create(){let t=0;return this._tiles.forEach(e=>{const n=x(8,12);t+=n;const s=se[x(0,se.length-1)],o=x(5,9);for(let a=0;a<n;a++)this._instances.push({pos:{x:-3+Math.random()*6,y:-.2+Math.random()*.4,z:-3+Math.random()*6},rot:{x:Math.PI*2*Math.random(),y:Math.PI*2*Math.random(),z:Math.PI*2*Math.random()},altitude:e.position.y||o,animation:{direction:Math.random()>.5?1:-1,speed:x(200,300)},scale:.5+Math.random()*1.5,color:s,isReady:!1,tile:e})}),this._clouds=new dt(be,es,t),this._animate=()=>{this._instances.forEach((e,n)=>{const{isReady:s}=e;s&&this.updateInstance(e,n)}),this._tick++},this._clouds}updateInstance(t,e,n){const{pos:s,rot:o,scale:a,color:l,animation:r,tile:h,altitude:u}=t,{x:d,y:g,z:b}=s,{x:S,y:_,z:w}=o,{direction:f,speed:M}=r,L=Math.sin((this._tick+e*50)/10/Math.PI)/20;rt.position.set(d+h.position.x*10,u*5+(g+L)*a,b+h.position.z*10),rt.rotation.set(S,_,w+this._tick/M*f),n?rt.scale.set(n.x,n.y,n.z):rt.scale.setScalar(a),rt.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,rt.matrixWorld),this._clouds.setColorAt(e,l),this._clouds.instanceMatrix.needsUpdate=!0,this._clouds.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},a={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(()=>{e.isReady=!0,t()}).delay(x(1e3,1250)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},a={x:0,y:0,z:0};this.updateInstance(e,n,o),new m.Tween(o).to(a,500).easing(m.Easing.Elastic.In).onStart(()=>e.isReady=!1).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(x(250,500)).start()})}):Promise.resolve()}}const wt=new is,xe=Y.clone();xe.color.set(qn);const ve=Y.clone();ve.color.set(Kn);const ke=Y.clone();ke.color.set(Jn);const ze=Y.clone();ze.color.set(Vn);const Ee=Y.clone();Ee.color.set(Yn);class rs{_tiles=[];_airstrip=null;_strips=null;_stripes=null;_greenLights=null;_redLights=null;_label=null;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._airstrip=null,this._strips=null,this._stripes=null,this._greenLights=null,this._redLights=null,this._label=null}create(){this._airstrip=new et;const t=[],e=[],n=[],s=[],o=[];if(this._tiles.forEach((a,l)=>{const r=ns.clone();r.rotateY(a.direction*Math.PI/-4),r.translate(a.position.x*10,.1+a.position.y*5,a.position.z*10),t.push(r);for(let u=0;u<7;u++){const d=ss.clone();d.translate(0,0,-3+u),d.rotateY(a.direction*Math.PI/-4),d.translate(a.position.x*10,.2+a.position.y*5,a.position.z*10),e.push(d)}for(let u=0;u<5;u++){const d=te.clone();d.translate(-1+u*.5,0,4),d.rotateY(a.direction*Math.PI/-4),d.translate(a.position.x*10,a.position.y*5,a.position.z*10),n.push(d);const g=te.clone();g.translate(-1+u*.5,0,-4),g.rotateY(a.direction*Math.PI/-4),g.translate(a.position.x*10,a.position.y*5,a.position.z*10),s.push(g)}const h=new le(`AP${l+1}`,{font:ge,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});h.center(),h.scale(.01,.01,.01),h.translate(0,-3,0),h.rotateX(Math.PI/-2),h.rotateY(a.direction*Math.PI/-4),h.translate(a.position.x*10,.2+a.position.y*5,a.position.z*10),o.push(h)}),this._tiles.length){const a=U(t),l=U(e),r=U(n),h=U(s),u=U(o);this._strips=new D(a,xe),this._stripes=new D(l,ve),this._greenLights=new D(r,ke),this._redLights=new D(h,ze),this._labels=new D(u,Ee),this._greenLights.position.y=.2,this._redLights.position.y=.2,this._airstrip.add(this._strips,this._stripes,this._greenLights,this._redLights,this._labels)}return this._airstrip}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._airstrip.scale.setScalar(t.scale)}}const Dt=new rs,oe=[Hn,Wn,jn],B=new R;class ls{_tiles=[];_beams=null;_rails=null;_beamInstances=[];_railInstances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._beams=null,this._rails=null,this._beamInstances=[],this._railInstances=[]}create(){const t=new et;let e=0,n=0;if(this._tiles.forEach(s=>{const a=s.direction===2||s.direction===6;e+=11;for(let l=0;l<11;l++)this._beamInstances.push({pos:{x:a?-4.6+l*10/11:0,y:0,z:a?0:-4.6+l*10/11},rot:{x:0,y:-.08+Math.random()*.16+(a?Math.PI/2:0),z:0},color:oe[x(0,oe.length-1)],tile:s});n+=2;for(let l=0;l<2;l++)this._railInstances.push({pos:{x:a?0:-.7+l*1.4,y:.2,z:a?-.7+l*1.4:0},rot:{x:0,y:a?Math.PI/2:0,z:0},color:Qn,tile:s})}),this._tiles.length){const s=Z.clone();s.scale(2,.3,.3),this._beams=new dt(s,Y,e),this._beams.castShadow=!0,this._beams.receiveShadow=!0;const o=Z.clone();o.scale(.2,.2,10),this._rails=new dt(o,Y,n),this._rails.castShadow=!0,this._rails.receiveShadow=!0,t.add(this._beams,this._rails)}return t}updateBeamInstance(t,e,n){const{pos:s,rot:o,color:a,tile:l}=t,{x:r,y:h,z:u}=s,{x:d,y:g,z:b}=o;B.position.set(r+l.position.x*10,h+l.position.y*5,u+l.position.z*10),B.rotation.set(d,g,b),B.scale.set(n.x,n.y,n.z),B.updateMatrixWorld(!0),this._beams.setMatrixAt(e,B.matrixWorld),this._beams.setColorAt(e,a),this._beams.instanceMatrix.needsUpdate=!0,this._beams.instanceColor.needsUpdate=!0}updateRailInstance(t,e,n){const{pos:s,rot:o,color:a,tile:l}=t,{x:r,y:h,z:u}=s,{x:d,y:g,z:b}=o;B.position.set(r+l.position.x*10,h+n.y+l.position.y*10,u+l.position.z*10),B.rotation.set(d,g,b),B.scale.set(n.scale,n.scale,n.scale),B.updateMatrixWorld(!0),this._rails.setMatrixAt(e,B.matrixWorld),this._rails.setColorAt(e,a),this._rails.instanceMatrix.needsUpdate=!0,this._rails.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:0,y:0,z:0},o={x:1,y:1,z:1};this.updateBeamInstance(e,n,s),new m.Tween(s).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(x(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:5,scale:0},o={y:0,scale:1};this.updateRailInstance(e,n,s),new m.Tween(s).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(x(750,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:1,y:1,z:1},o={x:0,y:0,z:0};new m.Tween(s).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(x(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:0,scale:1},o={y:5,scale:0};new m.Tween(s).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(x(750,1e3)).start()})}):Promise.resolve()}}const Me=new ls,ae=i=>{i.dispose();for(const t of Object.keys(i)){const e=i[t];e&&typeof e=="object"&&"minFilter"in e&&e.dispose()}};class Se{_scene=null;_anims=[];_lights=[];_models=[];_fog=null;_elements=[q,Gt,vt,kt,zt,wt,Dt,Me];_airplanes=K([]);_board=null;_tick=K(-1);_isAnimating=!1;_score=K(0);_animate=()=>{wt._animate(),this._airplanes.value.forEach(t=>t?.animate())};constructor(){this._scene=new $t}addLight(t){this._lights.push(t)}addFog(t){this._fog=t}addBoard(t){this._board=t}addAirplane(t){this._airplanes.value.push(t),this._scene.add(t._model)}removeAirplane(t){this._airplanes.value=this._airplanes.value.filter(n=>n._id!==t._id);const e=this._scene.getObjectById(t._model.id);this._scene.remove(e)}reset(){this._scene.traverse(t=>{if(!!t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)ae(t.material);else for(const e of t.material)ae(e)}),this._scene=new $t,this._anims=[],this._lights=[],this._models=[],this._fog=null,this._elements.forEach(t=>t.reset())}async animateIn(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateIn())),Promise.resolve()}async animateOut(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateOut())),Promise.resolve()}render(){this._scene.fog=this._fog,this._lights.forEach(t=>{this._scene.add(t)}),this._elements.forEach(t=>this._scene.add(t.create()))}}class Rt{_position={x:0,y:0,z:0};_model=null;_hasAnimations=!1;_isAnimating=!1;_shouldBeRemoved=!1;_tick=0;displayName="";constructor({position:t={x:0,y:0,z:0}}={}){this._position=t}updatePosition(){this._model.position.x=this._position.x*10,this._model.position.y=this._position.y*5,this._model.position.z=this._position.z*10}get position(){return this._position}set position(t){this._position=t,this.updatePosition()}get model(){return this._model}set model(t){this._model=t,this.updatePosition(),this._hasAnimations}get isAnimating(){return this._isAnimating}set isAnimating(t){this._isAnimating=t}}class Ie extends Rt{constructor({position:t={x:0,y:0,z:0}}={}){super({position:t});this.create()}create(){vt.add({position:this._position}),kt.add({position:this._position}),zt.add({position:this._position})}}class Lt extends Rt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){vt.add({position:this._position}),kt.add({position:this._position,exclude:{width:3,direction:this._direction}}),zt.add({position:this._position,exclude:{width:3,direction:this._direction}}),Me.add({position:this._position,direction:this._direction})}}class Ce extends Rt{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){vt.add({position:this._position}),kt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),zt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Dt.add({position:this._position,direction:this._direction})}}const cs=new y(16777215),ds=i=>{const t=Z.clone();t.scale(1,1,2),v(0,t,-.2,-.1),v(2,t,-.2,.3),v(4,t,.2,-.1),v(6,t,.2,.3);const e=Z.clone();e.scale(3,.1,1),v(1,e,.2,.05),v(3,e,.2,-.05),v(5,e,-.2,.05),v(7,e,-.2,-.05);const n=Z.clone();n.scale(.1,.75,.5),n.translate(0,.5,.95),v(0,n,-.04,.05),v(2,n,-.04),v(3,n,0,-.05),v(4,n,.04,.05),v(6,n,.04),v(7,n,0,-.05);const s=Z.clone();s.scale(.4,.5,.6);const o=s.clone();o.translate(0,-.3,.6),o.rotateX(-.2);const a=s.clone();a.translate(.3,-.3,-.65);const l=s.clone();l.translate(-.3,-.3,-.65);const r=U([t,e,n,o,a,l]),h=Z.clone();h.scale(.7,.4,.05),h.translate(0,.5,-.7),h.rotateX(.2),v(0,h,-.05),v(1,h,-.05),v(4,h,.05),v(5,h,.05);const u=U([h]),d=Z.clone();d.scale(1,1,.5),d.translate(0,0,-1.25),v(1,d,-.1,-.1),v(3,d,-.1,.1),v(5,d,.1,-.1),v(7,d,.1,.1);const g=Z.clone();g.scale(.1,.1,.5),v(2,g,null,null,.01),v(1,g,null,null,-.009),v(3,g,null,null,-.009),v(7,g,null,null,-.01);const b=g.clone();b.rotateZ(Math.PI/4),b.rotateY(.2),b.translate(.5,.2,-1.05);const S=g.clone();S.rotateZ(Math.PI/4),S.translate(.55,.2,-.55);const _=g.clone();_.rotateZ(Math.PI/4)+Math.PI/2,_.rotateY(-.2),_.translate(-.5,.2,-1.05);const w=g.clone();w.rotateZ(Math.PI/4),w.translate(-.55,.2,-.55);const f=U([d,b,S,_,w]),M=Z.clone();M.scale(.2,.2,.2),M.translate(0,0,-1.55),v(0,M,.07,.07),v(2,M,.07,-.07),v(4,M,-.07,.07),v(6,M,-.07,-.07);const L=Z.clone();L.scale(.2,.4,.4);const W=L.clone();W.translate(0,-.6,.6),W.rotateX(-.2);const j=L.clone();j.translate(-.3,-.6,-.65);const Q=L.clone();Q.translate(.3,-.6,-.65);const I=U([M,W,j,Q]),X=Z.clone();X.scale(.15,1.5,.05),X.translate(0,0,-1.6);const Et=X.clone();Et.rotateZ(Math.PI/2);const ft=U([X,Et]),J=Z.clone();J.scale(.34,.2,.2);const ht=J.clone();ht.translate(0,-.6,.6),ht.rotateX(-.2);const Xt=J.clone();Xt.translate(-.3,-.6,-.65);const Ut=J.clone();Ut.translate(.3,-.6,-.65);const Oe=U([ht,Xt,Ut]),_t=bt.clone();_t.scale(1.2,.42,1.2),_t.rotateX(Math.PI),_t.translate(0,2,0);const Ae=U([_t]),Mt=new et;Mt.name="plane";const St=Y.clone();St.color.set(i),St.name="base";const Yt=ts.clone(),Nt=Y.clone(),Zt=Y.clone(),It=Y.clone(),Bt=Y.clone(),Te=new y(14872564),Le=new y(0),Ge=new y(10053706),De=new y(16777215),Re=new y(65280);Yt.color.set(Te),Nt.color.set(De),Zt.color.set(Ge),It.color.set(Le),Bt.color.set(Re);const Xe=new D(r,St),Ue=new D(u,Yt),Ye=new D(f,Nt),Ne=new D(I,It),Ft=new D(ft,It);Ft.name="props";const Ze=new D(Oe,Zt),Ct=new D(Ae,Bt);return Ct.name="selector",Ct.visible=!1,Mt.add(Xe,Ue,Ye,Ne,Ft,Ze,Ct),Mt};class Pe{_startTime=0;_position={x:0,y:0,z:0};_direction=0;_targetAltitude=0;_targetDirection=0;_start=null;_end=null;_spawned=!1;_takenOff=!1;_landed=!1;_isGhost=!1;_isSelected=!1;_name="";_id=null;_color=null;_model=null;_tick=0;_fuel=0;_flightStatus=P.SCHEDULED;constructor(t){const{id:e,start:n,end:s,fuel:o,startTime:a}=t;return this._start=n,this._end=s,this._position=n.position,this._direction=n.direction,this._targetAltitude=this._position.y||1,this._takenOff=this._position.y!==0,this._id=e,this._name="GJK",this._color=new y(Math.random()*16777215),this._fuel=o,this._startTime=a,this.create(),this}animate=()=>this.animateIdle();updateAnimation(t){this._model.position.x=t.position.x*10,this._model.position.y=t.position.y*5,this._model.position.z=t.position.z*10,this._model.scale.setScalar(t.scale)}animateIn(t=1250,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this;let a,l;this._takenOff?(a={position:vn({...s},o),direction:o,scale:0},l={position:{...s},direction:o,scale:1}):(a={position:{...s},direction:o,scale:0},l={position:{...s},direction:o,scale:1},a.position.y=.18,l.position.y=.18),this.updateAnimation(a),new m.Tween(a).to(l,e).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()})}animateOut(t=0,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this,a={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._direction,scale:1},l={position:Pt(s,o),direction:this._direction,scale:0};this.updateAnimation(a),new m.Tween(a).to(l,e).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateAnimation(a)).onComplete(n).delay(t).start()})}animateIdle(){const t=Math.sin(this._tick/10/Math.PI)/100,e=Math.sin(this._tick/15/Math.PI)/10,n=Math.sin(this._tick/20/Math.PI)/20;this._position.y>=1&&(this._model.position.y+=t,this._model.rotation.z=e,this._model.rotation.x=n),this._model.children.forEach(s=>{s.name==="props"&&(s.rotation.z+=.3),s.name==="selector"&&(s.rotation.y+=.01,s.position.y+=t)}),this._tick++}create(){const t=ds(this._color);t.position.x=this._position.x*10,t.position.z=this._position.z*10,t.position.y=this._position.y*5,t.rotation.y=this._direction*(Math.PI/-4),this._takenOff||t.rotateX(.1),t._id=this._id,this._model=t}async next(t=0,e=1){const n=Pt(this._position,this._direction);let s=0,o=0;this._targetAltitude>this._position.y?s=1:this._targetAltitude<this._position.y&&(s=-1),this._targetDirection>0?(this._targetDirection--,o=1):this._targetDirection<0&&(this._targetDirection++,o=-1),await this.animateNext(s,o,t,e,this._takenOff?0:.1),this.unsetGhost(),this._takenOff=!0,this._flightStatus=P.IN_FLIGHT,n.y+=s,this._position=n,this._direction=(8+(this._direction+o))%8,this._model.rotation.y=this._direction*(Math.PI/-4),this._fuel-=1}async animateNext(t,e,n=0,s=1){return new Promise(o=>{const a={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._model.rotation.y,scale:s},l=Pt(this._position,this._direction);l.y+=t,l.y===0&&(l.y=.18);const r={position:l,direction:this._model.rotation.y+e*Math.PI/-4,scale:1};new m.Tween(a).to(r,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>this.updateAnimation(a,this._targetDirection>0)).onComplete(o).delay(n).start()})}setGhost(){this._isGhost=!0,this._model.children.forEach(t=>{t.material.name==="base"&&t.material.color.set(cs),t.material&&t.material.name!=="selector"&&(t.material.transparent=!0,t.material.opacity=.75,t.material.needsUpdate=!0)})}unsetGhost(){this._isGhost=!1,this._model.children.forEach(t=>{t.material.name==="base"&&t.material.color.set(this._color),t.material&&t.material.name!=="selector"&&(t.material.transparent=!1,t.material.opacity=1,t.material.needsUpdate=!0)})}setSpawned(){this._spawned=!0,this._flightStatus=P.APPROACHING}setExited(){this._flightStatus=P.EXITED}setLanded(){this._flightStatus=P.LANDED}setLost(){this._flightStatus=P.LOST}setCrashed(){this._flightStatus=P.CRASHED}setSelected(){this._isSelected=!0,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!0)})}unsetSelected(){this._isSelected=!1,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!1)})}setHeight(t){this._targetAltitude=t}setDirection(t){this._targetDirection=t}}const N=new Se,hs=[Ie,Lt,Ce],us=H(hs);N.start=()=>{const i=new ce(16777215,526338,.7);i.position.set(15,25,15);const t=new R;t.rotation.x=Math.PI/-3;const e=new xt(16777215,.3);t.add(e),e.position.set(60,0,0),e.lookAt(t.position),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.top=90,e.shadow.camera.bottom=-120,e.shadow.camera.left=-90,e.shadow.camera.right=90,t.rotation.y=Math.PI/-1.5;const n=new xt(11592173,.2);n.position.set(-20,25,-10),N.addLight(i),N.addLight(t),N.addLight(n),new us;const s=new Pe({id:0,start:{position:{x:0,y:1,z:0},direction:1,name:""},end:{position:{x:0,y:0,z:0},direction:1,name:""},fuel:100});N.addAirplane(s),Gt.add(),wt.add({position:{x:0,y:2,z:0}});const o=new de(new y(10209513),15,30);N.addFog(o);const a=new R;a.position.y=2.5,k.target=a.position};class ps{_width=0;_depth=0;_difficulty=null;_airfields=0;_clouds=0;_airplanes=0;_airplanesQueue=[];_tiles=[];_tick=0;constructor(t=1){this._difficulty=En[t],this._width=Kt[this._difficulty].width,this._depth=Kt[this._difficulty].depth,this._airfields=x(Vt[this._difficulty].min,Vt[this._difficulty].max),this._clouds=x(Jt[this._difficulty].min,Jt[this._difficulty].max),this._airplanes=Ot[this._difficulty].amount}generate(){const t=Math.ceil(0-this._width/2),e=Math.ceil(0-this._depth/2),n=Math.abs(t),s=Math.abs(e);this._tiles=Array.from({length:this._depth},()=>Array.from({length:this._width},()=>null));const o=Math.random()>.5,a=H(o?[0,1,this._depth-1,this._depth-2]:[0,1,this._width-1,this._width-2]);o?this._tiles[a].forEach((r,h)=>{this._tiles[a][h]=new Lt({position:{x:h+t,y:0,z:a+e},direction:2})}):this._tiles.forEach((r,h)=>{this._tiles[h][a]=new Lt({position:{x:a+t,y:0,z:h+e}})});const l=[];for(let r=0;r<this._airfields;r++){const h=yn(this._tiles,this._width,this._depth,3);if(h){const{x:u,z:d,tile:g}=h,b={position:g,direction:x(0,7),name:`AP${l.length+1}`};l.push(b),this._tiles[d][u]=new Ce(b)}}this._tiles.forEach((r,h)=>{r.forEach((u,d)=>{if(!u)return new Ie({position:{x:d+t,y:0,z:h+e}})})}),Gt.add({scale:{x:this._width,y:1,z:this._depth}});for(let r=0;r<this._clouds;r++)wt.add({position:{x:x(t,s),y:x(Ot[this._difficulty].height-2,Ot[this._difficulty].height),z:x(e,s)}});for(let r=0;r<this._airplanes;r++){const h=kn(this._width,this._depth,l);let u=qt(this._width,this._depth,l);for(;h.name===u.name;)u=qt(this._width,this._depth,l);this._airplanesQueue.push(new Pe({id:en(),start:h,end:u,startTime:x(0,96),fuel:x(20,35)}))}q.add({position:{x:0,y:0,z:e-2},direction:0,text:"N"}),q.add({position:{x:n+1,y:0,z:e-1},direction:1,text:"NE"}),q.add({position:{x:n+2,y:0,z:0},direction:2,text:"E"}),q.add({position:{x:n+1,y:0,z:s+1},direction:3,text:"SE"}),q.add({position:{x:0,y:0,z:s+2},direction:4,text:"S"}),q.add({position:{x:t-1,y:0,z:s+1},direction:5,text:"SW"}),q.add({position:{x:t-2,y:0,z:0},direction:6,text:"W"}),q.add({position:{x:t-1,y:0,z:e-1},direction:7,text:"NW"}),this._airplanesQueue.sort((r,h)=>r._startTime<h._startTime?-1:r._startTime>h._startTime?1:0)}}const p=new Se,ie=new ps;p.start=()=>{const i=new ce(16777215,526338,.7);i.position.set(15,25,15);const t=new R;t.name="sun";const e=new xt(16777215,.3),n=new Ht(e,5);t.add(e),e.position.set(0,60,0),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.top=90,e.shadow.camera.bottom=-120,e.shadow.camera.left=-90,e.shadow.camera.right=90;const s=new xt(11592173,.2),o=new Ht(s,5);s.position.set(-20,25,-10);const a=new R;a.position.y=2.5,k.target=a.position,p.addLight(i),p.addLight(t),p.addLight(n),p.addLight(o),p.addLight(s);const l=new de(new y(10209513),15,350);t.rotation.x=Math.PI/4,t.rotation.z=Math.PI,ie.generate(),p.addFog(l),p.addBoard(ie),p.nextTick()};p.nextTick=async()=>{if(!p._isAnimating){p._isAnimating=!0,p._tick.value++,p._airplanes.value=p._airplanes.value.filter(n=>{if(n._flightStatus===P.LANDED||n._flightStatus===P.EXITED||n._flightStatus===P.LOST)p.removeAirplane(n);else return n});const i=Promise.all(p._airplanes.value.map(n=>n.next())),t=Promise.all(p._board._airplanesQueue.filter(n=>n._startTime===p._tick.value).map(n=>(p.addAirplane(n),n.setSpawned(),n.setGhost(),n.animateIn(0,500)))),e=new Promise(n=>{const s=p._lights.find(l=>l.name==="sun"),o={rot:s.rotation.z},a={rot:s.rotation.z+Math.PI*2*(1/96)};new m.Tween(o).to(a,500).easing(m.Easing.Quadratic.InOut).onUpdate(()=>s.rotation.z=o.rot).onComplete(n).start()});await i,await t,await e,p.checkObstructions(),p.checkDestinations(),p.checkOutOfBounds(),p.checkOutOfFuel(),p._isAnimating=!1}};p.checkObstructions=()=>{const i=0-Math.floor(p._board._width/2),t=0-Math.floor(p._board._depth/2),e=Math.abs(i),n=Math.abs(t);p._airplanes.value.forEach(s=>{const{x:o,y:a,z:l}=s._position;let r=!1,h=!1;wt._tiles.forEach(u=>{const{x:d,y:g,z:b}=u.position;d===o&&g===a&&b===l&&(r=!0)}),(o<i||o>e||l<t||l>n)&&(h=!0),(r||h)&&s.setGhost()})};p.checkCollisions=()=>{p._airplanes.value.forEach(i=>{const{x:t,y:e,z:n}=i._position;i._takenOff&&(e===0&&Dt._tiles.forEach(s=>{const{x:o,y:a,z:l}=s.position;t===o&&n===l&&i._direction===s.direction?console.log("plane landed on airport, check if it's the right airport!"):(console.log(`plane crashed at ${o}, ${a}, ${l}`),G.send("LOSE"))}),p._airplanes.value.forEach(s=>{if(i._id!==s._id){const{x:o,y:a,z:l}=s._position;t===o&&e===a&&n===l&&G.send("LOSE")}}))})};p.checkDestinations=()=>{p._airplanes.value.forEach(i=>{if(i._takenOff){const{x:t,y:e,z:n}=i._position,s=i._direction,{position:{x:o,y:a,z:l},direction:r}=i._end;t===o&&e===a&&n===l&&s===r?(p._score.value+=100+i._fuel*10,i.setGhost(),e===0?i.setLanded():i.setExited()):e===0&&(console.log("game over!"),i.setCrashed(),G.send("LOSE"))}})};p.checkOutOfBounds=()=>{p._airplanes.value.forEach(i=>{const{x:t,z:e}=i._position,n=0-Math.ceil(p._board._width/2),s=0-Math.ceil(p._board._depth/2),o=Math.abs(n),a=Math.abs(s);(t<=n||t>=o||e<=s||e>=a)&&i._flightStatus!==P.APPROACHING&&i._startTime<p._tick.value&&(p._score.value-=500,i.setLost())})};p.checkOutOfFuel=()=>{p._airplanes.value.forEach(i=>{i._fuel<=0&&(console.log("game over!"),G.send("LOSE"))})};p.selectPlane=i=>{p._airplanes.value.forEach(t=>{if(t._id===i&&t._isSelected){t.unsetSelected();return}t.unsetSelected(),t._id===i&&!t._isGhost&&t.setSelected()})};const O={props:{size:{type:String,default:"md"},isDisabled:{type:Boolean,default:!1},isPrimary:{type:Boolean,default:!1},isSecondary:{type:Boolean,default:!1}},setup(i){const t=i,{size:e,isDisabled:n,isPrimary:s,isSecondary:o}=nn(t),a=ot(()=>{switch(e.value){case"control":return["w-7 min-h-7"];case"xs":return[];case"md":default:return[]}}),l=ot(()=>{const u=["blur-[2px]",!s.value&&!o.value&&"bg-gray-800",s.value&&"bg-blue-800",o.value&&"bg-blue-600"];switch(e.value){case"control":return[...u,"rounded-sm translate-y-[1px] group-active:translate-y-[0px] group-hover:translate-y-[2px]"];case"xs":return[...u,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"];case"sm":return[...u,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"];case"md":default:return[...u,"rounded translate-y-[2px] group-active:translate-y-[1px] group-hover:translate-y-[4px]"]}}),r=ot(()=>{const u=[!s.value&&!o.value&&"group-hover:bg-gray-300",s.value&&"bg-blue-800 group-hover:bg-blue-900",o.value&&"bg-blue-400 group-hover:bg-blue-500"];switch(e.value){case"control":return[...u,"w-7 min-h-7 p-[2px] rounded-sm"];case"xs":return[...u,"py-1 px-1 rounded"];case"sm":return[...u,"py-2 px-5 rounded"];case"md":default:return[...u,"py-3 px-7 rounded"];case"lg":return[...u,"py-4 px-8 rounded"]}}),h=ot(()=>{const u=[!s.value&&!o.value&&!n.value&&"text-gray-800 group-hover:bg-gray-100",n.value&&"bg-gray-200 border-gray-200 text-gray-400 cursor-not-allowed",s.value&&"bg-blue-500 border-blue-700 text-white group-hover:bg-blue-600",o.value&&"bg-blue-200 border-blue-300 text-blue-700 group-hover:bg-blue-300"];switch(e.value){case"control":return[...u,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[3px]","absolute inset-0 border rounded-sm text-xs -translate-y-[1px]"];case"xs":return[...u,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-1 px-1 text-xs rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"sm":return[...u,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-2 px-5 text-sm rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"md":default:return[...u,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-2 px-7 text-sm rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"];case"lg":return[...u,!n.value&&"group-active:-translate-y-[0px] group-hover:-translate-y-[6px]","py-3 px-8 text-xl rounded -translate-y-[4px] group-active:-translate-y-[2px] group-hover:-translate-y-[6px]"]}});return(u,d)=>(F(),$("button",{class:ct(["relative group select-none",A(a)])},[c("span",{class:ct(["absolute inset-0 bg-opacity-50 transition-transform transform",A(l)])},null,2),c("span",{class:ct(["absolute inset-0 bg-gray-200",A(r)])},null,2),c("span",{class:ct(["flex justify-center items-center bg-white font-bold transition-all transform",A(h)])},[sn(u.$slots,"default")],2)],2))}};const ms=c("div",{id:"three"},null,-1),gs={class:""},ws={key:0,class:"absolute top-32 left-1/2 transform -translate-x-1/2"},fs=c("h1",{class:"font-callout text-6xl stage"},[c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("div",{class:"layer"}),c("span",{class:"opacity-0"},"Air Traffic Control")],-1),_s=[fs],ys={key:0,class:"fixed bottom-1/4 left-1/2 transform -translate-x-1/2"},bs=T(" Play "),xs={class:"fixed top-2 right-2 text-xs font-bold"},vs={class:"absolute -bottom-16 left-1/2 w-16 transform -translate-x-1/2 bg-white pt-2 pb-3 px-3 rounded shadow-block text-center"},ks=c("div",{class:"font-bold text-sm"}," Time ",-1),zs={class:"text-blue-500"},Es=T(" Quit "),Ms={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Ss={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block"},Is=c("h2",{class:"text-base font-bold"}," Are you sure you want to quit? ",-1),Cs={class:"flex space-x-4 items-center justify-center mt-6"},Ps=T(" No "),Os=T(" Yes "),As={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},Ts=c("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80"},null,-1),Ls={class:"relative z-10 p-6 pb-7 rounded bg-white shadow-block"},Gs=c("h2",{class:"text-base font-bold"}," You lost! ",-1),Ds={class:"flex space-x-4 items-center justify-center mt-6"},Rs=T(" Admit Defeat "),Xs={class:"fixed top-2 left-1/2 transform -translate-x-1/2 bg-white rounded shadow-block"},Us={class:"pt-2 pb-3 px-4 text-center text-sm"},Ys=c("div",{class:"font-bold text-gray-800"}," Score ",-1),Ns={class:"fixed bottom-2 left-2 bg-white rounded shadow-block origin-bottom-left"},Zs={class:"p-2 pb-3 text-center"},Bs=c("div",{class:"font-bold text-sm text-gray-800"}," Flight Controls ",-1),Fs={class:"flex"},$s={class:"p-2 space-y-1"},Hs=c("div",{class:"font-bold text-sm text-gray-700"}," Direction ",-1),Ws={class:"grid grid-cols-3 gap-1"},js=T(" 45 "),Qs=T(" \u2191 "),qs=T(" 45 "),Ks=T(" 90 "),Vs=T(" 90 "),Js=T(" 135 "),to=T(" L "),eo=T(" 135 "),no=T(" 180 "),so=T(" \u221E "),oo=T(" 180 "),ao={class:"p-2 space-y-1"},io=c("div",{class:"font-bold text-sm text-gray-700"}," Altitude ",-1),ro={class:"grid grid-cols-3 gap-1"},lo={class:"fixed bottom-2 right-2 w-80 bg-white rounded shadow-block origin-bottom-left"},co={class:"p-2 pb-3 text-center"},ho=c("div",{class:"font-bold text-sm text-gray-800"}," Flight Schedule ",-1),uo={class:"space-y-1 max-h-48 overflow-auto mt-2"},po={class:"text-sm font-bold w-full"},mo=c("thead",null,[c("tr",{class:"sticky top-0 bg-white bg-opacity-80"},[c("th",{class:"font-bold text-sm text-gray-700"}," Time "),c("th",{class:"font-bold text-sm text-gray-700"}," Status "),c("th",{class:"font-bold text-sm text-gray-700"}," Entry "),c("th",{class:"font-bold text-sm text-gray-700"}," Exit "),c("th",{class:"font-bold text-sm text-gray-700"}," Fuel ")])],-1),go={class:"text-xs"},wo=["onClick"],fo={class:"py-1"},_o={class:"py-1"},yo={class:"py-1"},bo={class:"py-1"},xo={class:"py-1"},vo={setup(i){K(!0);const t=ot(()=>p._board._airplanesQueue.map(_=>p._airplanes.value.find(f=>f._id===_._id)||_)),e=ot(()=>Qt(p._tick.value)),n=(_,w)=>{const f=_._id===r.value?._id,M=_._flightStatus===P.IN_FLIGHT,L=[_._flightStatus===P.APPROACHING&&"bg-blue-200 text-blue-400 cursor-not-allowed",_._flightStatus===P.SCHEDULED&&"text-gray-400 cursor-not-allowed",_._flightStatus===P.LANDED&&"bg-teal-100 text-teal-500 cursor-not-allowed",_._flightStatus===P.EXITED&&"bg-teal-100 text-teal-500 cursor-not-allowed",_._flightStatus===P.LOST&&"bg-rose-100 text-rose-400 cursor-not-allowed"],W=["bg-blue-500 text-white hover:bg-blue-600 border-b-2 border-blue-800"],j=[!f&&w%2===0&&"bg-gray-100",!f&&"hover:bg-gray-200"];return[...f?[]:L,...f?W:[],...M?j:[]]};on(()=>{gn(),k.autoRotate=!1,k.enablePan=!0,G.onTransition(async I=>{if(I.changed&&I.matches("introIn")&&(k.autoRotate=!0,N.start(),N.render(),await N.animateIn(),G.send("DONE")),I.changed&&I.matches("introOut")&&(k.enableRotate=!1,k.autoRotate=!1,await N.animateOut(),G.send("DONE")),I.changed&&I.matches("gameIn")){N.reset(),p.start(),p.render();const X=C.position;new m.Tween(X).to({x:80,y:35,z:80},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>C.position.set(X.x,X.y,X.z)).onComplete(()=>{k.enableRotate=!0,k.enableZoom=!0,G.send("DONE")}).start(),await p.animateIn()}if(I.changed&&I.matches("gamePlaying")&&(k.enableRotate=!0),I.changed&&I.matches("gameOut")){k.enableRotate=!1;const X=C.position;new m.Tween(X).to({x:15,y:9,z:15},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>C.position.set(X.x,X.y,X.z)).onComplete(()=>{k.enableRotate=!0,k.enableZoom=!0,G.send("DONE")}).delay(500).start(),await p.animateOut(),p.reset()}});let _=0,w=1/60;const f=new an,M=new rn;let L=!1;const W=I=>{L=!0,M.x=I.clientX/window.innerWidth*2-1,M.y=-(I.clientY/window.innerHeight)*2+1},j=()=>{L=!1};V.setAnimationLoop(async I=>{if(_+=_n.getDelta(),jt.begin(),G.state.hasTag("intro")&&N._scene)V.render(N._scene,C),_>w&&N._animate();else if(G.state.hasTag("board")&&p._scene){if(L){f.setFromCamera(M,C);const ft=f.intersectObjects(p._scene.children).sort((J,ht)=>J.distance<ht.distance).find(J=>J.object.parent.name==="plane");ft&&(h(ft.object.parent),L=!1)}V.render(p._scene,C),_>w&&p._animate()}k.update(),m.update(I),jt.end(),_=_%w});const Q=()=>{C.aspect=window.innerWidth/window.innerHeight,C.updateProjectionMatrix(),V.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",Q,!1),window.addEventListener("mousedown",W),window.addEventListener("mouseup",j),G.send("INTRO_IN")});const s=async()=>{await p.nextTick()},o=K(!1),a=()=>{o.value=!0},l=()=>{console.log("quit"),o.value=!1,G.send("GAME_OUT")},r=K(null);ut(r,_=>{_||fn()}),ut(p._airplanes,_=>{_.find(w=>w._id===r.value?._id)||(r.value=null)});const h=_=>{if(p.selectPlane(_._id),r.value=p._airplanes.value.find(w=>w._isSelected),r.value){const w=k.target,f=r.value._model.position;new m.Tween(w).to(f,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>k.target=w).start();const{x:M,y:L,z:W}=r.value._model.position,j=zn(r.value._direction),Q={x:C.position.x,y:C.position.y,z:C.position.z},I={x:M+20*j.x,y:L+10,z:W+20*j.z};new m.Tween(Q).to(I,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{C.position.set(Q.x,Q.y,Q.z),k.update()}).start()}},u=_=>{r.value&&!r.value._isGhost&&r.value.setHeight(_)},d=_=>{r.value&&!r.value._isGhost&&r.value.setDirection(_)},g=K(0),b=K(null);ut(p._tick,()=>{clearInterval(b.value),g.value=0,b.value=setInterval(()=>{g.value++},1e3)}),ut(g,async _=>{_===30&&await p.nextTick()}),ut(lt,_=>{_.matches("gamePlaying.lose")&&clearInterval(b.value)});const S=ot(()=>({background:`conic-gradient(#3b82f6 ${g.value/30*360}deg, transparent ${g.value/30*360}deg)`}));return(_,w)=>(F(),$(yt,null,[ms,c("div",gs,[z(pt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)]","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:E(()=>[A(lt).matches("introIdle")?(F(),$("div",ws,_s)):mt("",!0)]),_:1}),z(pt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)]","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:E(()=>[A(lt).matches("introIdle")?(F(),$("div",ys,[z(O,{size:"lg",onClick:w[0]||(w[0]=f=>A(G).send("INTRO_OUT"))},{default:E(()=>[bs]),_:1})])):mt("",!0)]),_:1}),A(lt).hasTag("board")?(F(),$(yt,{key:0},[c("div",xs,[c("div",{class:"flex justify-center items-center rounded-full w-16 h-16 shadow-block bg-white cursor-pointer transform hover:bg-blue-200 transition-colors",onClick:s},[c("div",{class:"rounded-full w-16 h-16 border-2 border-white",style:ln(A(S))},null,4)]),c("div",vs,[ks,c("div",zs,tt(A(e)),1)])]),z(O,{size:"sm",class:"fixed top-2 left-2",onClick:a},{default:E(()=>[Es]),_:1}),z(pt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:E(()=>[o.value?(F(),$("div",Ms,[c("div",{class:"absolute inset-0 bg-blue-300 bg-opacity-80",onClick:w[1]||(w[1]=cn(f=>o.value=!1,["self"]))}),c("div",Ss,[Is,c("div",Cs,[z(O,{size:"sm","is-secondary":"",onClick:w[2]||(w[2]=f=>o.value=!1)},{default:E(()=>[Ps]),_:1}),z(O,{size:"sm","is-primary":"",onClick:l},{default:E(()=>[Os]),_:1})])])])):mt("",!0)]),_:1}),z(pt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:E(()=>[A(lt).matches("gamePlaying.lose")?(F(),$("div",As,[Ts,c("div",Ls,[Gs,c("div",Ds,[z(O,{size:"sm","is-primary":""},{default:E(()=>[Rs]),_:1})])])])):mt("",!0)]),_:1}),c("div",Xs,[c("div",Us,[Ys,c("div",{class:ct(["font-bold",A(p)._score.value<0?"text-rose-500":A(p)._score.value>0?"text-green-500":"text-blue-500"])},tt(A(p)._score),3)])]),z(pt,{"enter-active-class":"transition duration-200 ease-in-out","enter-from-class":"transform scale-50 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-200 ease-in-out","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-50 opacity-0"},{default:E(()=>[dn(c("div",Ns,[c("div",Zs,[Bs,c("div",Fs,[c("div",$s,[Hs,c("div",Ws,[z(O,{size:"control","is-primary":r.value?._targetDirection===-1,onClick:w[3]||(w[3]=f=>d(-1))},{default:E(()=>[js]),_:1},8,["is-primary"]),z(O,{size:"control",class:"row-span-2","is-primary":r.value?._targetDirection===0&&r.value?._targetAltitude!==0,onClick:w[4]||(w[4]=f=>{d(0),u(r.value?._position.y)})},{default:E(()=>[Qs]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===1,onClick:w[5]||(w[5]=f=>d(1))},{default:E(()=>[qs]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===-2,onClick:w[6]||(w[6]=f=>d(-2))},{default:E(()=>[Ks]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===2,onClick:w[7]||(w[7]=f=>d(2))},{default:E(()=>[Vs]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===-3,onClick:w[8]||(w[8]=f=>d(-3))},{default:E(()=>[Js]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===0&&r.value?._targetAltitude===0,onClick:w[9]||(w[9]=f=>{d(0),u(0)})},{default:E(()=>[to]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===3,onClick:w[10]||(w[10]=f=>d(3))},{default:E(()=>[eo]),_:1},8,["is-primary"]),z(O,{size:"control","is-primary":r.value?._targetDirection===-4,onClick:w[11]||(w[11]=f=>d(-4))},{default:E(()=>[no]),_:1},8,["is-primary"]),z(O,{size:"control","is-disabled":""},{default:E(()=>[so]),_:1}),z(O,{size:"control","is-primary":r.value?._targetDirection===4,onClick:w[12]||(w[12]=f=>d(4))},{default:E(()=>[oo]),_:1},8,["is-primary"])])]),c("div",ao,[io,c("div",ro,[(F(),$(yt,null,Wt([0,1,2,3,4,5,6,7,8],f=>z(O,{key:f,size:"control","is-secondary":r.value?._position.y===f&&r.value?._targetAltitude!==f,"is-primary":r.value?._targetAltitude===f,onClick:M=>u(f)},{default:E(()=>[T(tt(f),1)]),_:2},1032,["is-secondary","is-primary","onClick"])),64))])])])])],512),[[hn,r.value]])]),_:1}),c("div",lo,[c("div",co,[ho,c("div",uo,[c("table",po,[mo,c("tbody",go,[(F(!0),$(yt,null,Wt(A(t),(f,M)=>(F(),$("tr",{key:f._id,class:ct(["transition-colors cursor-pointer",n(f,M)]),onClick:L=>f._flightStatus===A(P).IN_FLIGHT?h(f):null},[c("td",fo,tt(A(Qt)(f._startTime)),1),c("td",_o,tt(f._flightStatus),1),c("td",yo,tt(f._start.name),1),c("td",bo,tt(f._end.name),1),c("td",xo,tt(f._fuel),1)],10,wo))),128))])])])])])],64)):mt("",!0)])],64))}};un(vo).mount("#app");
