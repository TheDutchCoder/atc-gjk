import{c as oe,i as Ze,S as Ye,W as Be,P as He,a as Fe,O as We,V as ie,e as m,C as je,F as $e,M as et,G as $,T as ae,b as I,B as Q,d as P,m as A,f as _,g as Qe,D as qe,I as it,E as Ke,r as ot,h as Nt,H as re,j as mt,k as le,v as Ve,l as Ut,u as Je,n as Xt,o as tn,R as en,p as nn,w as Zt,q as W,s as j,t as u,x as Yt,y as Bt,z as Ht,A as S,J as ht,K as ut,L as B,N as U,Q as Ft,U as sn,X as on}from"./vendor.cf7161d6.js";const an=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerpolicy&&(o.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?o.credentials="include":s.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}};an();const rn=oe({id:"gameMachine",initial:"playing",states:{playing:{on:{TICK:"tick",LOSE:"lose",WIN:"win",QUIT:"finished"}},tick:{on:{DONE:"playing"}},win:{on:{DONE:"finished"}},lose:{on:{DONE:"finished"}},finished:{type:"final"}}}),rt=Ze(rn),ln=oe({id:"main",initial:"loading",states:{loading:{on:{INTRO_IN:"introIn"}},introIn:{tags:"intro",on:{DONE:"introIdle"}},introIdle:{tags:"intro",on:{INTRO_OUT:"introOut"}},introOut:{tags:"intro",on:{DONE:"gameIn"}},gameIn:{tags:"board",on:{DONE:"gamePlaying"}},gamePlaying:{tags:"board",on:{GAME_OUT:"gameOut"}},gameOut:{tags:"board",on:{DONE:"introIn"}}}}),ft=new Ye,cn=()=>{const a=document.getElementById("three");a.innerHTML="",a.appendChild(Z.domElement)},dn=()=>{ft.showPanel(0),document.body.appendChild(ft.dom)},Z=new Be({antialias:!0,alpha:!0,shadow:!0});Z.setSize(window.innerWidth,window.innerHeight);Z.shadowMap.enabled=!0;Z.shadowMap.type=He;const M=new Fe(50,window.innerWidth/window.innerHeight,1,1e3);M.position.set(15,9,15);const k=new We(M,Z.domElement);k.enableDamping=!0;k.enableRotate=!0;k.enableZoom=!0;k.enablePan=!1;k.autoRotate=!0;k.autoRotateSpeed=-2;const hn=new ie(0,0,0),un=()=>{const a=k.target,t=hn;new m.Tween(a).to(t,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>k.target=a).start();const e={x:M.position.x,y:M.position.y,z:M.position.z},n={x:80,y:35,z:80};new m.Tween(e).to(n,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{M.position.set(e.x,e.y,e.z),k.update()}).start()},pn=new je,y=(a,t,e,n,s,o=!0)=>{[[0,11,17],[1,9,20],[2,13,19],[3,15,22],[5,10,16],[4,8,21],[7,12,18],[6,14,23]][a].forEach(r=>{let l,d,f,p=t.attributes.position.getX(r),c=t.attributes.position.getY(r),b=t.attributes.position.getZ(r);o?(l=e?p+e:p,d=n?c+n:c,f=s?b+s:b):(l=e||p,d=n||c,f=s||b),t.attributes.position.setXYZ(r,l,d,f)}),t.attributes.position.needsUpdate=!0},tt=(a,t,e)=>{const n=Math.round(Math.random()*(t*1e5-a*1e5)+a*1e5)/1e5;return e&&n>=e.min&&n<=e.max?tt(a,t,e):n},w=(a,t,e)=>{let n=Math.round(Math.random()*(t-a)+a);return n===e&&(n=w(a,t,e)),n},Y=(a,t=!1)=>{const e=Math.floor(Math.random()*a.length),n=a[e];return t&&a.splice(e,1),n},mn=(a,t,e,n=0)=>{const s=JSON.parse(JSON.stringify(a)),o=JSON.parse(JSON.stringify(a));if(n>0&&(o.splice(-n),o.splice(0,n),o.forEach(p=>{p.splice(-n),p.splice(0,n)})),o.flat(2).every(p=>!!p))return null;const i=0-Math.floor(t/2),r=0-Math.floor(e/2);let l,d;do l=w(n,t-n-1),d=w(n,e-n-1);while(s[d][l]);return{tile:{x:l+i,y:0,z:d+r},x:l,z:d}},ce=(a,t,e={width:0,direction:0})=>{const{width:n,direction:s}=e,o=n/2;let i,r,l=tt(a,t),d=0,f=tt(a,t);for(s===0||s==4?(i=p=>p>o||p<-o,r=()=>!0):s===3||s==7?(i=()=>!0,r=(p,c)=>c>p+o||c<p-o):s===2||s==6?(i=()=>!0,r=(p,c)=>c>o||c<-o):(s===1||s==5)&&(i=()=>!0,r=(p,c)=>c>-p+o||c<-p-o);!i(l);)l=tt(a,t);for(;!r(l,f);)f=tt(a,t);return{x:l,y:d,z:f}},fn=(a,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),o=Math.ceil(0-e/2),i=Math.abs(o),{x:r,z:l}=a;return r===n-1?l===o-1?3:l===i+1?1:2:r===s+1?l===o-1?5:l===i+1?7:6:l===o-1?4:0},gn=(a,t,e)=>{const n=Math.ceil(0-t/2),s=Math.abs(n),o=Math.ceil(0-e/2),i=Math.abs(o),{x:r,z:l}=a;return r===n-1?l===o-1?7:l===i+1?5:6:r===s+1?l===o-1?1:l===i+1?3:2:l===o-1?0:4},kt=(a,t)=>{let{x:e,y:n,z:s}=a;return t===0?s--:t===1?(e++,s--):t===2?e++:t===3?(e++,s++):t===4?s++:t===5?(e--,s++):t===6?e--:t===7&&(e--,s--),{x:e,y:n,z:s}},_n=(a,t)=>{let{x:e,y:n,z:s}=a;return t===0?s++:t===1?(e--,s++):t===2?e--:t===3?(e--,s--):t===4?s--:t===5?(e++,s--):t===6?e++:t===7&&(e++,s++),{x:e,y:n,z:s}},Wt=a=>{const t=Math.floor(a/4).toString(),e=(a%4*15).toString();return`${t.padStart(2,"0")}:${e.padStart(2,"0")}`},wn=a=>({0:"N",1:"NE",2:"E",3:"SE",4:"S",5:"SW",6:"W",7:"NW"})[a],bn=(a,t,e)=>{const n=Math.random()>.7,s=Math.ceil(0-a/2)-1,o=Math.abs(s),i=Math.ceil(0-t/2)-1,r=Math.abs(i),l=[s,o,0],d=[i,r],f=[i,r,0],p=Y(l),c=Math.ceil(Math.random()*9),b=Y(p===0?d:f),z={x:p,y:c,z:b};return n?de(e):{position:z,direction:fn(z,a,t),name:`${he(z)}${c}`}},jt=(a,t,e)=>{const n=Math.random()>.3,s=Math.ceil(0-a/2)-1,o=Math.abs(s),i=Math.ceil(0-t/2)-1,r=Math.abs(i),l=[s,o,0],d=[i,r],f=[i,r,0],p=Y(l),c=Math.ceil(Math.random()*9),b=Y(p===0?d:f),z={x:p,y:c,z:b};return n?de(e):{position:z,direction:gn(z,a,t),name:`${he(z)}${c}`}},de=a=>Y(a),he=a=>{const{x:t,z:e}=a;if(t===0){if(e>0)return"S";if(e<0)return"N"}else if(t<0){if(e<0)return"NW";if(e===0)return"W";if(e>0)return"SW"}else if(t>0){if(e<0)return"NE";if(e===0)return"E";if(e>0)return"SE"}},yn=(a=0)=>{if(a===0)return{x:0,z:1};if(a===1)return{x:-1,z:1};if(a===2)return{x:-1,z:0};if(a===3)return{x:-1,z:-1};if(a===4)return{x:0,z:-1};if(a===5)return{x:1,z:-1};if(a===6)return{x:1,z:0};if(a===7)return{x:1,z:1}},xn={EASY:"EASY",NORMAL:"NORMAL",HARD:"HARD"},$t={EASY:{width:11,depth:11},NORMAL:{width:15,depth:15},HARD:{width:21,depth:21}},Qt={EASY:{min:1,max:2},NORMAL:{min:2,max:3},HARD:{min:3,max:5}},qt={EASY:{min:1,max:2},NORMAL:{min:3,max:5},HARD:{min:6,max:9}},Et={EASY:{amount:24,height:5},NORMAL:{amount:48,height:7},HARD:{amount:96,height:9}},G={SCHEDULED:"Scheduled",APPROACHING:"Approaching",IN_FLIGHT:"In flight",OBSTRUCTED:"Obstructed",LANDED:"Landed",EXITED:"Exited",CRASHED:"Crashed"};var vn="/atc-gjk/assets/helvetiker_regular.typeface.d5c54676.json",kn="/atc-gjk/assets/helvetiker_bold.typeface.bd68159e.json";const En=new $e,zn=async a=>new Promise((t,e)=>{En.load(a,n=>t(n),null,n=>e(n))}),Mn=[vn,kn],ue=await Promise.all(Mn.map(async a=>await zn(a)));ue[0];const pe=ue[1],Sn=new et({color:16711680,flatShading:!0});class In{_tiles=[];_labels=new $;constructor(){}add(t={position:{x:1,y:1,z:1},direction:0,text:"N"}){this._tiles.push(t)}reset(){this._tiles=[]}create(){return this._tiles.forEach(t=>{const e=new ae(t.text,{font:pe,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});e.center(),e.scale(.03,.03,.03),e.rotateX(Math.PI/-2),e.rotateY(t.direction*Math.PI/-4),e.translate(t.position.x*10,-.5+t.position.y*5,t.position.z*10),this._labels.add(new I(e,Sn))}),this._labels}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._labels.scale.setScalar(t.scale)}}const H=new In,Pn=new et({color:10053706,flatShading:!0});class Cn{_tile=null;_dirt=null;constructor(){}add(t={scale:{x:1,y:1,z:1}}){this._tile=t}reset(){this._tile=null,this._dirt=null}create(){const t=new Q(10,3,10);return t.translate(0,-2.5,0),t.scale(this._tile.scale.x,this._tile.scale.y,this._tile.scale.z),this._dirt=new I(t,Pn),this._dirt.scale.setScalar(0),this._dirt}animateIn(){return this._tile?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(0).start()}):Promise.resolve()}animateOut(){return this._tile?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1250).start()}):Promise.resolve()}animateUpdate(t){this._dirt.scale.setScalar(t.scale)}}const It=new Cn,zt=10,An=1,Mt=10,On=new et({color:11984276,flatShading:!0}),Tn=new et({color:10010486,flatShading:!0}),Gn=a=>{const t=a.getAttribute("position");for(let e=0;e<t.count;e++){const n=new ie;if(n.fromBufferAttribute(t,e),n.y>=.5&&n.x!==-5&&n.x!==5&&n.z!==-5&&n.z!==5){const s=.15-Math.random()*.3,o=zt/40-Math.random()*(zt/20),i=Mt/40-Math.random()*(Mt/20);t.setXYZ(e,n.x+o,n.y+s,n.z+i)}}a.attributes.position.needsUpdate=!0};class Ln{_tiles=[];_grassLight=new P;_grassDark=new P;_grassAll=new $;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._grassLight=new P,this._grassDark=new P,this._grassAll=new $}create(){const t=[],e=[];if(this._tiles.forEach(n=>{const s=new Q(10,1,10,zt,An,Mt);Gn(s),s.rotateY(w(0,4)*2*(-Math.PI/4)),s.translate(n.position.x*10,-.5+n.position.y*5,n.position.z*10),n.position.x&1&&n.position.z&1||!(n.position.x&1)&&!(n.position.z&1)?t.push(s):e.push(s)}),this._tiles.length){if(t.length){const n=A(t);this._grassLight=new I(n,On),this._grassLight.receiveShadow=!0}if(e.length){const n=A(e);this._grassDark=new I(n,Tn),this._grassDark.receiveShadow=!0}this._grassAll.add(this._grassLight,this._grassDark),this._grassAll.scale.setScalar(0)}return this._grassAll}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(250).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._grassAll.scale.setScalar(t.scale)}}const gt=new Ln,Rn="#ffff00",Dn=new _(11371131),Nn=new _(10473352),Un=new _(9157493),Xn=new _(13617032),Zn=new _(13340781),me=new _(11910596),fe=new _(9542564),ge=new _(7964047),_e=new _(5857641);new _(11910596);new _(9542564);new _(7964047);const Yn=new _(5124632),Bn=new _(6307874),Hn=new _(5914664),Fn=new _(15658734);new _(16711680);new _(65280);new _(255);const Wn=new _(0),jn=new _(16751104),$n=new _(16711680),Qn=new _(65280),O=new et({flatShading:!0}),qn=new et({flatShading:!0,transparent:!0,opacity:.75}),Kn=new et({flatShading:!0,transparent:!0,opacity:.85}),R=new Q(1,1,1),pt=new Qe(.3,2,4),we=new qe(1,0);new Q(2,.15,.2);new Q(.1,.1,10);const Vn=new Q(3,.2,9),Jn=new Q(.2,.05,.75),Kt=new Q(.2,.2,.2),Vt=[Nn,Un,Xn,Zn],J=new P;class ts{_tiles=[];_trunk=null;_foliage=null;_trees=new $;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._trunk=null,this._foliage=null,this._trees=new $,this._instances=[]}create(){let t=0;if(this._tiles.forEach(e=>{const n=w(20,30);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:ce(-4.75,4.75,e.exclude),rot:{x:tt(-.12,.12),y:tt(-.12,.12),z:0},scale:.5+Math.random()*.75,color:Vt[w(0,Vt.length-1)],tile:e})}),this._tiles.length){this._trunk=new it(pt.clone(),O,t),this._trunk.castShadow=!0;const e=pt.clone();e.scale(1.3,1.3,1.3),e.translate(0,.5,0);const n=pt.clone();n.scale(1.1,1.1,1.1),n.translate(0,1.1,0);const s=A([e,n]);this._foliage=new it(s,O,t),this._foliage.castShadow=!0,this._foliage.receiveShadow=!0,this._trunk.geometry.computeBoundingBox(),this._foliage.geometry.computeBoundingBox(),this._trunk.geometry.translate(0,this._trunk.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,this._foliage.geometry.boundingBox.min.y*-1,0),this._foliage.geometry.translate(0,.3,0),this._trees.add(this._trunk,this._foliage)}return this._trees}updateInstance(t,e,n){const{pos:s,rot:o,scale:i,color:r,tile:l}=t,{x:d,y:f,z:p}=s,{x:c,y:b,z}=o,D=new Ke(c,b,z,"XYZ");J.position.set(d+l.position.x*10,(f+l.position.y*5)*i,p+l.position.z*10),J.setRotationFromEuler(D),J.scale.set(n.x,n.y,n.z),J.updateMatrixWorld(!0),this._trunk.setMatrixAt(e,J.matrixWorld),this._trunk.setColorAt(e,Dn),J.updateMatrixWorld(!0),this._foliage.setMatrixAt(e,J.matrixWorld),this._foliage.setColorAt(e,r),this._trunk.instanceMatrix.needsUpdate=!0,this._trunk.instanceColor.needsUpdate=!0,this._foliage.instanceMatrix.needsUpdate=!0,this._foliage.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},i={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(i,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(w(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},i={x:0,y:0,z:0};new m.Tween(o).to(i,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(w(500,750)).start()})}):Promise.resolve()}}const _t=new ts,Jt=[me,fe,ge,_e],at=new P;class es{_tiles=[];_rock=new P;_instances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._rock=new P,this._instances=[]}create(){let t=0;return this._tiles.forEach(e=>{const n=w(6,12);t+=n;for(let s=0;s<n;s++)this._instances.push({pos:ce(-4.5,4.5,e.exclude),rot:{x:-.1+Math.random()*.2,y:Math.PI/2*Math.random(),z:-.1+Math.random()*.2},scale:.1+Math.random()*.3,color:Jt[w(0,Jt.length-1)],tile:e})}),this._tiles.length&&(this._rock=new it(we,O,t),this._rock.castShadow=!0,this._rock.receiveShadow=!0),this._rock}updateInstance(t,e,n){const{pos:s,rot:o,scale:i,color:r,tile:l}=t,{x:d,y:f,z:p}=s,{x:c,y:b,z}=o;at.position.set(d+l.position.x*10,(f+l.position.y+n.y)*i,p+l.position.z*10),at.rotation.set(c,b,z),at.scale.set(n.x,n.y,n.z),at.updateMatrixWorld(!0),this._rock.setMatrixAt(e,at.matrixWorld),this._rock.setColorAt(e,r),this._rock.instanceMatrix.needsUpdate=!0,this._rock.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},i={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(i,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(w(500,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},i={x:0,y:0,z:0};this.updateInstance(e,n,o),new m.Tween(o).to(i,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(w(500,750)).start()})}):Promise.resolve()}}const wt=new es,te=[me,fe,ge,_e],st=new P;class ns{_tiles=[];_clouds=new P;_animate=()=>{};_instances=[];_tick=0;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._clouds=new P,this._animate=()=>{},this._instances=[],this._tick=0}create(){let t=0;return this._tiles.forEach(e=>{const n=w(8,12);t+=n;const s=te[w(0,te.length-1)],o=w(5,9);for(let i=0;i<n;i++)this._instances.push({pos:{x:-3+Math.random()*6,y:-.2+Math.random()*.4,z:-3+Math.random()*6},rot:{x:Math.PI*2*Math.random(),y:Math.PI*2*Math.random(),z:Math.PI*2*Math.random()},altitude:e.position.y||o,animation:{direction:Math.random()>.5?1:-1,speed:w(200,300)},scale:.5+Math.random()*1.5,color:s,isReady:!1,tile:e})}),this._clouds=new it(we,Kn,t),this._animate=()=>{this._instances.forEach((e,n)=>{const{isReady:s}=e;s&&this.updateInstance(e,n)}),this._tick++},this._clouds}updateInstance(t,e,n){const{pos:s,rot:o,scale:i,color:r,animation:l,tile:d,altitude:f}=t,{x:p,y:c,z:b}=s,{x:z,y:D,z:x}=o,{direction:v,speed:g}=l,C=Math.sin((this._tick+e*50)/10/Math.PI)/20;st.position.set(p+d.position.x*10,f*5+(c+C)*i,b+d.position.z*10),st.rotation.set(z,D,x+this._tick/g*v),n?st.scale.set(n.x,n.y,n.z):st.scale.setScalar(i),st.updateMatrixWorld(!0),this._clouds.setMatrixAt(e,st.matrixWorld),this._clouds.setColorAt(e,r),this._clouds.instanceMatrix.needsUpdate=!0,this._clouds.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:0,y:0,z:0},i={x:s,y:s,z:s};this.updateInstance(e,n,o),new m.Tween(o).to(i,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(()=>{e.isReady=!0,t()}).delay(w(1e3,1250)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._instances.forEach((e,n)=>{const{scale:s}=e,o={x:s,y:s,z:s},i={x:0,y:0,z:0};this.updateInstance(e,n,o),new m.Tween(o).to(i,500).easing(m.Easing.Elastic.In).onStart(()=>e.isReady=!1).onUpdate(()=>this.updateInstance(e,n,o)).onComplete(t).delay(w(250,500)).start()})}):Promise.resolve()}}const lt=new ns,be=O.clone();be.color.set(Wn);const ye=O.clone();ye.color.set(jn);const xe=O.clone();xe.color.set(Qn);const ve=O.clone();ve.color.set($n);const ke=O.clone();ke.color.set(Rn);class ss{_tiles=[];_airstrip=null;_strips=null;_stripes=null;_greenLights=null;_redLights=null;_label=null;constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._airstrip=null,this._strips=null,this._stripes=null,this._greenLights=null,this._redLights=null,this._label=null}create(){this._airstrip=new $;const t=[],e=[],n=[],s=[],o=[];if(this._tiles.forEach((i,r)=>{const l=Vn.clone();l.rotateY(i.direction*Math.PI/-4),l.translate(i.position.x*10,.1+i.position.y*5,i.position.z*10),t.push(l);for(let f=0;f<7;f++){const p=Jn.clone();p.translate(0,0,-3+f),p.rotateY(i.direction*Math.PI/-4),p.translate(i.position.x*10,.2+i.position.y*5,i.position.z*10),e.push(p)}for(let f=0;f<5;f++){const p=Kt.clone();p.translate(-1+f*.5,0,4),p.rotateY(i.direction*Math.PI/-4),p.translate(i.position.x*10,i.position.y*5,i.position.z*10),n.push(p);const c=Kt.clone();c.translate(-1+f*.5,0,-4),c.rotateY(i.direction*Math.PI/-4),c.translate(i.position.x*10,i.position.y*5,i.position.z*10),s.push(c)}const d=new ae(`AP${r+1}`,{font:pe,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:3,bevelOffset:0,bevelSegments:5});d.center(),d.scale(.01,.01,.01),d.translate(0,-3,0),d.rotateX(Math.PI/-2),d.rotateY(i.direction*Math.PI/-4),d.translate(i.position.x*10,.2+i.position.y*5,i.position.z*10),o.push(d)}),this._tiles.length){const i=A(t),r=A(e),l=A(n),d=A(s),f=A(o);this._strips=new I(i,be),this._stripes=new I(r,ye),this._greenLights=new I(l,xe),this._redLights=new I(d,ve),this._labels=new I(f,ke),this._greenLights.position.y=.2,this._redLights.position.y=.2,this._airstrip.add(this._strips,this._stripes,this._greenLights,this._redLights,this._labels)}return this._airstrip}animateIn(){return this._tiles.length?new Promise(t=>{const e={scale:0},n={scale:1};this.animateUpdate(e),new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{const e={scale:1},n={scale:0};new m.Tween(e).to(n,500).easing(m.Easing.Elastic.InOut).onUpdate(()=>this.animateUpdate(e)).onComplete(t).delay(1e3).start()}):Promise.resolve()}animateUpdate(t){this._airstrip.scale.setScalar(t.scale)}}const Pt=new ss,ee=[Yn,Bn,Hn],X=new P;class os{_tiles=[];_beams=null;_rails=null;_beamInstances=[];_railInstances=[];constructor(){}add(t){this._tiles.push(t)}reset(){this._tiles=[],this._beams=null,this._rails=null,this._beamInstances=[],this._railInstances=[]}create(){const t=new $;let e=0,n=0;if(this._tiles.forEach(s=>{const i=s.direction===2||s.direction===6;e+=11;for(let r=0;r<11;r++)this._beamInstances.push({pos:{x:i?-4.6+r*10/11:0,y:0,z:i?0:-4.6+r*10/11},rot:{x:0,y:-.08+Math.random()*.16+(i?Math.PI/2:0),z:0},color:ee[w(0,ee.length-1)],tile:s});n+=2;for(let r=0;r<2;r++)this._railInstances.push({pos:{x:i?0:-.7+r*1.4,y:.2,z:i?-.7+r*1.4:0},rot:{x:0,y:i?Math.PI/2:0,z:0},color:Fn,tile:s})}),this._tiles.length){const s=R.clone();s.scale(2,.3,.3),this._beams=new it(s,O,e),this._beams.castShadow=!0,this._beams.receiveShadow=!0;const o=R.clone();o.scale(.2,.2,10),this._rails=new it(o,O,n),this._rails.castShadow=!0,this._rails.receiveShadow=!0,t.add(this._beams,this._rails)}return t}updateBeamInstance(t,e,n){const{pos:s,rot:o,color:i,tile:r}=t,{x:l,y:d,z:f}=s,{x:p,y:c,z:b}=o;X.position.set(l+r.position.x*10,d+r.position.y*5,f+r.position.z*10),X.rotation.set(p,c,b),X.scale.set(n.x,n.y,n.z),X.updateMatrixWorld(!0),this._beams.setMatrixAt(e,X.matrixWorld),this._beams.setColorAt(e,i),this._beams.instanceMatrix.needsUpdate=!0,this._beams.instanceColor.needsUpdate=!0}updateRailInstance(t,e,n){const{pos:s,rot:o,color:i,tile:r}=t,{x:l,y:d,z:f}=s,{x:p,y:c,z:b}=o;X.position.set(l+r.position.x*10,d+n.y+r.position.y*10,f+r.position.z*10),X.rotation.set(p,c,b),X.scale.set(n.scale,n.scale,n.scale),X.updateMatrixWorld(!0),this._rails.setMatrixAt(e,X.matrixWorld),this._rails.setColorAt(e,i),this._rails.instanceMatrix.needsUpdate=!0,this._rails.instanceColor.needsUpdate=!0}animateIn(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:0,y:0,z:0},o={x:1,y:1,z:1};this.updateBeamInstance(e,n,s),new m.Tween(s).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(w(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:5,scale:0},o={y:0,scale:1};this.updateRailInstance(e,n,s),new m.Tween(s).to(o,500).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(w(750,1e3)).start()})}):Promise.resolve()}animateOut(){return this._tiles.length?new Promise(t=>{this._beamInstances.forEach((e,n)=>{const s={x:1,y:1,z:1},o={x:0,y:0,z:0};new m.Tween(s).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateBeamInstance(e,n,s)).delay(w(750,1e3)).start()}),this._railInstances.forEach((e,n)=>{const s={y:0,scale:1},o={y:5,scale:0};new m.Tween(s).to(o,500).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateRailInstance(e,n,s)).onComplete(t).delay(w(750,1e3)).start()})}):Promise.resolve()}}const Ee=new os,ne=a=>{a.dispose();for(const t of Object.keys(a)){const e=a[t];e&&typeof e=="object"&&"minFilter"in e&&e.dispose()}};class ze{_scene=null;_anims=[];_lights=[];_models=[];_fog=null;_elements=[H,It,gt,_t,wt,lt,Pt,Ee];_airplanes=ot([]);_board=null;_tick=ot(-1);_isAnimating=!1;_score=ot(0);_animate=()=>{lt._animate(),this._airplanes.value.forEach(t=>t?.animate())};constructor(){this._scene=new Nt}addLight(t){this._lights.push(t)}addFog(t){this._fog=t}addBoard(t){this._board=t}addAirplane(t){this._airplanes.value.push(t),this._scene.add(t._model)}removeAirplane(t){this._airplanes.value=this._airplanes.value.filter(n=>n._id!==t._id);const e=this._scene.getObjectById(t._model.id);this._scene.remove(e)}reset(){this._scene.traverse(t=>{if(!!t.isMesh)if(t.geometry.dispose(),t.material.isMaterial)ne(t.material);else for(const e of t.material)ne(e)}),this._scene=new Nt,this._anims=[],this._lights=[],this._models=[],this._fog=null,this._elements.forEach(t=>t.reset())}async animateIn(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateIn())),Promise.resolve()}async animateOut(){return await Promise.all([...this._elements,...this._airplanes.value].map(t=>t.animateOut())),Promise.resolve()}render(){this._scene.fog=this._fog,this._lights.forEach(t=>{this._scene.add(t)}),this._elements.forEach(t=>this._scene.add(t.create()))}}class Ct{_position={x:0,y:0,z:0};_model=null;_hasAnimations=!1;_isAnimating=!1;_shouldBeRemoved=!1;_tick=0;displayName="";constructor({position:t={x:0,y:0,z:0}}={}){this._position=t}updatePosition(){this._model.position.x=this._position.x*10,this._model.position.y=this._position.y*5,this._model.position.z=this._position.z*10}get position(){return this._position}set position(t){this._position=t,this.updatePosition()}get model(){return this._model}set model(t){this._model=t,this.updatePosition(),this._hasAnimations}get isAnimating(){return this._isAnimating}set isAnimating(t){this._isAnimating=t}}class Me extends Ct{constructor({position:t={x:0,y:0,z:0}}={}){super({position:t});this.create()}create(){gt.add({position:this._position}),_t.add({position:this._position}),wt.add({position:this._position})}}class St extends Ct{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){gt.add({position:this._position}),_t.add({position:this._position,exclude:{width:3,direction:this._direction}}),wt.add({position:this._position,exclude:{width:3,direction:this._direction}}),Ee.add({position:this._position,direction:this._direction})}}class Se extends Ct{_tiles=[];_direction=0;constructor({position:t={x:0,y:0,z:0},direction:e=0}={}){super({position:t});this._direction=e,this.create()}create(){gt.add({position:this._position}),_t.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),wt.add({position:this._position,exclude:{width:5.5,direction:this._direction}}),Pt.add({position:this._position,direction:this._direction})}}const is=new _(16777215),as=a=>{const t=R.clone();t.scale(1,1,2),y(0,t,-.2,-.1),y(2,t,-.2,.3),y(4,t,.2,-.1),y(6,t,.2,.3);const e=R.clone();e.scale(3,.1,1),y(1,e,.2,.05),y(3,e,.2,-.05),y(5,e,-.2,.05),y(7,e,-.2,-.05);const n=R.clone();n.scale(.1,.75,.5),n.translate(0,.5,.95),y(0,n,-.04,.05),y(2,n,-.04),y(3,n,0,-.05),y(4,n,.04,.05),y(6,n,.04),y(7,n,0,-.05);const s=R.clone();s.scale(.4,.5,.6);const o=s.clone();o.translate(0,-.3,.6),o.rotateX(-.2);const i=s.clone();i.translate(.3,-.3,-.65);const r=s.clone();r.translate(-.3,-.3,-.65);const l=A([t,e,n,o,i,r]),d=R.clone();d.scale(.7,.4,.05),d.translate(0,.5,-.7),d.rotateX(.2),y(0,d,-.05),y(1,d,-.05),y(4,d,.05),y(5,d,.05);const f=A([d]),p=R.clone();p.scale(1,1,.5),p.translate(0,0,-1.25),y(1,p,-.1,-.1),y(3,p,-.1,.1),y(5,p,.1,-.1),y(7,p,.1,.1);const c=R.clone();c.scale(.1,.1,.5),y(2,c,null,null,.01),y(1,c,null,null,-.009),y(3,c,null,null,-.009),y(7,c,null,null,-.01);const b=c.clone();b.rotateZ(Math.PI/4),b.rotateY(.2),b.translate(.5,.2,-1.05);const z=c.clone();z.rotateZ(Math.PI/4),z.translate(.55,.2,-.55);const D=c.clone();D.rotateZ(Math.PI/4)+Math.PI/2,D.rotateY(-.2),D.translate(-.5,.2,-1.05);const x=c.clone();x.rotateZ(Math.PI/4),x.translate(-.55,.2,-.55);const v=A([p,b,z,D,x]),g=R.clone();g.scale(.2,.2,.2),g.translate(0,0,-1.55),y(0,g,.07,.07),y(2,g,.07,-.07),y(4,g,-.07,.07),y(6,g,-.07,-.07);const C=R.clone();C.scale(.2,.4,.4);const N=C.clone();N.translate(0,-.6,.6),N.rotateX(-.2);const nt=C.clone();nt.translate(-.3,-.6,-.65);const q=C.clone();q.translate(.3,-.6,-.65);const F=A([g,N,nt,q]),E=R.clone();E.scale(.15,1.5,.05),E.translate(0,0,-1.6);const L=E.clone();L.rotateZ(Math.PI/2);const At=A([E,L]),K=R.clone();K.scale(.34,.2,.2);const V=K.clone();V.translate(0,-.6,.6),V.rotateX(-.2);const ct=K.clone();ct.translate(-.3,-.6,-.65);const Ot=K.clone();Ot.translate(.3,-.6,-.65);const Pe=A([V,ct,Ot]),dt=pt.clone();dt.scale(1.2,.42,1.2),dt.rotateX(Math.PI),dt.translate(0,2,0);const Ce=A([dt]),bt=new $;bt.name="plane";const yt=O.clone();yt.color.set(a),yt.name="base";const Tt=qn.clone(),Gt=O.clone(),Lt=O.clone(),xt=O.clone(),Rt=O.clone(),Ae=new _(14872564),Oe=new _(0),Te=new _(10053706),Ge=new _(16777215),Le=new _(65280);Tt.color.set(Ae),Gt.color.set(Ge),Lt.color.set(Te),xt.color.set(Oe),Rt.color.set(Le);const Re=new I(l,yt),De=new I(f,Tt),Ne=new I(v,Gt),Ue=new I(F,xt),Dt=new I(At,xt);Dt.name="props";const Xe=new I(Pe,Lt),vt=new I(Ce,Rt);return vt.name="selector",vt.visible=!1,bt.add(Re,De,Ne,Ue,Dt,Xe,vt),bt};class Ie{_startTime=0;_position={x:0,y:0,z:0};_direction=0;_targetAltitude=0;_targetDirection=0;_start=null;_end=null;_spawned=!1;_takenOff=!1;_landed=!1;_isGhost=!1;_isSelected=!1;_name="";_id=null;_color=null;_model=null;_tick=0;_fuel=0;_flightStatus=G.SCHEDULED;constructor(t){const{id:e,start:n,end:s,fuel:o,startTime:i}=t;return this._start=n,this._end=s,this._position=n.position,this._direction=n.direction,this._targetAltitude=this._position.y||1,this._takenOff=this._position.y!==0,this._id=e,this._name="GJK",this._color=new _(Math.random()*16777215),this._fuel=o,this._startTime=i,this.create(),this}animate=()=>this.animateIdle();updateAnimation(t){this._model.position.x=t.position.x*10,this._model.position.y=t.position.y*5,this._model.position.z=t.position.z*10,this._model.scale.setScalar(t.scale)}animateIn(t=1250,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this;let i,r;this._takenOff?(i={position:_n({...s},o),direction:o,scale:0},r={position:{...s},direction:o,scale:1}):(i={position:{...s},direction:o,scale:0},r={position:{...s},direction:o,scale:1},i.position.y=.18,r.position.y=.18),this.updateAnimation(i),new m.Tween(i).to(r,e).easing(m.Easing.Elastic.Out).onUpdate(()=>this.updateAnimation(i)).onComplete(n).delay(t).start()})}animateOut(t=0,e=500){return new Promise(n=>{const{_position:s,_direction:o}=this,i={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._direction,scale:1},r={position:kt(s,o),direction:this._direction,scale:0};this.updateAnimation(i),new m.Tween(i).to(r,e).easing(m.Easing.Elastic.In).onUpdate(()=>this.updateAnimation(i)).onComplete(n).delay(t).start()})}animateIdle(){const t=Math.sin(this._tick/10/Math.PI)/100,e=Math.sin(this._tick/15/Math.PI)/10,n=Math.sin(this._tick/20/Math.PI)/20;this._position.y>=1&&(this._model.position.y+=t,this._model.rotation.z=e,this._model.rotation.x=n),this._model.children.forEach(s=>{s.name==="props"&&(s.rotation.z+=.3),s.name==="selector"&&(s.rotation.y+=.01,s.position.y+=t)}),this._tick++}create(){const t=as(this._color);t.position.x=this._position.x*10,t.position.z=this._position.z*10,t.position.y=this._position.y*5,t.rotation.y=this._direction*(Math.PI/-4),this._takenOff||t.rotateX(.1),t._id=this._id,this._model=t}async next(t=0,e=1){const n=kt(this._position,this._direction);let s=0,o=0;this._targetAltitude>this._position.y?s=1:this._targetAltitude<this._position.y&&(s=-1),this._targetDirection>0?(this._targetDirection--,o=1):this._targetDirection<0&&(this._targetDirection++,o=-1),await this.animateNext(s,o,t,e,this._takenOff?0:.1),this.unsetGhost(),this._takenOff=!0,this._flightStatus=G.IN_FLIGHT,n.y+=s,this._position=n,this._direction=(8+(this._direction+o))%8,this._model.rotation.y=this._direction*(Math.PI/-4),this._fuel-=1}async animateNext(t,e,n=0,s=1){return new Promise(o=>{const i={position:{x:this._model.position.x/10,y:this._model.position.y/5,z:this._model.position.z/10},direction:this._model.rotation.y,scale:s},r=kt(this._position,this._direction);r.y+=t,r.y===0&&(r.y=.18);const l={position:r,direction:this._model.rotation.y+e*Math.PI/-4,scale:1};new m.Tween(i).to(l,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>this.updateAnimation(i,this._targetDirection>0)).onComplete(o).delay(n).start()})}setGhost(){this._isGhost=!0,this._model.children.forEach(t=>{t.material.name==="base"&&t.material.color.set(is),t.material&&t.material.name!=="selector"&&(t.material.transparent=!0,t.material.opacity=.75,t.material.needsUpdate=!0)})}unsetGhost(){this._isGhost=!1,this._model.children.forEach(t=>{t.material.name==="base"&&t.material.color.set(this._color),t.material&&t.material.name!=="selector"&&(t.material.transparent=!1,t.material.opacity=1,t.material.needsUpdate=!0)})}setSpawned(){this._spawned=!0,this._flightStatus=G.APPROACHING}setExited(){this._flightStatus=G.EXITED}setLanded(){this._flightStatus=G.LANDED}setCrashed(){this._flightStatus=G.CRASHED}setSelected(){this._isSelected=!0,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!0)})}unsetSelected(){this._isSelected=!1,this._model.children.forEach(t=>{t.name==="selector"&&(t.visible=!1)})}setHeight(t){this._targetAltitude=t}setDirection(t){this._targetDirection+=t}}const T=new ze,rs=[Me,St,Se],ls=Y(rs);T.start=()=>{const a=new re(16777215,526338,.7);a.position.set(15,25,15);const t=new P;t.rotation.x=Math.PI/-3;const e=new mt(16777215,.3);t.add(e),e.position.set(60,0,0),e.lookAt(t.position),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.top=90,e.shadow.camera.bottom=-120,e.shadow.camera.left=-90,e.shadow.camera.right=90,t.rotation.y=Math.PI/-1.5;const n=new mt(11592173,.2);n.position.set(-20,25,-10),T.addLight(a),T.addLight(t),T.addLight(n),new ls;const s=new Ie({id:0,start:{position:{x:0,y:1,z:0},direction:1,name:""},end:{position:{x:0,y:0,z:0},direction:1,name:""},fuel:100});T.addAirplane(s),It.add(),lt.add({position:{x:0,y:2,z:0}});const o=new le(new _(10209513),15,30);T.addFog(o);const i=new P;i.position.y=2.5,k.target=i.position};class cs{_width=0;_depth=0;_difficulty=null;_airfields=0;_clouds=0;_airplanes=0;_airplanesQueue=[];_tiles=[];_tick=0;constructor(t=xn.NORMAL){this._difficulty=t,this._width=$t[this._difficulty].width,this._depth=$t[this._difficulty].depth,this._airfields=w(Qt[this._difficulty].min,Qt[this._difficulty].max),this._clouds=w(qt[this._difficulty].min,qt[this._difficulty].max),this._airplanes=Et[this._difficulty].amount}generate(){const t=Math.ceil(0-this._width/2),e=Math.ceil(0-this._depth/2),n=Math.abs(t),s=Math.abs(e);this._tiles=Array.from({length:this._depth},()=>Array.from({length:this._width},()=>null));const o=Math.random()>.5,i=Y(o?[0,1,this._depth-1,this._depth-2]:[0,1,this._width-1,this._width-2]);o?this._tiles[i].forEach((l,d)=>{this._tiles[i][d]=new St({position:{x:d+t,y:0,z:i+e},direction:2})}):this._tiles.forEach((l,d)=>{this._tiles[d][i]=new St({position:{x:i+t,y:0,z:d+e}})});const r=[];for(let l=0;l<this._airfields;l++){const d=mn(this._tiles,this._width,this._depth,3);if(d){const{x:f,z:p,tile:c}=d,b={position:c,direction:w(0,7),name:`AP${r.length+1}`};r.push(b),this._tiles[p][f]=new Se(b)}}this._tiles.forEach((l,d)=>{l.forEach((f,p)=>{if(!f)return new Me({position:{x:p+t,y:0,z:d+e}})})}),It.add({scale:{x:this._width,y:1,z:this._depth}});for(let l=0;l<this._clouds;l++)lt.add({position:{x:w(t,s),y:w(Et[this._difficulty].height-2,Et[this._difficulty].height),z:w(e,s)}});for(let l=0;l<this._airplanes;l++){const d=bn(this._width,this._depth,r);let f=jt(this._width,this._depth,r);for(;d.name===f.name;)f=jt(this._width,this._depth,r);this._airplanesQueue.push(new Ie({id:Ve(),start:d,end:f,startTime:w(0,96),fuel:w(20,35)}))}H.add({position:{x:0,y:0,z:e-2},direction:0,text:"N"}),H.add({position:{x:n+1,y:0,z:e-1},direction:1,text:"NE"}),H.add({position:{x:n+2,y:0,z:0},direction:2,text:"E"}),H.add({position:{x:n+1,y:0,z:s+1},direction:3,text:"SE"}),H.add({position:{x:0,y:0,z:s+2},direction:4,text:"S"}),H.add({position:{x:t-1,y:0,z:s+1},direction:5,text:"SW"}),H.add({position:{x:t-2,y:0,z:0},direction:6,text:"W"}),H.add({position:{x:t-1,y:0,z:e-1},direction:7,text:"NW"}),this._airplanesQueue.sort((l,d)=>l._startTime<d._startTime?-1:l._startTime>d._startTime?1:0)}}const h=new ze,se=new cs;h.start=()=>{const a=new re(16777215,526338,.7);a.position.set(15,25,15);const t=new P;t.name="sun";const e=new mt(16777215,.3),n=new Ut(e,5);t.add(e),e.position.set(0,60,0),e.castShadow=!0,e.shadow.mapSize.width=2048,e.shadow.mapSize.height=2048,e.shadow.camera.near=.5,e.shadow.camera.far=500,e.shadow.camera.top=90,e.shadow.camera.bottom=-120,e.shadow.camera.left=-90,e.shadow.camera.right=90;const s=new mt(11592173,.2),o=new Ut(s,5);s.position.set(-20,25,-10);const i=new P;i.position.y=2.5,k.target=i.position,h.addLight(a),h.addLight(t),h.addLight(n),h.addLight(o),h.addLight(s);const r=new le(new _(10209513),15,350);t.rotation.x=Math.PI/4,t.rotation.z=Math.PI,se.generate(),h.addFog(r),h.addBoard(se),rt.start(),h.nextTick()};h.nextTick=async()=>{if(!h._isAnimating){h._isAnimating=!0,h._tick.value++,h._airplanes.value=h._airplanes.value.filter(n=>{if(n._flightStatus===G.LANDED||n._flightStatus===G.EXITED)h.removeAirplane(n);else return n});const a=Promise.all(h._airplanes.value.map(n=>n.next())),t=Promise.all(h._board._airplanesQueue.filter(n=>n._startTime===h._tick.value).map(n=>(h.addAirplane(n),n.setSpawned(),n.setGhost(),n.animateIn(0,500)))),e=new Promise(n=>{const s=h._lights.find(r=>r.name==="sun"),o={rot:s.rotation.z},i={rot:s.rotation.z+Math.PI*2*(1/96)};new m.Tween(o).to(i,500).easing(m.Easing.Quadratic.InOut).onUpdate(()=>s.rotation.z=o.rot).onComplete(n).start()});await a,await t,await e,h.checkObstructions(),h.checkDestinations(),h.checkOutOfBounds(),h.checkOutOfFuel(),h._isAnimating=!1}};h.checkObstructions=()=>{const a=0-Math.floor(h._board._width/2),t=0-Math.floor(h._board._depth/2),e=Math.abs(a),n=Math.abs(t);h._airplanes.value.forEach(s=>{const{x:o,y:i,z:r}=s._position;let l=!1,d=!1;lt._tiles.forEach(f=>{const{x:p,y:c,z:b}=f.position;p===o&&c===i&&b===r&&(l=!0)}),(o<a||o>e||r<t||r>n)&&(d=!0),(l||d)&&s.setGhost()})};h.checkCollisions=()=>{h._airplanes.value.forEach(a=>{const{x:t,y:e,z:n}=a._position;a._takenOff&&(e===0&&Pt._tiles.forEach(s=>{const{x:o,y:i,z:r}=s.position;t===o&&n===r&&a._direction===s.direction?console.log("plane landed on airport, check if it's the right airport!"):(console.log(`plane crashed at ${o}, ${i}, ${r}`),rt.send("LOSE"))}),h._airplanes.value.forEach(s=>{if(a._id!==s._id){const{x:o,y:i,z:r}=s._position;t===o&&e===i&&n===r&&rt.send("LOSE")}}))})};h.checkDestinations=()=>{h._airplanes.value.forEach(a=>{if(a._takenOff){const{x:t,y:e,z:n}=a._position,s=a._direction,{position:{x:o,y:i,z:r},direction:l}=a._end;t===o&&e===i&&n===r&&s===l?(h._score.value+=100+a._fuel*10,a.setGhost(),e===0?a.setLanded():a.setExited()):e===0&&(console.log("game over!"),a.setCrashed(),rt.send("LOSE"))}})};h.checkOutOfBounds=()=>{h._airplanes.value.forEach(a=>{const{x:t,z:e}=a._position,n=0-Math.ceil(h._board._width/2),s=0-Math.ceil(h._board._depth/2),o=Math.abs(n),i=Math.abs(s);(t<=n||t>=o||e<=s||e>=i)&&a._flightStatus!==G.APPROACHING&&a._startTime<h._tick.value&&(h._score.value-=500,a.setExited())})};h.checkOutOfFuel=()=>{h._airplanes.value.forEach(a=>{a._fuel<=0&&(console.log("game over!"),rt.send("LOSE"))})};h.selectPlane=a=>{h._airplanes.value.forEach(t=>{if(t._id===a&&t._isSelected){t.unsetSelected();return}t.unsetSelected(),t._id===a&&!t._isGhost&&t.setSelected()})};const ds=u("div",{id:"three"},null,-1),hs={class:""},us={key:0,class:"absolute top-32 left-1/2 transform -translate-x-1/2"},ps=u("h1",{class:"font-callout text-6xl stage"},[u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("div",{class:"layer"}),u("span",{class:"opacity-0"},"Air Traffic Control")],-1),ms=[ps],fs={key:0,class:"fixed z-50 inset-0 flex items-center justify-center"},gs=u("div",{class:"absolute inset-0 bg-sky-800 bg-opacity-80"},null,-1),_s={class:"relative z-10 p-4 rounded bg-white shadow-xl"},ws=u("h2",{class:"text-lg font-bold"}," Are you sure you want to quit? ",-1),bs={class:"flex space-x-4 items-center justify-center mt-4"},ys={class:"fixed top-1 left-1/2 transform -translate-x-1/2 bg-white rounded px-4 py-2 font-bold w-20 text-center"},xs={class:"fixed bottom-2 right-2 bg-white rounded-lg text-sm shadow-lg overflow-hidden"},vs=u("h2",{class:"font-bold p-4"}," Flight Schedule ",-1),ks={class:"text-center"},Es=u("thead",{class:"bg-slate-100"},[u("tr",null,[u("th",{class:"py-1 px-2"}," Time "),u("th",{class:"py-1 px-2"}," Status "),u("th",{class:"py-1 px-2"}," From "),u("th",{class:"py-1 px-2"}," To "),u("th",{class:"py-1 px-2"}," Fuel ")])],-1),zs={class:"text-xs"},Ms=["onClick"],Ss={class:"py-1 px-2"},Is={class:"py-1 px-2"},Ps={class:"p-2 font-bold"},Cs={class:"py-1 px-2"},As={class:"py-1 px-2"},Os={class:"py-1 px-2"},Ts={class:"grid grid-cols-3"},Gs=["disabled"],Ls=["disabled"],Rs={class:"grid grid-cols-3"},Ds=["disabled","onClick"],Ns={setup(a){const{state:t,send:e,service:n}=Je(ln),s=ot(!0),o=Xt(()=>h._board._airplanesQueue.map(x=>h._airplanes.value.find(g=>g._id===x._id)||x)),i=Xt(()=>Wt(h._tick.value));tn(()=>{cn(),dn(),k.autoRotate=!1,k.enablePan=!0,n.onTransition(async E=>{if(E.changed&&E.matches("introIn")&&(k.autoRotate=!0,T.start(),T.render(),await T.animateIn(),n.send("DONE")),E.changed&&E.matches("introOut")&&(k.enableRotate=!1,k.autoRotate=!1,await T.animateOut(),n.send("DONE")),E.changed&&E.matches("gameIn")){T.reset(),h.start(),h.render();const L=M.position;new m.Tween(L).to({x:80,y:35,z:80},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>M.position.set(L.x,L.y,L.z)).onComplete(()=>{k.enableRotate=!0,k.enableZoom=!0,n.send("DONE")}).start(),await h.animateIn()}if(E.changed&&E.matches("gamePlaying")&&(k.enableRotate=!0),E.changed&&E.matches("gameOut")){k.enableRotate=!1;const L=M.position;new m.Tween(L).to({x:15,y:9,z:15},1500).easing(m.Easing.Cubic.InOut).onUpdate(()=>M.position.set(L.x,L.y,L.z)).onComplete(()=>{k.enableRotate=!0,k.enableZoom=!0,n.send("DONE")}).delay(500).start(),await h.animateOut(),h.reset()}});let x=0,v=1/60;const g=new en,C=new nn;let N=!1;const nt=E=>{N=!0,C.x=E.clientX/window.innerWidth*2-1,C.y=-(E.clientY/window.innerHeight)*2+1},q=()=>{N=!1};Z.setAnimationLoop(async E=>{if(x+=pn.getDelta(),ft.begin(),n.state.hasTag("intro")&&T._scene)Z.render(T._scene,M),x>v&&T._animate();else if(n.state.hasTag("board")&&h._scene){if(N){g.setFromCamera(C,M);const K=g.intersectObjects(h._scene.children).sort((V,ct)=>V.distance<ct.distance).find(V=>V.object.parent.name==="plane");K&&(b(K.object.parent),N=!1)}Z.render(h._scene,M),x>v&&h._animate()}k.update(),m.update(E),ft.end(),x=x%v});const F=()=>{M.aspect=window.innerWidth/window.innerHeight,M.updateProjectionMatrix(),Z.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",F,!1),window.addEventListener("mousedown",nt),window.addEventListener("mouseup",q),e("INTRO_IN")});const r=()=>{Object.values(Z.info).forEach(x=>{console.table({item:x})})},l=async()=>{await h.nextTick()},d=ot(!1),f=()=>{d.value=!0},p=()=>{console.log("quit"),d.value=!1,e("GAME_OUT")},c=ot(null);Zt(c,x=>{x||un()}),Zt(h._airplanes,x=>{x.find(v=>v._id===c.value?._id)||(c.value=null)});const b=x=>{if(h.selectPlane(x._id),c.value=h._airplanes.value.find(v=>v._isSelected),c.value){const v=k.target,g=c.value._model.position;new m.Tween(v).to(g,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>k.target=v).start();const{x:C,y:N,z:nt}=c.value._model.position,q=yn(c.value._direction),F={x:M.position.x,y:M.position.y,z:M.position.z},E={x:C+20*q.x,y:N+10,z:nt+20*q.z};new m.Tween(F).to(E,500).easing(m.Easing.Cubic.InOut).onUpdate(()=>{M.position.set(F.x,F.y,F.z),k.update()}).start()}},z=x=>{c.value&&!c.value._isGhost&&c.value.setHeight(x)},D=x=>{c.value&&!c.value._isGhost&&c.value.setDirection(x)};return(x,v)=>(W(),j(ut,null,[ds,u("div",hs,[Yt(Bt,{"enter-active-class":"transition duration-500 ease-[cubic-bezier(.75,-0.4,.25,1.4)]","enter-from-class":"scale-50 opacity-0","enter-to-class":"scale-100 opacity-100","leave-active-class":"transition duration-500 ease-in","leave-from-class":"scale-100 opacity-100","leave-to-class":"scale-95 opacity-0"},{default:Ht(()=>[S(t).matches("introIdle")?(W(),j("div",us,ms)):ht("",!0)]),_:1}),S(t).hasTag("intro")?(W(),j("button",{key:0,class:"fixed top-1 right-1 bg-white rounded px-4 py-2 font-bold",onClick:v[0]||(v[0]=g=>S(e)("INTRO_OUT"))}," Play ")):ht("",!0),S(t).hasTag("board")?(W(),j(ut,{key:1},[u("button",{class:"fixed top-1 right-20 bg-white rounded px-4 py-2 font-bold",onClick:l}," Tick "),u("button",{class:"fixed top-1 right-1 bg-white rounded px-4 py-2 font-bold",onClick:f}," Quit "),Yt(Bt,{"enter-active-class":"transition duration-100 ease-out","enter-from-class":"transform scale-95 opacity-0","enter-to-class":"transform scale-100 opacity-100","leave-active-class":"transition duration-75 ease-in","leave-from-class":"transform scale-100 opacity-100","leave-to-class":"transform scale-95 opacity-0"},{default:Ht(()=>[d.value?(W(),j("div",fs,[gs,u("div",_s,[ws,u("div",bs,[u("button",{class:"rounded py-2 px-6 bg-gray-200",onClick:v[1]||(v[1]=g=>d.value=!1)}," No "),u("button",{class:"rounded py-2 px-6 bg-sky-700 text-white",onClick:p}," Yes ")])])])):ht("",!0)]),_:1}),u("div",ys,B(S(i))+" "+B(S(h)._score),1),u("div",xs,[vs,u("div",{class:"absolute top-1 right-1",onClick:v[2]||(v[2]=g=>s.value=!s.value)}," x "),u("div",{class:U(["max-h-64 overflow-auto",s.value?"":"h-0"])},[u("table",ks,[Es,u("tbody",zs,[(W(!0),j(ut,null,Ft(S(o),(g,C)=>(W(),j("tr",{key:g._id,class:U([g._flightStatus===S(G).APPROACHING||g._flightStatus===S(G).OBSTRUCTED||g._flightStatus===S(G).LANDED||g._flightStatus===S(G).EXITED?"opacity-50":c.value&&c.value._id===g._id?"bg-sky-500":C%2===0?"bg-slate-50 hover:bg-slate-100":"hover:bg-slate-100","cursor-pointer transition-colors"]),onClick:N=>g._flightStatus===S(G).IN_FLIGHT?b(g):null},[u("td",Ss,[u("div",{class:U(["inline-block rounded-full border px-2",g._startTime<S(h)._tick.value?"bg-green-100 border-green-300 text-green-700":g._startTime===S(h)._tick.value?"bg-orange-100 border-orange-300 text-orange-700":"bg-blue-100 border-blue-300 text-blue-700"])},B(S(Wt)(g._startTime)),3)]),u("td",Is,[u("div",Ps,B(g._flightStatus),1)]),u("td",Cs,[u("div",{class:U(["inline-block rounded-full border px-2",g._start.name.substring(0,2)==="AP"?"bg-orange-100 border-orange-300 text-orange-700":"bg-blue-100 border-blue-300 text-blue-700"])},B(g._start.name),3)]),u("td",As,[u("div",{class:U(["inline-block rounded-full border px-2",g._end.name.substring(0,2)==="AP"?"bg-orange-100 border-orange-300 text-orange-700":"bg-blue-100 border-blue-300 text-blue-700"])},B(g._end.name),3)]),u("td",Os,[u("div",{class:U(["inline-block rounded-full border px-2",g._fuel<10?"bg-red-100 border-red-300 text-red-700":g._fuel<20?"bg-orange-100 border-orange-300 text-orange-700":"bg-green-100 border-green-300 text-green-700"])},B(g._fuel),3)])],10,Ms))),128))])])],2)]),u("div",{class:U(["fixed bottom-24 left-2 bg-white rounded-lg text-sm shadow-lg overflow-hidden",!c.value||c.value?._isGhost?"opacity-50":""])},[u("div",Ts,[u("button",{class:U(["h-8 hover:bg-slate-200 flex items-center justify-center",c.value?._targetDirection<0?"bg-red-500":""]),disabled:c.value?._isGhost,onClick:v[3]||(v[3]=g=>D(-1))}," left ",10,Gs),sn(" "+B(c.value?S(wn)(c.value._direction):"N/A")+" ",1),u("button",{class:U(["h-8 hover:bg-slate-200 flex items-center justify-center",c.value?._targetDirection>0?"bg-red-500":""]),disabled:c.value?._isGhost,onClick:v[4]||(v[4]=g=>D(1))}," right ",10,Ls)]),u("div",Rs,[(W(),j(ut,null,Ft([9,8,7,6,5,4,3,2,1,0],g=>u("button",{key:g,class:U(["w-8 h-8 hover:bg-slate-200 flex items-center justify-center",c.value&&(c.value._position.y===g||c.value._targetAltitude===g)?"bg-red-500":""]),disabled:c.value?._isGhost,onClick:C=>z(g)},B(g),11,Ds)),64))])],2)],64)):ht("",!0),u("button",{class:"fixed bottom-1 left-1 bg-white rounded px-4 py-2 font-bold",onClick:r}," Stats ")])],64))}};on(Ns).mount("#app");
